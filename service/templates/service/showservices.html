{% extends "dashboard/layout.html" %}


{% block title %}
  일정관리
{% endblock %}


{% block content %}

  <div class="row">

    <div class="col-xl-6">

      <div class="card shadow mb-4">

        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">

          <h6 class="m-0 h3 text-gray-800"> 일정 </h6>

          <div class="dropdown no-arrow">
            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown"
               aria-haspopup="true" aria-expanded="false">
              <i class="fas fa-filter fa-fw text-gray-400"></i>
            </a>

          </div>

        </div>

        <div class="card-body">

          <div class="table-responsive">
            <table id="showservice" class="hover row-border" width="100%" style="width: 100%;">
              <thead>
              <tr>
                <th>날짜</th>
                <th>고객사</th>
                <th>제목</th>
                <th class="d-none">serviceId</th>
                <th class="d-none">empName</th>
                <th class="d-none">directgo</th>
                <th class="d-none">companyName</th>
                <th class="d-none">serviceType</th>
                <th class="d-none">serviceStartDatetime</th>
                <th class="d-none">serviceEndDatetime</th>
                <th class="d-none">serviceHour</th>
                <th class="d-none">serviceOverHour</th>
                <th class="d-none">serviceTitle</th>
                <th class="d-none">serviceDetails</th>
              </tr>
              </thead>
            </table>
          </div>

        </div>

      </div>

    </div>

    <div class="col-xl-6 d-none d-xl-block">

      <div class="card shadow mb-4">

        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">

          <h6 class="m-0 h3 text-gray-800"> 상세내용 </h6>

        </div>

        <div class="card-body">

          <div class="form-group row">
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">성함</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="empName"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">직출</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="directgo"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">고객사</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="companyName"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">일정구분</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="serviceType"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">시작시간</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="serviceStartDatetime"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">종료시간</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="serviceEndDatetime"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">소요시간</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="serviceHour"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-6 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">초과근무</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="serviceOverHour"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-12 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">제목</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="serviceTitle"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-12 mb-3 mb-sm-0">
              <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">내용</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800" id="serviceDetails"></div>
                    </div>
                    <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>
  </div>

{% endblock %}


{% block script %}

  <script type="text/javascript">

      $(document).ready(function () {

          const table = $('#showservice').DataTable({
              data: [],
              columns: [
                  {data: "날짜"},
                  {data: "고객사"},
                  {data: "제목"},
                  {data: "serviceId"},
                  {data: "empName"},
                  {data: "directgo"},
                  {data: "companyName"},
                  {data: "serviceType"},
                  {data: "serviceStartDatetime"},
                  {data: "serviceEndDatetime"},
                  {data: "serviceHour"},
                  {data: "serviceOverHour"},
                  {data: "serviceTitle"},
                  {data: "serviceDetails"},
              ],
              columnDefs: [
                  {targets: 0, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "60%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: [3,4,5,6,7,8,9,10,11,12,13 ], visible:false}
              ],
              "ordering": false,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollCollapse": true,
          });

          {% for service in services %}
              table.row.add( {
                  "날짜": "{{ service.serviceDate | date:"Y-m-d" }}",
                  "고객사": "{{ service.companyName.companyName }}<br>({{ service.serviceType }})",
                  "제목": "{{ service.serviceTitle }}",
                  "serviceId": "{{ service.serviceId }}",
                  "empName": "{{ service.empName }}",
                  "directgo": "{{ service.directgo }}",
                  "companyName": "{{ service.companyName.companyName }} ({{ service.serviceLocation }})",
                  "serviceType": "{{ service.serviceType }}",
                  "serviceStartDatetime": "{{ service.serviceStartDatetime | date:"Y년 m월 d일"}} {{ service.serviceStartDatetime | time:"H:i"}}",
                  "serviceEndDatetime": "{{ service.serviceStartDatetime | date:"Y년 m월 d일"}} {{ service.serviceEndDatetime | time:"H:i"}}",
                  "serviceHour": "{{ service.serviceHour }} 시간",
                  "serviceOverHour": "{{ service.serviceOverHour }} 시간",
                  "serviceTitle": "{{ service.serviceTitle }}",
                  "serviceDetails": "{{ service.serviceDetails | linebreaksbr }}"
              } ).draw();
          {% endfor %}

          $("#showservice").on("click", 'tr', function(){
              const data = table.row(this).data();
              location.href='/service/viewservice/' + data.serviceId + '/'
          });

          $("#showservice").on("mouseenter", 'tr', function(){
              const data = table.row(this).data();
              $('#empName').text(data.empName);
              $('#directgo').text(data.directgo);
              $('#companyName').text(data.companyName);
              $('#serviceType').text(data.serviceType);
              $('#serviceStartDatetime').text(data.serviceStartDatetime);
              $('#serviceEndDatetime').text(data.serviceEndDatetime);
              $('#serviceHour').text(data.serviceHour);
              $('#serviceOverHour').text(data.serviceOverHour);
              $('#serviceTitle').text(data.serviceTitle);
              $('#serviceDetails').html(data.serviceDetails);
          });

      });

  </script>

{% endblock %}