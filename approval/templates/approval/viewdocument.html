{% extends "dashboard/layout.html" %}


{% block title %}
  전자결재
{% endblock %}


{% block css %}
  <style>
    .pc-table {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .pc-table td, .pc-table th {
      padding: 8px 15px;
      vertical-align: middle;
      font-size: 14px;
      border: 1px dotted #858796a3;
    }

    .pc-table-title {
      width: 10%;
      background-color: #f8f9fc;
      text-align: center;
      font-weight: bold;
    }

    .pc-table-detail {
      width: 40%;
      text-align: left;
    }
  </style>
{% endblock %}


{% block content %}
  <form id="documentForm" method="post">{% csrf_token %}</form>

  <div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
      <h6 class="m-0 h3 text-gray-800">
        {{ document.formId.formNumber }}.
        {{ document.formId.formTitle }}
      </h6>
    </div>

    <div class="card-body">
      <table class="pc-table">
        <tbody>
        <tr>
          <td class="pc-table-title" colspan="1">문서 종류</td>
          <td class="pc-table-detail" colspan="4">
            {{ document.formId.categoryId.firstCategory }} >
            {{ document.formId.categoryId.secondCategory }} >
            {{ document.formId.formTitle }}
          </td>
          <td class="pc-table-title" colspan="1">문서 번호</td>
          <td class="pc-table-detail" colspan="4">{{ document.documentNumber }}</td>
        </tr>
        <tr>
          <td class="pc-table-title" colspan="1">기안 부서</td>
          <td class="pc-table-detail" colspan="4">{{ document.writeEmp.empDeptName }}</td>
          <td class="pc-table-title" colspan="1">기&nbsp;&nbsp;안&nbsp;&nbsp;자</td>
          <td class="pc-table-detail" colspan="4">{{ document.writeEmp.empName }}</td>
        </tr>
        <tr>
          <td class="pc-table-title" colspan="1">보존 연한</td>
          <td class="pc-table-detail" colspan="4">
            {% if document.preservationYear == 9999 %} 영구
            {% else %} {{ document.preservationYear }}년
            {% endif %}
          </td>
          <td class="pc-table-title" colspan="1">보안 등급</td>
          <td class="pc-table-detail" colspan="4">{{ document.securityLevel }}등급</td>
        </tr>
        <tr>
          <td class="pc-table-title" colspan="1">기안 일시</td>
          <td class="pc-table-detail" colspan="4">{{ document.draftDatetime | date:"Y.m.d. H:i:s" }}</td>
          <td class="pc-table-title" colspan="1">완료 일시</td>
          <td class="pc-table-detail" colspan="4">{{ document.approveDatetime | date:"Y.m.d. H:i:s" }}</td>
        </tr>
        <tr class="pc-table-title" id="applyProcess">
          <td rowspan="3">신청</td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="3">승인</td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
        </tr>
        <tr>
          <td rowspan="1" height="80px"></td>
          <td rowspan="1" height="80px"></td>
          <td rowspan="1" height="80px"></td>
          <td rowspan="1" height="80px"></td>
          <td rowspan="1" height="80px"></td>
          <td rowspan="1" height="80px"></td>
          <td rowspan="1" height="80px"></td>
          <td rowspan="1" height="80px"></td>
        </tr>
        <tr>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
          <td rowspan="1"></td>
        </tr>
        <tr id="reference">
           <td colspan="1" class="pc-table-title">참조</td>
           <td colspan="9"><input class="form-control empName magicsearch"></td>
        </tr>
        </tbody>
      </table>

      <div class="mt-3 ml-3 text-gray-900">
        <h4 class="mb-4">{{ document.title }}</h4>
        {{ document.contentHtml | safe }}
        <br><hr><br>
        <div class="row">
          <div class="col-6">
            <b>첨부파일</b>
            {% for f in files %}
              <br><a href="/media/{{ f.file }}" download>{{ f.fileName }} ({{ f.fileSize }}MB)</a>
            {% endfor %}
          </div>
          <div class="col-6">
            <b>관련문서</b>
            {% for r in related %}
              <br>
              <a href="/approval/viewdocument/{{ r.relatedDocumentId.documentId }}" target="_blank">
                [{{ r.relatedDocumentId.documentNumber }}]
                {{ r.relatedDocumentId.title }}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock %}


{% block script %}
  <script type="text/javascript">
  $(document).ready(function () {
    $('.empName').magicsearch({
                  dataSource: {{ empNames|safe }},
                  fields: 'name',
                  id: 'id',
                  multiple: true,
                  multiField: 'name',
                  format: '%name% %position% (%dept%)',
                  multiStyle: {space: 5, width: 80},
                  noResult: '검색결과없음',
                  focusShow: false,
              });
  })
  </script>
{% endblock %}
