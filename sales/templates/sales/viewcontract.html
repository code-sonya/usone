{% extends "dashboard/layout.html" %}
{% load humanize %}

{% block title %}
  영업관리
{% endblock %}


{% block css %}

  <style type="text/css">
    .flow-table {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .flow-table td, .flow-table th {
      padding: 5px 15px;
      text-align: center;
      vertical-align: middle;
      font-size: 17px;
      border-top: 0px dotted #858796a3;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap
    }

    .pc-table {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .pc-table td, .pc-table th {
      padding: 5px 15px;
      text-align: center;
      vertical-align: middle;
      font-size: 17px;
      border-top: 1px dotted #858796a3;
    }

    .pc-table-main {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .pc-table-main td, .pc-table-main th {
      padding: 5px;
      text-align: center;
      vertical-align: middle;
      font-size: 18px;
      border-top: 1px dotted #858796a3;
    }

    .mobile-table {
      color: #333333;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .mobile-table td, .mobile-table th {
      padding: 5px 10px;
      text-align: center;
      vertical-align: middle;
      font-size: 14px;
      border-top: 1px dotted #858796a3;
    }

    .thtd {
      text-align: center;
      border: 1px solid lightgray;
      border-collapse: collapse;
    }

    .td-img {
      max-width: 40%;
      height: auto;
    }

    .file-table {
      color: #333333;
      width: 100%;
      margin-bottom: 2rem;
    }

    .file-table td, .file-table th {
      padding: .75rem;
      vertical-align: middle;
      border-bottom: 1px solid #e3e6f0;
      font-size: 14px;
      text-align: center;
      white-space: nowrap;
    }

  </style>

{% endblock %}


{% block content %}

  <div class="d-none d-lg-block">
    <div class="card shadow mb-4">
      <div>
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h3 class="m-0 text-gray-800"> [{{ contract.contractCode }}] {{ contract.contractName }} </h3>
          <div style="font-size: 14px">
            {% if contract.writeEmpId and contract.writeDatetime %}
            작성 : {{ contract.writeEmpId }} ({{ contract.writeDatetime | date:"Y.m.d H:i" }})<br>
            {% endif %}
            {% if contract.editEmpId and contract.editDatetime %}
            수정 : {{ contract.editEmpId }} ({{ contract.editDatetime | date:"Y.m.d H:i" }})
            {% endif %}
          </div>
        </div>

        <div class="card-body">

          <div class="d-flex align-items-center justify-content-between mb-3">
            <h5 class="text-dark mb-3"><b>
              <span id="processDown" onclick="downClick('process', 'processUp', 'processDown')">▼</span>
              <span id="processUp" class="d-none" onclick="upClick('process', 'processUp', 'processDown')">▶</span>
              진행단계
            </b>
            </h5>
            <div class="input-group" style="width: 300px;">
              <select id="documentType" class="form-control">
                <option>수주통보서</option>
                <option>매출발행</option>
                <option>선발주</option>
              </select>
              <button class="btn btn-secondary" onclick="post_document()">결재</button>&nbsp;&nbsp;
              <button class="btn btn-warning" onclick="show_document()">문서함</button>
            </div>
          </div>

          <table id="process" class="flow-table">
            <tr>
              <td>
                <b>매입견적서</b>
                <a href="#" onclick="open_upload('매입견적서')"><i class="fas fa-paperclip"></i></a>
              </td>
              <td>
                <b>매출견적서</b>
                <a href="#" onclick="open_upload('매출견적서')"><i class="fas fa-paperclip"></i></a>
              </td>
              <td>
                <b>계약서</b>
                <a href="#" onclick="open_upload('계약서')"><i class="fas fa-paperclip"></i></a>
              </td>
              <td>
                <a href="/sales/viewordernotipdf/{{ contract.contractId }}/" onclick=""><i class="far fa-file-pdf"></i></a>
                <b>수주통보서</b>
                <a href="#" onclick="open_upload('수주통보서')"><i class="fas fa-paperclip"></i></a>
              </td>
              <td>
                <b>매입발주서</b>
                <a href="#" onclick="open_upload('매입발주서')"><i class="fas fa-paperclip"></i></a>
              </td>
              <td>
                <a data-toggle="modal" data-target="#confirmModal" class="text-success"><i class="fas fa-pen-alt"></i></a>
                <b>납품,구축,검수확인서</b>
                <a href="#" onclick="open_upload('납품,구축,검수확인서')"><i class="fas fa-paperclip"></i></a>
              </td>
              <td>
                <b>매출발행</b>
                <a href="#" onclick="open_upload('매출발행')"><i class="fas fa-paperclip"></i></a>
              </td>
            </tr>
            <tr>
              <td><a href="#" onclick="open_download('매입견적서')">
                {% if files_a|length == 0 %}
                  <img class="td-img" src="/media/icon/prepare_grey.png"><br>
                {% elif files_a|length == 1 %}
                  <img class="td-img" src="/media/icon/prepare1.png"><br>
                {% elif files_a|length == 2 %}
                  <img class="td-img" src="/media/icon/prepare2.png"><br>
                {% elif files_a|length == 3 %}
                  <img class="td-img" src="/media/icon/prepare3.png"><br>
                {% elif files_a|length == 4 %}
                  <img class="td-img" src="/media/icon/prepare4.png"><br>
                {% elif files_a|length > 5 %}
                  <img class="td-img" src="/media/icon/prepare5.png"><br>
                {% endif %}
              </a></td>
              <td><a href="#" onclick="open_download('매출견적서')">
                {% if files_b|length == 0 %}
                  <img class="td-img" src="/media/icon/prepare_grey.png"><br>
                {% elif files_b|length == 1 %}
                  <img class="td-img" src="/media/icon/prepare1.png"><br>
                {% elif files_b|length == 2 %}
                  <img class="td-img" src="/media/icon/prepare2.png"><br>
                {% elif files_b|length == 3 %}
                  <img class="td-img" src="/media/icon/prepare3.png"><br>
                {% elif files_b|length == 4 %}
                  <img class="td-img" src="/media/icon/prepare4.png"><br>
                {% elif files_b|length > 5 %}
                  <img class="td-img" src="/media/icon/prepare5.png"><br>
                {% endif %}
              </a></td>
              <td><a href="#" onclick="open_download('계약서')">
                {% if files_c|length == 0 %}
                  <img class="td-img" src="/media/icon/prepare_grey.png"><br>
                {% elif files_c|length == 1 %}
                  <img class="td-img" src="/media/icon/prepare1.png"><br>
                {% elif files_c|length == 2 %}
                  <img class="td-img" src="/media/icon/prepare2.png"><br>
                {% elif files_c|length == 3 %}
                  <img class="td-img" src="/media/icon/prepare3.png"><br>
                {% elif files_c|length == 4 %}
                  <img class="td-img" src="/media/icon/prepare4.png"><br>
                {% elif files_c|length > 5 %}
                  <img class="td-img" src="/media/icon/prepare5.png"><br>
                {% endif %}
              </a></td>
              <td><a href="#" onclick="open_download('수주통보서')">
                {% if files_d|length == 0 %}
                  <img class="td-img" src="/media/icon/ordernoti_grey.png"><br>
                {% elif files_d|length == 1 %}
                  <img class="td-img" src="/media/icon/ordernoti1.png"><br>
                {% elif files_d|length == 2 %}
                  <img class="td-img" src="/media/icon/ordernoti2.png"><br>
                {% elif files_d|length == 3 %}
                  <img class="td-img" src="/media/icon/ordernoti3.png"><br>
                {% elif files_d|length == 4 %}
                  <img class="td-img" src="/media/icon/ordernoti4.png"><br>
                {% elif files_d|length > 5 %}
                  <img class="td-img" src="/media/icon/ordernoti5.png"><br>
                {% endif %}
              </a></td>
              <td><a href="#" onclick="open_download('매입발주서')">
                {% if files_e|length == 0 %}
                  <img class="td-img" src="/media/icon/ordernoti_grey.png"><br>
                {% elif files_e|length == 1 %}
                  <img class="td-img" src="/media/icon/ordernoti1.png"><br>
                {% elif files_e|length == 2 %}
                  <img class="td-img" src="/media/icon/ordernoti2.png"><br>
                {% elif files_e|length == 3 %}
                  <img class="td-img" src="/media/icon/ordernoti3.png"><br>
                {% elif files_e|length == 4 %}
                  <img class="td-img" src="/media/icon/ordernoti4.png"><br>
                {% elif files_e|length > 5 %}
                  <img class="td-img" src="/media/icon/ordernoti5.png"><br>
                {% endif %}
              </a></td>
              <td><a href="#" onclick="open_download('납품,구축,검수확인서')">
                {% if files_f|length == 0 %}
                  <img class="td-img" src="/media/icon/ordermail_grey.png"><br>
                {% elif files_f|length == 1 %}
                  <img class="td-img" src="/media/icon/ordermail1.png"><br>
                {% elif files_f|length == 2 %}
                  <img class="td-img" src="/media/icon/ordermail2.png"><br>
                {% elif files_f|length == 3 %}
                  <img class="td-img" src="/media/icon/ordermail3.png"><br>
                {% elif files_f|length == 4 %}
                  <img class="td-img" src="/media/icon/ordermail4.png"><br>
                {% elif files_f|length > 5 %}
                  <img class="td-img" src="/media/icon/ordermail5.png"><br>
                {% endif %}
              </a></td>
              <td><a href="#" onclick="open_download('매출발행')">
                {% if files_g|length == 0 %}
                  <img class="td-img" src="/media/icon/ordermail_grey.png"><br>
                {% elif files_g|length == 1 %}
                  <img class="td-img" src="/media/icon/ordermail1.png"><br>
                {% elif files_g|length == 2 %}
                  <img class="td-img" src="/media/icon/ordermail2.png"><br>
                {% elif files_g|length == 3 %}
                  <img class="td-img" src="/media/icon/ordermail3.png"><br>
                {% elif files_g|length == 4 %}
                  <img class="td-img" src="/media/icon/ordermail4.png"><br>
                {% elif files_g|length > 5 %}
                  <img class="td-img" src="/media/icon/ordermail5.png"><br>
                {% endif %}
              </a></td>
            </tr>
          </table>

          <h5 class="text-dark mb-3"><b>
            <span id="contractDown" onclick="downClick('contract', 'contractUp', 'contractDown')">▼</span>
            <span id="contractUp" class="d-none" onclick="upClick('contract', 'contractUp', 'contractDown')">▶</span>
            계약내용
          </b></h5>
          <table class="pc-table" id="contract">
            <tbody>
            <tr>
              <td class="bg-light" style="width: 20%; border-top: 0px;">단&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;계</td>
              <td style="width: 30%; border-top: 0px;" class="text-left pl-4">
                {% if contract.contractStep == "Firm" %}
                  <div class="text-primary"> {{ contract.contractStep }}</div>
                {% elif contract.contractStep == "Drop" %}
                  <div class="text-danger"> {{ contract.contractStep }}</div>
                {% else %}
                  <div class="text-success"> {{ contract.contractStep }}</div>
                {% endif %}
              </td>
              <td class="bg-light" style="width: 20%; border-top: 0px;">영&nbsp; 업&nbsp; &nbsp;담&nbsp; 당</td>
              <td style="width: 30%; border-top: 0px;" class="text-left pl-4">{{ contract.empName }} ({{ contract.empDeptName }})</td>
            </tr>
            <tr>
              <td class="bg-light">판&nbsp; 매&nbsp; &nbsp;유&nbsp; 형</td>
              <td class="text-left pl-4">{{ contract.saleType }}</td>
              <td class="bg-light">산&nbsp; &nbsp; &nbsp;업&nbsp; &nbsp; &nbsp;군</td>
              <td class="text-left pl-4">{{ contract.saleIndustry }}</td>
            </tr>
            <tr>
              <td class="bg-light">대&nbsp; &nbsp; &nbsp;분&nbsp; &nbsp; &nbsp;류</td>
              <td class="text-left pl-4">{{ contract.mainCategory }}</td>
              <td class="bg-light">소&nbsp; &nbsp; &nbsp;분&nbsp; &nbsp; &nbsp;류</td>
              <td class="text-left pl-4">{{ contract.subCategory }}</td>
            </tr>
            <tr>
              <td class="bg-light">거&nbsp; &nbsp; &nbsp;래&nbsp; &nbsp; &nbsp;처</td>
              <td class="text-left pl-4">
                <a href="/client/viewclient/{{ contract.saleCompanyName.companyName }}" class="text-dark">
                  {{ contract.saleCompanyName.companyNameKo }}
                </a>
                <a href="/client/viewcustomer/{{ contract.saleCustomerId.customerId }}" class="text-dark">
                  {% if contract.saleCustomerName %} (영업담당자:{{ contract.saleCustomerName }}){% endif %}
                </a>
                <a href="/client/viewcustomer/{{ contract.saleTaxCustomerId.customerId }}" class="text-dark">
                  {% if contract.saleTaxCustomerName %} (세금담당자:{{ contract.saleTaxCustomerName }}){% endif %}
                </a>
              </td>
              <td class="bg-light">최 종 고 객 사</td>
              <td class="text-left pl-4">
                <a href="/client/viewclient/{{ contract.endCompanyName.companyName }}" class="text-dark">
                  {{ contract.endCompanyName.companyNameKo }}
                </a>
              </td>
            </tr>
            <tr>
              <td class="bg-light">계&nbsp; 약&nbsp; &nbsp;금&nbsp; 액</td>
              <td class="text-primary font-weight-bold text-left pl-4">{{ contract.salePrice | intcomma }}</td>
              <td class="bg-light">이&nbsp; 익&nbsp; &nbsp;금&nbsp; 액</td>
              <td class="text-danger font-weight-bold text-left pl-4">{{ contract.profitPrice | intcomma }} ({{ contract.profitRatio | floatformat }}%)</td>
            </tr>
            <tr>
              <td class="bg-light">계&nbsp; &nbsp; &nbsp;약&nbsp; &nbsp; &nbsp;일</td>
              <td class="text-left pl-4">{{ contract.contractDate }}</td>
              <td class="bg-light">계&nbsp; 약&nbsp; &nbsp;기&nbsp; 간</td>
              <td class="text-left pl-4">
                {% if contract.contractStep == 'Firm' and contract.contractStartDate %}{{ contract.contractStartDate }} ~ {{ contract.contractEndDate }}{% else %}-{% endif %}</td>
            </tr>
            <tr>
              <td class="bg-light">수&nbsp; 금&nbsp; &nbsp;조&nbsp; 건</td>
              <td class="text-left pl-4">{% if contract.depositCondition %}{{ contract.depositCondition }}{% else %}-{% endif %}
                {% if contract.depositCondition == '계산서 발행 후' %} {{ contract.depositConditionDay }}일 이내{% endif %}</td>
              <td class="bg-light">수 주 통 보 서</td>
              <td class="text-left pl-4"><a href="/media/{{ contract.orderPaper }}" download>{{ orderPaper }}</a></td>
              {#              계약서는 추후 필요시 오픈#}
              {#              <td class="bg-light">첨&nbsp; 부&nbsp; &nbsp;파&nbsp; 일</td>#}
              {#              <td><a href="/media/{{ contract.contractPaper }}" download>{{ contractPaper }}</a><br><a href="/media/{{ contract.orderPaper }}" download>{{ orderPaper }}</a></td>#}
            </tr>
            <tr>
              <td class="bg-light">수&nbsp; 정&nbsp; &nbsp;대&nbsp; 상</td>
              <td class="text-left pl-4">{{ contract.modifyContractPaper }}</td>
              <td class="bg-light">참&nbsp; 고&nbsp; &nbsp;사&nbsp; 항</td>
              <td style="padding-left: 20px;" class="text-left pl-4">{% if contract.comment == None %} {% else %}{{ contract.comment }}{% endif %}</td>
            </tr>
            </tbody>
          </table>

          {% if items %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="categoryItemDown" onclick="downClick('categoryItem', 'categoryItemUp', 'categoryItemDown')">▼</span>
              <span id="categoryItemUp" class="d-none" onclick="upClick('categoryItem', 'categoryItemUp', 'categoryItemDown')">▶</span>
              세부사항
            </b></h5>
            <table class="pc-table" id="categoryItem">
              <thead>
              <tr class="bg-secondary">
                <td class="text-gray-100">대분류</td>
                <td class="text-gray-100">소분류</td>
                <td class="text-gray-100">상세내용</td>
                <td class="text-gray-100">가격</td>
              </tr>
              </thead>
              <tbody>
              {% for item in items %}
                <tr class="thtd">
                  <td>{{ item.mainCategory }}</td>
                  <td>{{ item.subCategory }}</td>
                  <td>{{ item.itemName }}</td>
                  <td>{{ item.itemPrice | intcomma }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          {% endif %}

          {% if contract.contractStep != 'Drop' %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="yearSummaryDown" onclick="downClick('yearSummary', 'yearSummaryUp', 'yearSummaryDown')">▼</span>
              <span id="yearSummaryUp" class="d-none" onclick="upClick('yearSummary', 'yearSummaryUp', 'yearSummaryDown')">▶</span>
              연도 별 매출·이익 기여도
            </b></h5>
            <table class="pc-table" id="yearSummary">
              <thead>
              <tr class="bg-secondary">
                <td class="text-gray-100">연도</td>
                <td class="text-gray-100">매출금액</td>
                <td class="text-gray-100">매입금액</td>
                <td class="text-gray-100">이익금액</td>
                <td class="text-gray-100">수금액</td>
                <td class="text-gray-100">지급액</td>
              </tr>
              </thead>
              <tbody>
              {% for summary in yearSummary %}
                <tr class="thtd">
                  <td>{{ summary.year }}</td>
                  <td>{{ summary.revenuePrice | intcomma }}</td>
                  <td>{{ summary.purchasePrice | intcomma }}</td>
                  <td>{{ summary.revenueProfitPrice | intcomma }} ({{ summary.revenueProfitRatio }}%)</td>
                  <td>{{ summary.depositPrice | intcomma }} ({{ summary.depositRatio }}%)</td>
                  <td>{{ summary.withdrawPrice | intcomma }} ({{ summary.withdrawRatio }}%)</td>
                </tr>
              {% endfor %}
              <tr class="thtd bg-light">
                <td>{{ yearSum.year }}</td>
                <td class="text-primary">{{ yearSum.revenuePrice | intcomma }}</td>
                <td class="text-success">{{ yearSum.purchasePrice | intcomma }}</td>
                <td class="text-danger">{{ yearSum.revenueProfitPrice | intcomma }} ({{ yearSum.revenueProfitRatio }}%)</td>
                <td>{{ yearSum.depositPrice | intcomma }} ({{ yearSum.depositRatio }}%)</td>
                <td>{{ yearSum.withdrawPrice | intcomma }} ({{ yearSum.withdrawRatio }}%)</td>
              </tr>
              </tbody>
            </table>

            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="cashDown" onclick="downClick('cash', 'cashUp', 'cashDown')">▼</span>
              <span id="cashUp" class="d-none" onclick="upClick('cash', 'cashUp', 'cashDown')">▶</span>
              입출금정보 (세금계산서 발행 및 접수 내역만 표기)
            </b></h5>
            <div id="cash">
              <table style="margin-left:20px">
                <tbody>
                <tr>
                  <td style="width: 40%;">총 수금액</td>
                  <td style="width: 40%; text-align: right;">{{ totalDeposit | intcomma }}</td>
                </tr>
                <tr>
                  <td style="width: 40%;">총 지급액</td>
                  <td style="width: 40%; text-align: right;">{{ totalWithdraw | intcomma }}</td>
                </tr>
                <tr>
                  <td style="width: 40%;">총 집행률</td>
                  <td style="width: 40%; text-align: right;">{{ totalRatio }}%</td>
                </tr>
                </tbody>
              </table>
              <br>
              <div class="row">
                <div class="col-xl-6">
                  <table class="pc-table">
                    <thead>
                    <tr class="bg-secondary">
                      <td class="text-gray-100" width="30%">매출처</td>
                      <td class="text-gray-100" width="25%">매출금액</td>
                      <td class="text-gray-100" width="25%">수금액</td>
                      <td class="text-gray-100" width="20%">수금률</td>
                    </tr>
                    </thead>
                    <tbody>
                    {% for deposit in companyDeposit %}
                      <tr class="thtd">
                        <td>{% if deposit.revenueCompany__companyNameKo == None %}-{% else %}{{ deposit.revenueCompany__companyNameKo }}{% endif %}</td>
                        <td>{% if deposit.sum_deposit == None %}0{% else %}{{ deposit.sum_deposit | intcomma }} {% endif %}</td>
                        <td>{% if deposit.filter_deposit == None %}0{% else %}{{ deposit.filter_deposit | intcomma }} {% endif %}</td>
                        <td>{% if deposit.ratio_deposit == None %}0{% else %}{{ deposit.ratio_deposit }}{% endif %}%</td>
                      </tr>
                    {% endfor %}
                    <tr class="thtd bg-light">
                      <td>합계</td>
                      <td>{% if companyTotalDeposit.total_sum_deposit == None %}0{% else %}{{ companyTotalDeposit.total_sum_deposit | intcomma }} {% endif %}</td>
                      <td>{% if companyTotalDeposit.total_filter_deposit == None %}0{% else %}{{ companyTotalDeposit.total_filter_deposit | intcomma }} {% endif %}</td>
                      <td>{% if companyTotalDeposit.total_ratio_deposit == None %}0{% else %}{{ companyTotalDeposit.total_ratio_deposit }}{% endif %}%</td>
                    </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-xl-6">
                  <table class="pc-table">
                    <thead>
                    <tr class="bg-secondary">
                      <td class="text-gray-100" width="30%">매입처</td>
                      <td class="text-gray-100" width="27%">매입금액</td>
                      <td class="text-gray-100" width="23%">지급액</td>
                      <td class="text-gray-100" width="20%">지급률</td>
                    </tr>
                    </thead>
                    <tbody>
                    {% for withdraw in companyWithdraw %}
                      <tr class="thtd">
                        <td class="text-left">{% if withdraw.purchaseCompany__companyNameKo == None %}-{% else %}{{ withdraw.purchaseCompany__companyNameKo }}{% endif %}</td>
                        <td class="text-right">{% if withdraw.sum_withdraw == None %}0{% else %}{{ withdraw.sum_withdraw | intcomma }}
                          <span style="display: inline-block; width: 60px;">({{ withdraw.sum_ratio_withdraw }}%)</span>{% endif %}</td>
                        <td class="text-right">{% if withdraw.filter_withdraw == None %}0{% else %}{{ withdraw.filter_withdraw | intcomma }} {% endif %}</td>
                        <td>{% if withdraw.ratio_withdraw == None %}0{% else %}{{ withdraw.ratio_withdraw }}{% endif %}%</td>
                      </tr>
                    {% endfor %}
                    <tr class="thtd bg-light">
                      <td>합계</td>
                      <td class="text-right">{% if companyTotalWithdraw.total_sum_withdraw == None %}0{% else %}{{ companyTotalWithdraw.total_sum_withdraw | intcomma }}
                        <span style="display: inline-block; width: 60px;"></span>{% endif %}</td>
                      <td class="text-right">{% if companyTotalWithdraw.total_filter_withdraw == None %}0{% else %}{{ companyTotalWithdraw.total_filter_withdraw | intcomma }}{% endif %}</td>
                      <td>{% if companyTotalWithdraw.total_ratio_withdraw == None %}0{% else %}{{ companyTotalWithdraw.total_ratio_withdraw }}{% endif %}%</td>
                    </tr>
                    </tbody>
                  </table>
                  ※ 세금계산서 접수 내역만 표기 (제외항목 : 인건비, 프로젝트비용 등)<br>
                  연도 별 매출·이익 기여도의 매입금액 합계와 입출금정보 매입처 지급액 합계는 오차가 발생할 수 있음.
                </div>
              </div>
            </div>
          {% endif %}

          {% if revenues %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="revenuesDown" onclick="downClick('revenuesdiv', 'revenuesUp', 'revenuesDown')">▼</span>
              <span id="revenuesUp" class="d-none" onclick="upClick('revenuesdiv', 'revenuesUp', 'revenuesDown')">▶</span>
              매출세부정보
            </b></h5>
            <div class="table-responsive" id="revenuesdiv">
              <table id="revenues" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                <thead>
                <tr class="bg-primary">
                  <td class="text-gray-100" width="5%">회차</td>
                  <td class="text-gray-100" width="10%">매출예정일</td>
                  <td class="text-gray-100" width="10%">매출일</td>
                  <td class="text-gray-100" width="10%">수금예정일</td>
                  <td class="text-gray-100" width="10%">수금일</td>
                  <td class="text-gray-100" width="15%">매출처</td>
                  <td class="text-gray-100" width="12%">매출금액</td>
                  <td class="text-gray-100" width="13%">이익금액</td>
                  <td class="text-gray-100" width="15%">비고</td>
                  <th class="d-none">revenueId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>
            </div>
          {% endif %}

          {% if purchases or costs %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="purchasesDown" onclick="downClick('purchasesdiv', 'purchasesUp', 'purchasesDown')">▼</span>
              <span id="purchasesUp" class="d-none" onclick="upClick('purchasesdiv', 'purchasesUp', 'purchasesDown')">▶</span>
              매입세부정보
            </b></h5>
            <div class="table-responsive" id="purchasesdiv">
              <h5 class="text-dark mb-3"><b>(세금계산서 접수항목)</b></h5>
              <table id="purchases" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                <thead>
                <tr class="bg-primary">
                  <td class="text-gray-100" width="5%">회차</td>
                  <td class="text-gray-100" width="10%">매입예정일</td>
                  <td class="text-gray-100" width="10%">매입일</td>
                  <td class="text-gray-100" width="10%">지급예정일</td>
                  <td class="text-gray-100" width="10%">지급일</td>
                  <td class="text-gray-100" width="15%">매입처</td>
                  <td class="text-gray-100" width="12%">매입금액</td>
                  <td class="text-gray-100" width="15%">비고</td>
                  <th class="d-none">purchaseId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>

              {% if costs %}
              <h5 class="text-dark mb-3"><b>(세금계산서 미접수항목)</b></h5>
              <table id="costs" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                <thead>
                <tr class="bg-primary">
                  <td class="text-gray-100" width="5%"></td>
                  <td class="text-gray-100" width="10%"></td>
                  <td class="text-gray-100" width="10%"></td>
                  <td class="text-gray-100" width="10%"></td>
                  <td class="text-gray-100" width="10%">연도</td>
                  <td class="text-gray-100" width="15%">매입항목</td>
                  <td class="text-gray-100" width="12%">매입금액</td>
                  <td class="text-gray-100" width="15%">비고</td>
                  <th class="d-none">costId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>
              {% endif %}
            </div>
          {% endif %}

          <br>
            <h5 class="text-dark mb-3"><b>
              <span id="detailsDown" onclick="downClick('detailsdiv', 'detailsUp', 'detailsDown')">▼</span>
              <span id="detailsUp" class="d-none" onclick="upClick('detailsdiv', 'detailsUp', 'detailsDown')">▶</span>
              하도급계약정보
            </b></h5>
            <div class="table-responsive" id="detailsdiv">
              <div class="row">
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>1. 상품_HW</b></div>
                  <table id="goodsHW" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="30%">거래처</th>
                        <th class="text-gray-100 font-weight-normal" width="40%">내역</th>
                        <th class="text-gray-100 font-weight-normal" width="30%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>2. 상품_SW</b></div>
                  <table id="goodsSW" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="30%">거래처</th>
                        <th class="text-gray-100 font-weight-normal" width="40%">내역</th>
                        <th class="text-gray-100 font-weight-normal" width="30%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>3. 유지보수_HW</b></div>
                  <table id="maintenanceHW" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="30%">거래처</th>
                        <th class="text-gray-100 font-weight-normal" width="40%">내역</th>
                        <th class="text-gray-100 font-weight-normal" width="30%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>4. 유지보수_SW</b></div>
                  <table id="maintenanceSW" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="30%">거래처</th>
                        <th class="text-gray-100 font-weight-normal" width="40%">내역</th>
                        <th class="text-gray-100 font-weight-normal" width="30%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>5. 인력지원_자사</b></div>
                  <table id="supportInternal" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="30%">구분</th>
                        <th class="text-gray-100 font-weight-normal" width="15%">횟수</th>
                        <th class="text-gray-100 font-weight-normal" width="15%">사이트수</th>
                        <th class="text-gray-100 font-weight-normal" width="20%">단가</th>
                        <th class="text-gray-100 font-weight-normal" width="20%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>6. 인력지원_타사</b></div>
                  <table id="supportExternal" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="30%">구분</th>
                        <th class="text-gray-100 font-weight-normal" width="40%">내역</th>
                        <th class="text-gray-100 font-weight-normal" width="30%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>7. DB COSTS</b></div>
                  <table id="dbCosts" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="20%">계약번호</th>
                        <th class="text-gray-100 font-weight-normal" width="30%">계약시작일</th>
                        <th class="text-gray-100 font-weight-normal" width="30%">계약종료일</th>
                        <th class="text-gray-100 font-weight-normal" width="20%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-xl-6 mb-2">
                  <div class="text-dark mb-0"><b>8. 기타</b></div>
                  <table id="others" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                    <thead>
                      <tr class="bg-secondary">
                        <th class="text-gray-100 font-weight-normal" width="30%">구분</th>
                        <th class="text-gray-100 font-weight-normal" width="40%">내역</th>
                        <th class="text-gray-100 font-weight-normal" width="40%">금액</th>
                        <th class="d-none">typeId</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th style="padding: 8px 10px; text-align: right"></th>
                        <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                        <th style="padding: 8px 10px; text-align: center"></th>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

          {% if services %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="servicesDown" onclick="downClick('servicesdiv', 'servicesUp', 'servicesDown')">▼</span>
              <span id="servicesUp" class="d-none" onclick="upClick('servicesdiv', 'servicesUp', 'servicesDown')">▶</span>
              엔지니어 지원 이력
            </b></h5>
            <div class="table-responsive" id="servicesdiv">
              <table id="services" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                <thead>
                <tr class="bg-info">
                  <th class="text-gray-100 font-weight-normal">엔지니어</th>
                  <th class="text-gray-100 font-weight-normal">구분</th>
                  <th class="text-gray-100 font-weight-normal">날짜</th>
                  <th class="text-gray-100 font-weight-normal">작업내용</th>
                  <th class="text-gray-100 font-weight-normal">일반근무시간</th>
                  <th class="text-gray-100 font-weight-normal">초과근무시간</th>
                  <th class="text-gray-100 font-weight-normal">기본수당</th>
                  <th class="text-gray-100 font-weight-normal">시간외수당</th>
                  <th class="d-none">serviceId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: center"></th>
                  <th style="padding: 8px 10px; text-align: center"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>
            </div>
          {% endif %}
        </div>
      </div>

      {% if user.employee.empDeptName == '경영지원본부' or user.is_staff %}
        <div class="text-center" style="padding: 0px 20px 20px 20px">
          <a href="#" class="btn btn-danger btn-icon-split" onclick="btn_delete()">
            <span class="icon text-white-50"> <i class="fas fa-trash-alt"> </i> </span>
            <span class="text"> 삭제 </span>
          </a>
          <a href="#" class="btn btn-info btn-icon-split" onclick="btn_modify()">
            <span class="icon text-white-50"> <i class="fas fa-edit"> </i> </span>
            <span class="text"> 수정 </span>
          </a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- file upload modal -->
  <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">

        <div class="modal-header bg-info text-gray-100">
          <h5 class="modal-title" id="uploadModalLabel">첨부파일 등록</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span class="text-gray-100" aria-hidden="true">×</span>
          </button>
        </div>

        <div class="modal-body">
          <form id="uploadForm" method="POST" enctype="multipart/form-data"
                action="/sales/savecontractfiles/{{ contract.contractId }}/">
            {% csrf_token %}
          </form>
          <span id="fileType" class="d-none"></span>
          <table class="file-table">
            <thead>
            <tr>
              <td width="65%"><b>파일명</b></td>
              <td width="20%"><b>파일크기</b></td>
              <td width="15%">
                <label class="m-0 btn btn-info btn-icon-split">
                  <span class="icon text-white-100"><i class="fas fa-file-upload"></i></span>
                  <input id="files" name="files" type="file" multiple="multiple" class="d-none" onchange=file_names(this.id)>
                </label>
              </td>
            </tr>
            </thead>
            <tbody id="filesTbody">
            </tbody>
          </table>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
          <a class="btn btn-info" href="#" onclick="btn_upload()">등록</a>
        </div>
      </div>
    </div>
  </div>

  <!-- file download modal -->
  <div class="modal fade" id="downloadModal" tabindex="-1" role="dialog" aria-labelledby="downloadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">

        <div class="modal-header bg-info text-gray-100">
          <h5 class="modal-title" id="downloadModalLabel">첨부파일 다운로드</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span class="text-gray-100" aria-hidden="true">×</span>
          </button>
        </div>

        <div class="modal-body">
          <table class="file-table">
            <thead>
            <tr>
              <td width="20%"><b>일시</b></td>
              <td width="20%"><b>작성자</b></td>
              <td width="40%"><b>파일명</b></td>
              <td width="20%"><b>파일크기</b></td>
            </tr>
            </thead>
            <tbody>
            {% for f in files_a %}
              <tr name="filesA" class="d-none">
                <td>{{ f.uploadDatetime | date:"Y.m.d H:i" }}</td>
                <td>{{ f.uploadEmp.empName }}</td>
                <td class="text-left"><a href="/media/{{ f.file }}" download>{{ f.fileName }}</a></td>
                <td class="text-right">{{ f.fileSize }} MB</td>
              </tr>
            {% endfor %}
            {% for f in files_b %}
              <tr name="filesB" class="d-none">
                <td>{{ f.uploadDatetime | date:"Y.m.d H:i" }}</td>
                <td>{{ f.uploadEmp.empName }}</td>
                <td class="text-left"><a href="/media/{{ f.file }}" download>{{ f.fileName }}</a></td>
                <td class="text-right">{{ f.fileSize }} MB</td>
              </tr>
            {% endfor %}
            {% for f in files_c %}
              <tr name="filesC" class="d-none">
                <td>{{ f.uploadDatetime | date:"Y.m.d H:i" }}</td>
                <td>{{ f.uploadEmp.empName }}</td>
                <td class="text-left"><a href="/media/{{ f.file }}" download>{{ f.fileName }}</a></td>
                <td class="text-right">{{ f.fileSize }} MB</td>
              </tr>
            {% endfor %}
            {% for f in files_d %}
              <tr name="filesD" class="d-none">
                <td>{{ f.uploadDatetime | date:"Y.m.d H:i" }}</td>
                <td>{{ f.uploadEmp.empName }}</td>
                <td class="text-left"><a href="/media/{{ f.file }}" download>{{ f.fileName }}</a></td>
                <td class="text-right">{{ f.fileSize }} MB</td>
              </tr>
            {% endfor %}
            {% for f in files_e %}
              <tr name="filesE" class="d-none">
                <td>{{ f.uploadDatetime | date:"Y.m.d H:i" }}</td>
                <td>{{ f.uploadEmp.empName }}</td>
                <td class="text-left"><a href="/media/{{ f.file }}" download>{{ f.fileName }}</a></td>
                <td class="text-right">{{ f.fileSize }} MB</td>
              </tr>
            {% endfor %}
            {% for f in files_f %}
              <tr name="filesF" class="d-none">
                <td>{{ f.uploadDatetime | date:"Y.m.d H:i" }}</td>
                <td>{{ f.uploadEmp.empName }}</td>
                <td class="text-left"><a href="/media/{{ f.file }}" download>{{ f.fileName }}</a></td>
                <td class="text-right">{{ f.fileSize }} MB</td>
              </tr>
            {% endfor %}
            {% for f in files_g %}
              <tr name="filesG" class="d-none">
                <td>{{ f.uploadDatetime | date:"Y.m.d H:i" }}</td>
                <td>{{ f.uploadEmp.empName }}</td>
                <td class="text-left"><a href="/media/{{ f.file }}" download>{{ f.fileName }}</a></td>
                <td class="text-right">{{ f.fileSize }} MB</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- document modal -->
  <div class="modal fade" id="documentModal" tabindex="-1" role="dialog" aria-labelledby="documentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content">

        <div class="modal-header bg-info text-gray-100">
          <h5 class="modal-title" id="documentModalLabel">문서함</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span class="text-gray-100" aria-hidden="true">×</span>
          </button>
        </div>

        <div class="modal-body">
          <table class="file-table">
            <thead>
            <tr>
              <td width="15%"><b>기안일시</b></td>
              <td width="10%"><b>작성자</b></td>
              <td width="65%"><b>문서명</b></td>
              <td width="10%"><b>상태</b></td>
            </tr>
            </thead>
            <tbody>
              {% for document in documents %}
                <tr>
                  <td>{{ document.draftDatetime | date:"Y.m.d H:i" }}</td>
                  <td>{{ document.writeEmp }}</td>
                  <td class="text-left">
                    <a href="/approval/viewdocument/{{ document.documentId }}" target="_blank">[{{ document.documentNumber }}]</a>
                    {{ document.title }}
                  </td>
                  <td>{{ document.documentStatus }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- confirm modal -->
  <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">

        <div class="modal-header bg-success text-gray-100">
          <h5 class="modal-title" id="confirmModalLabel">납품(설치) 검수확인서 등록</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span class="text-gray-100" aria-hidden="true">×</span>
          </button>
        </div>

        <div class="modal-body">
          <form id="confirmForm" action="/sales/viewconfirmpdf/{{ contract.contractId }}/" method="POST">
            {% csrf_token %}
            <div class="row mb-1">
               <div class="col-6">
                <label for="confirmCustomer" class="text-primary">검수 담당자</label>
                <input name="confirmCustomer" type="text" id="confirmCustomer" class="form-control" value="{{ contract.confirmCustomer }}">
              </div>
              <div class="col-6">
                <label for="confirmDate" class="text-primary">검수 일자</label>
                <input name="confirmDate" type="date" id="confirmDate" class="form-control" max="9999-12-31" value="{{ contract.confirmDate | date:"Y-m-d" }}">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="confirmContents" class="text-primary">내용</label>
                <textarea name="confirmContents" id="confirmContents" class="form-control" style="height: 400px">{{ contract.confirmContents }}</textarea>
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="confirmComment" class="text-primary">비고</label>
                <textarea name="confirmComment" id="confirmComment" class="form-control" style="height: 100px">{{ contract.confirmComment }}</textarea>
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
          <a class="btn btn-success" href="#" onclick="btn_confirm()">pdf생성</a>
        </div>
      </div>
    </div>
  </div>




















  {#모바일화면#}
  <div class="d-lg-none">
    <div class="card shadow mb-4">
      <div>
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h3 class="m-0 text-gray-800">{{ contract.contractName }}</h3>
        </div>

        <div class="card-body">
          <h5 class="text-dark mb-3"><b>
            <span id="contractDownMobile" onclick="downClick('contractMobile', 'contractUpMobile', 'contractDownMobile')">▼</span>
            <span id="contractUpMobile" class="d-none" onclick="upClick('contractMobile', 'contractUpMobile', 'contractDownMobile')">▶</span>
            계약내용
          </b></h5>
          <table class="mobile-table" id="contractMobile">
            <tbody>
            <tr>
              <td class="bg-light" style="width: 40%; border-top: 0px;">단&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;계</td>
              <td style="width: 60%; border-top: 0px;" class="text-left pl-3">
                {% if contract.contractStep == "Firm" %}
                  <div class="text-primary"> {{ contract.contractStep }}</div>
                {% elif contract.contractStep == "Drop" %}
                  <div class="text-danger"> {{ contract.contractStep }}</div>
                {% else %}
                  <div class="text-success"> {{ contract.contractStep }}</div>
                {% endif %}
              </td>
            </tr>
            <tr>
              <td class="bg-light" style="width: 20%; border-top: 0px;">영&nbsp; 업&nbsp; &nbsp;담&nbsp; 당</td>
              <td style="width: 30%; border-top: 0px;" class="text-left pl-3">{{ contract.empName }} ({{ contract.empDeptName }})</td>
            </tr>
            <tr>
              <td class="bg-light">판&nbsp; 매&nbsp; &nbsp;유&nbsp; 형</td>
              <td class="text-left pl-3">{{ contract.saleType }}</td>
            </tr>
            <tr>
              <td class="bg-light">산&nbsp; &nbsp; &nbsp;업&nbsp; &nbsp; &nbsp;군</td>
              <td class="text-left pl-3">{{ contract.saleIndustry }}</td>
            </tr>
            <tr>
              <td class="bg-light">대&nbsp; &nbsp; &nbsp;분&nbsp; &nbsp; &nbsp;류</td>
              <td class="text-left pl-3">{{ contract.mainCategory }}</td>
            </tr>
            <tr>
              <td class="bg-light">소&nbsp; &nbsp; &nbsp;분&nbsp; &nbsp; &nbsp;류</td>
              <td class="text-left pl-3">{{ contract.subCategory }}</td>
            </tr>
            <tr>
              <td class="bg-light">거&nbsp; &nbsp; &nbsp;래&nbsp; &nbsp; &nbsp;처</td>
              <td class="text-left pl-3">
                <a href="/client/viewclient/{{ contract.saleCompanyName.companyName }}" class="text-dark">
                  {{ contract.saleCompanyName.companyNameKo }}
                </a>
                <a href="/client/viewcustomer/{{ contract.saleCustomerId.customerId }}" class="text-dark">
                  {% if contract.saleCustomerName %} ({{ contract.saleCustomerName }}){% endif %}
                </a>
              </td>
            </tr>
            <tr>
              <td class="bg-light">최 종 고 객 사</td>
              <td class="text-left pl-3">
                <a href="/client/viewclient/{{ contract.endCompanyName.companyName }}" class="text-dark">
                  {{ contract.endCompanyName.companyNameKo }}
                </a>
              </td>
            </tr>
            <tr>
              <td class="bg-light">계&nbsp; 약&nbsp; &nbsp;금&nbsp; 액</td>
              <td class="text-primary font-weight-bold text-left pl-3">{{ contract.salePrice | intcomma }}</td>
            </tr>
            <tr>
              <td class="bg-light">이&nbsp; 익&nbsp; &nbsp;금&nbsp; 액</td>
              <td class="text-danger font-weight-bold text-left pl-3">{{ contract.profitPrice | intcomma }} ({{ contract.profitRatio | floatformat }}%)</td>
            </tr>
            <tr>
              <td class="bg-light">계&nbsp; &nbsp; &nbsp;약&nbsp; &nbsp; &nbsp;일</td>
              <td class="text-left pl-3">{{ contract.contractDate }}</td>
            </tr>
            <tr>
              <td class="bg-light">계&nbsp; 약&nbsp; &nbsp;기&nbsp; 간</td>
              <td class="text-left pl-3">
                {% if contract.contractStep == 'Firm' and contract.contractStartDate %}{{ contract.contractStartDate }} ~ {{ contract.contractEndDate }}{% else %}-{% endif %}</td>
            </tr>
            <tr>
              <td class="bg-light">수&nbsp; 금&nbsp; &nbsp;조&nbsp; 건</td>
              <td class="text-left pl-3">{{ contract.depositCondition }}{% if contract.depositCondition == '계산서 발행 후' %}<br> {{ contract.depositConditionDay }}일 이내{% endif %}</td>
            </tr>
            <tr>
              <td class="bg-light">수 주 통 보 서</td>
              <td class="text-left pl-3"><a href="/media/{{ contract.orderPaper }}" download>{{ orderPaper }}</a></td>
              {#              계약서는 추후 필요시 오픈#}
              {#              <td class="bg-light">첨&nbsp; 부&nbsp; &nbsp;파&nbsp; 일</td>#}
              {#              <td><a href="/media/{{ contract.contractPaper }}" download>{{ contractPaper }}</a><br><a href="/media/{{ contract.orderPaper }}" download>{{ orderPaper }}</a></td>#}
            </tr>
            <tr>
              <td class="bg-light">수&nbsp; 정&nbsp; &nbsp;대&nbsp; 상</td>
              <td class="text-left pl-3">{{ contract.modifyContractPaper }}</td>
            </tr>
            <tr>
              <td class="bg-light">참&nbsp; 고&nbsp; &nbsp;사&nbsp; 항</td>
              <td colspan="3" style="padding-left: 20px;" class="text-left pl-3">{% if contract.comment == None %} {% else %}{{ contract.comment }}{% endif %}</td>
            </tr>
            </tbody>
          </table>

          {% if items %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="categoryItemDownMobile" onclick="downClick('categoryItemMobile', 'categoryItemUpMobile', 'categoryItemDownMobile')">▼</span>
              <span id="categoryItemUpMobile" class="d-none" onclick="upClick('categoryItemMobile', 'categoryItemUpMobile', 'categoryItemDownMobile')">▶</span>
              세부사항
            </b></h5>
            <table class="mobile-table" id="categoryItemMobile" style="table-layout:fixed">
              <thead>
              <tr class="bg-secondary">
                <td class="text-gray-100" width="50%">대분류<br>(소분류)</td>
                <td class="text-gray-100" width="50%">가격</td>
              </tr>
              </thead>
              <tbody>
              {% for item in items %}
                <tr class="thtd">
                  <td style="text-overflow: ellipsis; overflow:hidden; white-space: nowrap;">{{ item.mainCategory }}<br>({{ item.subCategory }})</td>
                  <td>{{ item.itemPrice | intcomma }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          {% endif %}

          {% if contract.contractStep != 'Drop' %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="yearSummaryDownMobile" onclick="downClick('yearSummaryMobile', 'yearSummaryUpMobile', 'yearSummaryDownMobile')">▼</span>
              <span id="yearSummaryUpMobile" class="d-none" onclick="upClick('yearSummaryMobile', 'yearSummaryUpMobile', 'yearSummaryDownMobile')">▶</span>
              연도 별 매출·이익 기여도
            </b></h5>
            <table class="mobile-table" id="yearSummaryMobile">
              <thead>
              <tr class="bg-secondary">
                <td class="text-gray-100" width="24%">연도</td>
                <td class="text-gray-100" width="38%">매출금액</td>
                <td class="text-gray-100" width="38%">이익금액<br>(이익률)</td>
              </tr>
              </thead>
              <tbody>
              {% for summary in yearSummary %}
                <tr class="thtd">
                  <td>{{ summary.year }}</td>
                  <td class="text-right">{{ summary.revenuePrice | intcomma }}</td>
                  <td class="text-right">{{ summary.revenueProfitPrice | intcomma }}<br>({{ summary.revenueProfitRatio }}%)</td>
                </tr>
              {% endfor %}
              <tr class="thtd bg-light">
                <td>{{ yearSum.year }}</td>
                <td class="text-primary text-right">{{ yearSum.revenuePrice | intcomma }}</td>
                <td class="text-danger text-right">{{ yearSum.revenueProfitPrice | intcomma }}<br>({{ yearSum.revenueProfitRatio }}%)</td>
              </tr>
              </tbody>
            </table>

            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="cashDown" onclick="downClick('cash', 'cashUp', 'cashDown')">▼</span>
              <span id="cashUp" class="d-none" onclick="upClick('cash', 'cashUp', 'cashDown')">▶</span>
              입출금정보 <br> (세금계산서 발행 및 접수 내역만 표기)
            </b></h5>
            <div id="cash">
              <table style="margin-left:20px">
                <tbody>
                <tr>
                  <td style="width: 40%;">총 수금액</td>
                  <td style="width: 40%; text-align: right;">{{ totalDeposit | intcomma }}</td>
                </tr>
                <tr>
                  <td style="width: 40%;">총 지급액</td>
                  <td style="width: 40%; text-align: right;">{{ totalWithdraw | intcomma }}</td>
                </tr>
                <tr>
                  <td style="width: 40%;">총 집행률</td>
                  <td style="width: 40%; text-align: right;">{{ totalRatio }}%</td>
                </tr>
                </tbody>
              </table>
              <br>
              <div class="row">
                <div class="col-xl-6">
                  <table class="mobile-table" style="table-layout:fixed">
                    <thead>
                    <tr class="bg-secondary">
                      <td class="text-gray-100" width="24%">매출처</td>
                      <td class="text-gray-100" width="38%">매출금액</td>
                      <td class="text-gray-100" width="38%">수금액<br>(수금률)</td>
                    </tr>
                    </thead>
                    <tbody>
                    {% for deposit in companyDeposit %}
                      <tr class="thtd">
                        <td class="text-left" style="text-overflow: ellipsis; overflow:hidden; white-space: nowrap;">{% if deposit.revenueCompany__companyNameKo == None %}-{% else %}
                          {{ deposit.revenueCompany__companyNameKo }}{% endif %}</td>
                        <td class="text-right">{% if deposit.sum_deposit == None %}0{% else %}{{ deposit.sum_deposit | intcomma }}{% endif %}</td>
                        <td class="text-right">{% if deposit.filter_deposit == None %}0{% else %}{{ deposit.filter_deposit | intcomma }}{% endif %}<br>
                          ({% if deposit.ratio_deposit == None %}0{% else %}{{ deposit.ratio_deposit }}{% endif %}%)
                        </td>
                        <td></td>
                      </tr>
                    {% endfor %}
                    <tr class="thtd bg-light">
                      <td>합계</td>
                      <td class="text-right">{% if companyTotalDeposit.total_sum_deposit == None %}0{% else %}{{ companyTotalDeposit.total_sum_deposit | intcomma }}{% endif %}</td>
                      <td class="text-right">{% if companyTotalDeposit.total_filter_deposit == None %}0{% else %}{{ companyTotalDeposit.total_filter_deposit | intcomma }}{% endif %}<br>
                        ({% if companyTotalDeposit.total_ratio_deposit == None %}0{% else %}{{ companyTotalDeposit.total_ratio_deposit }}{% endif %}%)
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-xl-6">
                  <table class="mobile-table" style="table-layout:fixed">
                    <thead>
                    <tr class="bg-secondary">
                      <td class="text-gray-100" width="24%">매입처</td>
                      <td class="text-gray-100" width="38%">매입금액</td>
                      <td class="text-gray-100" width="38%">지급액<br>(지급률)</td>
                    </tr>
                    </thead>
                    <tbody>
                    {% for withdraw in companyWithdraw %}
                      <tr class="thtd">
                        <td class="text-left" style="text-overflow: ellipsis; overflow:hidden; white-space: nowrap;">{% if withdraw.purchaseCompany__companyNameKo == None %}-{% else %}
                          {{ withdraw.purchaseCompany__companyNameKo }}{% endif %}</td>
                        <td class="text-right">{% if withdraw.sum_withdraw == None %}0{% else %}{{ withdraw.sum_withdraw | intcomma }}
                          <span style="display: inline-block; width: 60px;">({{ withdraw.sum_ratio_withdraw }}%)</span>{% endif %}</td>
                        <td class="text-right">{% if withdraw.filter_withdraw == None %}0{% else %}{{ withdraw.filter_withdraw | intcomma }}{% endif %}<br>
                          ({% if withdraw.ratio_withdraw == None %}0{% else %}{{ withdraw.ratio_withdraw }}{% endif %}%)
                        </td>
                      </tr>
                    {% endfor %}
                    <tr class="thtd bg-light">
                      <td>합계</td>
                      <td class="text-right">{% if companyTotalWithdraw.total_sum_withdraw == None %}0{% else %}{{ companyTotalWithdraw.total_sum_withdraw | intcomma }}
                        <span style="display: inline-block; width: 60px;"></span>{% endif %}</td>
                      <td class="text-right">{% if companyTotalWithdraw.total_filter_withdraw == None %}0{% else %}{{ companyTotalWithdraw.total_filter_withdraw | intcomma }}{% endif %}<br>
                        ({% if companyTotalWithdraw.total_ratio_withdraw == None %}0{% else %}{{ companyTotalWithdraw.total_ratio_withdraw }}{% endif %}%)
                      </td>

                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          {% endif %}

          {% if revenues %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="revenuesDownMobile" onclick="downClick('revenuesdivMobile', 'revenuesUpMobile', 'revenuesDownMobile')">▼</span>
              <span id="revenuesUpMobile" class="d-none" onclick="upClick('revenuesdivMobile', 'revenuesUpMobile', 'revenuesDownMobile')">▶</span>
              매출세부정보
            </b></h5>
            <div class="table-responsive" id="revenuesdivMobile">
              <table id="revenuesMobile" class="cell-border mobile-table" width="100%" style="width: 100%;">
                <thead>
                <tr class="bg-primary">
                  <td class="text-gray-100" width="5%">회차</td>
                  <td class="text-gray-100" width="10%">매출예정일</td>
                  <td class="text-gray-100" width="10%">매출일</td>
                  <td class="text-gray-100" width="10%">수금예정일</td>
                  <td class="text-gray-100" width="10%">수금일</td>
                  <td class="text-gray-100" width="15%">매출처</td>
                  <td class="text-gray-100" width="12%">매출금액</td>
                  <td class="text-gray-100" width="13%">이익금액</td>
                  <td class="text-gray-100" width="15%">비고</td>
                  <th class="d-none">revenueId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>
            </div>
          {% endif %}

          {% if purchases or costs %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="purchasesDownMobile" onclick="downClick('purchasesdivMobile', 'purchasesUpMobile', 'purchasesDownMobile')">▼</span>
              <span id="purchasesUpMobile" class="d-none" onclick="upClick('purchasesdivMobile', 'purchasesUpMobile', 'purchasesDownMobile')">▶</span>
              매입세부정보
            </b></h5>
            <div class="table-responsive" id="purchasesdivMobile">
              <h5 class="text-dark mb-3"><b>(세금계산서 접수항목)</b></h5>
              <table id="purchasesMobile" class="cell-border mobile-table" width="100%" style="width: 100%;">
                <thead>
                <tr class="bg-primary">
                  <td class="text-gray-100" width="5%">회차</td>
                  <td class="text-gray-100" width="10%">매입예정일</td>
                  <td class="text-gray-100" width="10%">매입일</td>
                  <td class="text-gray-100" width="10%">지급예정일</td>
                  <td class="text-gray-100" width="10%">지급일</td>
                  <td class="text-gray-100" width="15%">매입처</td>
                  <td class="text-gray-100" width="12%">매입금액</td>
                  <td class="text-gray-100" width="15%">비고</td>
                  <th class="d-none">purchaseId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>

              {% if costs %}
              <h5 class="text-dark mb-3"><b>(세금계산서 미접수항목)</b></h5>
              <table id="costsMobile" class="cell-border pc-table" width="100%" style="width: 100%; table-layout: auto;">
                <thead>
                <tr class="bg-primary">
                  <td class="text-gray-100" width="10%">연도</td>
                  <td class="text-gray-100" width="15%">매입항목</td>
                  <td class="text-gray-100" width="12%">매입금액</td>
                  <td class="text-gray-100" width="15%">비고</td>
                  <th class="d-none">costId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>
              {% endif %}
            </div>
          {% endif %}

          {% if services %}
            <br>
            <h5 class="text-dark mb-3"><b>
              <span id="servicesDownMobile" onclick="downClick('servicesdivMobile', 'servicesUpMobile', 'servicesDownMobile')">▼</span>
              <span id="servicesUpMobile" class="d-none" onclick="upClick('servicesdivMobile', 'servicesUpMobile', 'servicesDownMobile')">▶</span>
              엔지니어 지원 이력
            </b></h5>
            <div class="table-responsive" id="servicesdivMobile">
              <table id="servicesMobile" class="cell-border mobile-table" width="100%" style="width: 100%; table-layout: auto;">
                <thead>
                <tr class="bg-info">
                  <th class="text-gray-100 font-weight-normal">엔지니어</th>
                  <th class="text-gray-100 font-weight-normal">구분</th>
                  <th class="text-gray-100 font-weight-normal">날짜</th>
                  <th class="text-gray-100 font-weight-normal">작업내용</th>
                  <th class="text-gray-100 font-weight-normal">일반근무시간</th>
                  <th class="text-gray-100 font-weight-normal">초과근무시간</th>
                  <th class="text-gray-100 font-weight-normal">기본수당</th>
                  <th class="text-gray-100 font-weight-normal">시간외수당</th>
                  <th class="d-none">serviceId</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right">TOTAL :</th>
                  <th style="padding: 8px 10px; text-align: center"></th>
                  <th style="padding: 8px 10px; text-align: center"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                  <th style="padding: 8px 10px; text-align: right"></th>
                </tr>
                </tfoot>
              </table>
            </div>
          {% endif %}
        </div>
      </div>

      {% if user.employee.empDeptName == '경영지원본부' or user.is_staff %}
        <div class="text-center" style="padding: 0px 20px 20px 20px">
          <a href="#" class="btn btn-danger btn-icon-split" onclick="btn_delete()">
            <span class="icon text-white-50"> <i class="fas fa-trash-alt"> </i> </span>
            <span class="text"> 삭제 </span>
          </a>
          <a href="#" class="btn btn-info btn-icon-split" onclick="btn_modify()">
            <span class="icon text-white-50"> <i class="fas fa-edit"> </i> </span>
            <span class="text"> 수정 </span>
          </a>
        </div>
      {% endif %}
    </div>
  </div>

{% endblock %}


{% block script %}

  <script type="text/javascript">

      function btn_modify() {
          location.href = '/sales/modifycontract/' + {{ contract.contractId }} +'/';
      }

      function btn_delete() {
          if (confirm("계약 삭제시, 매출 정보까지 함께 삭제됩니다.\n삭제 하시겠습니까?") === true) {
              location.href = '/sales/deletecontract/' + {{ contract.contractId }} +'/';
          }
      }

      function open_upload(fileType) {
          $('#fileType').text(fileType);
          $('#uploadModalLabel').text(fileType + ' 등록');
          $('#uploadModal').modal('show');
      }

      function open_download(fileType) {
          $('#downloadModalLabel').text(fileType + ' 목록');
          $('#downloadModal').modal('show');
          let filesA = $('tr[name=filesA]');
          let filesB = $('tr[name=filesB]');
          let filesC = $('tr[name=filesC]');
          let filesD = $('tr[name=filesD]');
          let filesE = $('tr[name=filesE]');
          let filesF = $('tr[name=filesF]');
          let filesG = $('tr[name=filesG]');

          if (!filesA.hasClass('d-none')) {
              filesA.addClass('d-none')
          }
          if (!filesB.hasClass('d-none')) {
              filesB.addClass('d-none')
          }
          if (!filesC.hasClass('d-none')) {
              filesC.addClass('d-none')
          }
          if (!filesD.hasClass('d-none')) {
              filesD.addClass('d-none')
          }
          if (!filesE.hasClass('d-none')) {
              filesE.addClass('d-none')
          }
          if (!filesF.hasClass('d-none')) {
              filesF.addClass('d-none')
          }
          if (!filesG.hasClass('d-none')) {
              filesG.addClass('d-none')
          }

          if (fileType === '매입견적서') {
              filesA.removeClass('d-none');
          } else if (fileType === '매출견적서') {
              filesB.removeClass('d-none');
          } else if (fileType === '계약서') {
              filesC.removeClass('d-none');
          } else if (fileType === '수주통보서') {
              filesD.removeClass('d-none');
          } else if (fileType === '매입발주서') {
              filesE.removeClass('d-none');
          } else if (fileType === '납품,구축,검수확인서') {
              filesF.removeClass('d-none');
          } else if (fileType === '매출발행') {
              filesG.removeClass('d-none');
          }
      }

      function btn_upload() {
          let fileType = $('#fileType').text();
          let uploadForm = $('#uploadForm');

          // 파일종류
          $('<input />', {
              type: 'hidden',
              name: 'fileType',
              value: fileType,
          }).appendTo(uploadForm);

          // 첨부파일
          uploadForm.append($("#files"));
          let filesName = $('td[name="filesName"]');
          let filesSize = $('td[name="filesSize"]');
          let listFile = [];
          let data;
          for (let i = 0; i < filesName.length; i++) {
              data = {};
              data.fileName = filesName[i].innerText;
              data.fileSize = filesSize[i].innerText;
              listFile.push(data);
          }
          $('<input />', {
              type: 'hidden',
              name: 'jsonFile',
              value: JSON.stringify(listFile)
          }).appendTo(uploadForm);

          uploadForm.submit();
      }

      function btn_confirm() {
          const confirmform = $("#confirmForm");
          confirmform.submit();
      }

      function downClick(table, up, down) {
          $('#' + table).addClass('d-none');
          $('#' + up).removeClass('d-none');
          $('#' + down).addClass('d-none');
      }

      function upClick(table, up, down) {
          $('#' + table).removeClass('d-none');
          $('#' + up).addClass('d-none');
          $('#' + down).removeClass('d-none');
      }

      function replaceDate(predictStr, executionStr, searchStr, replaceStr, complete, idx) {
          let newStr;

          if (executionStr != null) {
              newStr = complete + '완료';
          } else if (predictStr != null) {
              newStr = predictStr.split(searchStr).join(replaceStr).split("T").join(" ").slice(0, idx);
          } else {
              newStr = '-'
          }
          return newStr
      }

      function file_names(id) {
          let files = $('#' + id).get(0).files;
          let filesTbody = $('#filesTbody');
          let file;
          let tr;
          filesTbody.empty();

          for (let i = 0; i < files.length; i++) {
              file = files[i];
              tr = '<tr>';
              tr += '<td class="text-left" name="filesName">' + file.name + '</td>';
              tr += '<td name="filesSize">' + (file.size / 1048576).toFixed(2) + 'MB</td>';
              tr += '<td><i class="fas fa-times-circle" name="remove" onclick="remove_row(this)"></i></td>';
              tr += '</tr>';
              filesTbody.append(tr);
          }
      }

      function remove_row(obj) {
          let row = $(obj).parent().parent();
          row.remove();
      }

      function switch_id_class(id, classname) {
          let obj = $('#' + id);
          if (obj.hasClass(classname)) {
              obj.removeClass(classname)
          } else {
              obj.addClass(classname)
          }
      }

      function post_document() {
          let documentType = $('#documentType').val();
          let purchases = {{ purchases | length }};  // 매입(세금계산서 접수) 개수
          let purchaseEstimate = {{ files_a | length }};  // 매입발주서 개수
          let revenueEstimate = {{ files_b | length }};  // 매출발주서 개수
          let contractPaper = {{ files_c | length }};  // 계약서 개수
          let orderPaper = {{ files_d | length }};  // 수주통보서 개수
          let confirmPaper = {{ files_f | length }};  // 납품,구축,검수확인서 개수

          if (documentType === '매출견적서') {
              if (purchaseEstimate === 0) {
                  alert('매입견적서를 업로드해주세요.')
              } else if (revenueEstimate === 0) {
                  alert('매출견적서를 업로드해주세요.')
              } else if (purchases === 0) {
                  alert('매입(세금계산서 접수 항목)을 입력해주세요.')
              } else {
                  window.open('/approval/postcontractdocument/' + '{{ contract.contractId }}' + '/' + documentType, '_blank');
              }
          } else if (documentType === '수주통보서') {
              if (contractPaper === 0) {
                  alert('계약서를 업로드해주세요.')
              } else {
                  window.open('/approval/postcontractdocument/' + '{{ contract.contractId }}' + '/' + documentType, '_blank');
              }
          } else if (documentType === '매출발행') {
              if (orderPaper === 0) {
                  alert('수주통보서를 업로드해주세요.')
              } else if (confirmPaper === 0) {
                  alert('납품,구축,검수확인서를 업로드해주세요.')
              } else {
                  window.open('/approval/postcontractdocument/' + '{{ contract.contractId }}' + '/' + documentType, '_blank');
              }
          } else if (documentType === '선발주') {
              if (purchaseEstimate === 0) {
                  alert('매입견적서를 업로드해주세요.')
              } else if (purchases === 0) {
                  alert('매입(세금계산서 접수 항목)을 입력해주세요.')
              } else {
                  window.open('/approval/postcontractdocument/' + '{{ contract.contractId }}' + '/' + documentType, '_blank');
              }
          }
      }

      function show_document() {
          $('#documentModal').modal('show');
      }

      $(document).ready(function () {
          $('#revenues').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractrevenues' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'billingTime'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'predictDepositDate'},
                  {data: 'depositDate'},
                  {data: 'revenueCompany__companyNameKo'},
                  {data: 'revenuePrice'},
                  {data: 'revenueProfitPrice'},
                  {data: 'comment'},
                  {data: 'revenueId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[1, 'asc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(6)', nRow).text(aData.revenuePrice.toLocaleString());
                  $('td:eq(7)', nRow).text(aData.revenueProfitPrice.toLocaleString());
                  $('td:eq(8)', nRow).text(aData.comment).css('color', '#e74a3b');

                  $('td:eq(1)', nRow).text(replaceDate(aData.predictBillingDate, aData.billingDate, "-", ".", "발행", 7));
                  if (aData.billingDate != null) {
                      $('td:eq(1)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(2)', nRow).text(replaceDate(aData.billingDate, null, "-", ".", null, 10));
                  $('td:eq(3)', nRow).text(replaceDate(aData.predictDepositDate, aData.depositDate, "-", ".", "수금", 10));
                  if (aData.depositDate != null) {
                      $('td:eq(3)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(4)', nRow).text(replaceDate(aData.depositDate, null, "-", ".", null, 10));

                  {% if revenueId %}
                      if (aData.revenueId === {{ revenueId }}) {
                          $(nRow).css('background-color', '#ffffcc');
                      }
                  {% endif %}
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(revenueResult.toLocaleString());

                  var profitResult = 0;
                  api.column(7, {search: 'applied'}).data().each(function (data, index) {
                      profitResult += parseFloat(data);
                  });
                  $(api.column(7).footer()).html(profitResult.toLocaleString());
              },
          });

          $('#purchases').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractpurchases' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'billingTime'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'predictWithdrawDate'},
                  {data: 'withdrawDate'},
                  {data: 'purchaseCompany__companyNameKo'},
                  {data: 'purchasePrice'},
                  {data: 'comment'},
                  {data: 'purchaseId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[1, 'asc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(6)', nRow).text(aData.purchasePrice.toLocaleString());
                  $('td:eq(7)', nRow).text(aData.comment).css('color', '#e74a3b');

                  $('td:eq(1)', nRow).text(replaceDate(aData.predictBillingDate, aData.billingDate, "-", ".", "접수", 7));
                  if (aData.billingDate != null) {
                      $('td:eq(1)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(2)', nRow).text(replaceDate(aData.billingDate, null, "-", ".", null, 10));
                  $('td:eq(3)', nRow).text(replaceDate(aData.predictWithdrawDate, aData.withdrawDate, "-", ".", "지급", 10));
                  if (aData.withdrawDate != null) {
                      $('td:eq(3)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(4)', nRow).text(replaceDate(aData.withdrawDate, null, "-", ".", null, 10));

                  {% if purchaseId %}
                      if (aData.purchaseId === {{ purchaseId }}) {
                          $(nRow).css('background-color', '#ffffcc');
                      }
                  {% endif %}
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(revenueResult.toLocaleString());

              },
          });

          $('#costs').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractcosts' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'billingTime'},
                  {data: 'billingDate'},
                  {data: 'billingDate'},
                  {data: 'billingDate'},
                  {data: 'billingDate'},
                  {data: 'costCompany'},
                  {data: 'costPrice'},
                  {data: 'comment'},
                  {data: 'costId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[4, 'asc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(1)', nRow).text('');
                  $('td:eq(2)', nRow).text('');
                  $('td:eq(3)', nRow).text('');
                  $('td:eq(4)', nRow).text(replaceDate(aData.billingDate, null, "-", ".", "", 4));
                  $('td:eq(6)', nRow).text(aData.costPrice.toLocaleString());
                  $('td:eq(7)', nRow).text(aData.comment).css('color', '#e74a3b');
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var costResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      costResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(costResult.toLocaleString());
              },
          });

          // 하도급계약
          $('#goodsHW').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 1,
                      'table': 'a'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'companyName'},
                  {data: 'contents'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(2)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(2, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(2).footer()).html(priceResult.toLocaleString());
              },
          });

          $('#goodsSW').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 2,
                      'table': 'a'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'companyName'},
                  {data: 'contents'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(2)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(2, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(2).footer()).html(priceResult.toLocaleString());
              },
          });

          $('#maintenanceHW').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 3,
                      'table': 'a'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'companyName'},
                  {data: 'contents'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(2)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(2, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(2).footer()).html(priceResult.toLocaleString());
              },
          });

          $('#maintenanceSW').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 4,
                      'table': 'a'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'companyName'},
                  {data: 'contents'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(2)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(2, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(2).footer()).html(priceResult.toLocaleString());
              },
          });

          $('#supportInternal').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 5,
                      'table': 'b'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'classification'},
                  {data: 'times'},
                  {data: 'sites'},
                  {data: 'units'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[4, 'desc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(4)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(4, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(4).footer()).html(priceResult.toLocaleString());
              },
          });

          $('#supportExternal').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 6,
                      'table': 'c'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'classification'},
                  {data: 'contents'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(2)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(2, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(2).footer()).html(priceResult.toLocaleString());
              },
          });

          $('#dbCosts').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 7,
                      'table': 'd'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'contractNo'},
                  {data: 'contractStartDate'},
                  {data: 'contractEndDate'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[1, 'asc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(1)', nRow).text(replaceDate(aData.contractStartDate, null, "-", ".", "", 4));
                  $('td:eq(2)', nRow).text(replaceDate(aData.contractStartDate, null, "-", ".", "", 4));
                  $('td:eq(3)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(3, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(3).footer()).html(priceResult.toLocaleString());
              },
          });

          $('#others').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}',
                      'classNumber': 8,
                      'table': 'c'
                  },
                  "url": "{% url 'sales:contractdetails' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'classification'},
                  {data: 'contents'},
                  {data: 'price'},
                  {data: 'typeId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(2)', nRow).text(aData.price.toLocaleString());
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var priceResult = 0;
                  api.column(2, {search: 'applied'}).data().each(function (data, index) {
                      priceResult += parseFloat(data);
                  });
                  $(api.column(2).footer()).html(priceResult.toLocaleString());
              },
          });


          $('#services').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractservices' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'empName'},
                  {data: 'serviceType'},
                  {data: 'serviceDate'},
                  {data: 'serviceTitle'},
                  {data: 'serviceRegHour'},
                  {data: 'serviceOverHour'},
                  {data: 'salary'},
                  {data: 'overSalary'},
                  {data: 'serviceId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(6)', nRow).text(aData.salary.toLocaleString());
                  $('td:eq(7)', nRow).text(aData.overSalary.toLocaleString());

                  $('td:eq(2)', nRow).text(replaceDate(aData.serviceDate, null, "-", ".", null, 10));
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var hourresult = 0;
                  api.column(4, {search: 'applied'}).data().each(function (data, index) {
                      hourresult += parseFloat(data);
                  });
                  $(api.column(4).footer()).html(hourresult.toLocaleString());

                   var overHourresult = 0;
                  api.column(5, {search: 'applied'}).data().each(function (data, index) {
                      overHourresult += parseFloat(data);
                  });
                  $(api.column(5).footer()).html(overHourresult.toLocaleString());

                  var salaryresult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      salaryresult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(salaryresult.toLocaleString());

                   var overSalaryresult = 0;
                  api.column(7, {search: 'applied'}).data().each(function (data, index) {
                      overSalaryresult += parseFloat(data);
                  });
                  $(api.column(7).footer()).html(overSalaryresult.toLocaleString());
              },
          });

          $('#revenuesMobile').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractrevenues' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'billingTime'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'predictDepositDate'},
                  {data: 'depositDate'},
                  {data: 'revenueCompany__companyNameKo'},
                  {data: 'revenuePrice'},
                  {data: 'revenueProfitPrice'},
                  {data: 'comment'},
                  {data: 'revenueId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[1, 'asc']],
              "searching": false,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },

              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(6)', nRow).text(aData.revenuePrice.toLocaleString());
                  $('td:eq(7)', nRow).text(aData.revenueProfitPrice.toLocaleString());
                  $('td:eq(8)', nRow).text(aData.comment).css('color', '#e74a3b');

                  $('td:eq(1)', nRow).text(replaceDate(aData.predictBillingDate, aData.billingDate, "-", ".", "발행", 7));
                  if (aData.billingDate != null) {
                      $('td:eq(1)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(2)', nRow).text(replaceDate(aData.billingDate, null, "-", ".", null, 10));
                  $('td:eq(3)', nRow).text(replaceDate(aData.predictDepositDate, aData.depositDate, "-", ".", "수금", 10));
                  if (aData.depositDate != null) {
                      $('td:eq(3)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(4)', nRow).text(replaceDate(aData.depositDate, null, "-", ".", null, 10));

                  {% if revenueId %}
                      if (aData.revenueId === {{ revenueId }}) {
                          $(nRow).css('background-color', '#ffffcc');
                      }
                  {% endif %}
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(revenueResult.toLocaleString());

                  var profitResult = 0;
                  api.column(7, {search: 'applied'}).data().each(function (data, index) {
                      profitResult += parseFloat(data);
                  });
                  $(api.column(7).footer()).html(profitResult.toLocaleString());
              },
          });

          $('#purchasesMobile').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractpurchases' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'billingTime'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'predictWithdrawDate'},
                  {data: 'withdrawDate'},
                  {data: 'purchaseCompany__companyNameKo'},
                  {data: 'purchasePrice'},
                  {data: 'comment'},
                  {data: 'purchaseId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[1, 'asc']],
              "searching": false,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },

              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(6)', nRow).text(aData.purchasePrice.toLocaleString());
                  $('td:eq(7)', nRow).text(aData.comment).css('color', '#e74a3b');

                  $('td:eq(1)', nRow).text(replaceDate(aData.predictBillingDate, aData.billingDate, "-", ".", "접수", 7));
                  if (aData.billingDate != null) {
                      $('td:eq(1)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(2)', nRow).text(replaceDate(aData.billingDate, null, "-", ".", null, 10));
                  $('td:eq(3)', nRow).text(replaceDate(aData.predictWithdrawDate, aData.withdrawDate, "-", ".", "지급", 10));
                  if (aData.withdrawDate != null) {
                      $('td:eq(3)', nRow).css('color', '#b7b9cc');
                  }
                  $('td:eq(4)', nRow).text(replaceDate(aData.withdrawDate, null, "-", ".", null, 10));

                  {% if purchaseId %}
                      if (aData.purchaseId === {{ purchaseId }}) {
                          $(nRow).css('background-color', '#ffffcc');
                      }
                  {% endif %}
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(revenueResult.toLocaleString());

              },
          });

          $('#costsMobile').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractcosts' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'billingDate'},
                  {data: 'costCompany'},
                  {data: 'costPrice'},
                  {data: 'comment'},
                  {data: 'costId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[0, 'asc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(0)', nRow).text(replaceDate(aData.billingDate, null, "-", ".", "", 4));
                  $('td:eq(2)', nRow).text(aData.costPrice.toLocaleString());
                  $('td:eq(3)', nRow).text(aData.comment).css('color', '#e74a3b');
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var costResult = 0;
                  api.column(2, {search: 'applied'}).data().each(function (data, index) {
                      costResult += parseFloat(data);
                  });
                  $(api.column(2).footer()).html(costResult.toLocaleString());
              },
          });

          $('#servicesMobile').dataTable({
              "autoWidth": true,
              "processing": true,
              "ajax": {
                  "processing": true,
                  "type": 'POST',
                  "data": {
                      'contractId': '{{ contract.contractId }}'
                  },
                  "url": "{% url 'sales:contractservices' %}",
                  "dataSrc": ""
              },
              "columns": [
                  {data: 'empName'},
                  {data: 'serviceType'},
                  {data: 'serviceDate'},
                  {data: 'serviceTitle'},
                  {data: 'serviceRegHour'},
                  {data: 'serviceOverHour'},
                  {data: 'salary'},
                  {data: 'overSalary'},
                  {data: 'serviceId'},
              ],
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, className: "d-none"},
              ],
              "deferRender": true,
              "order": [[2, 'desc']],
              "searching": false,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollX": true,
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_개씩 보기",
                  "search": "검색:",
                  "zeroRecords": "결과 없음",
                  "processing": "로딩중",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "→",
                      "previous": "←"
                  },

              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(6)', nRow).text(aData.salary.toLocaleString());
                  $('td:eq(7)', nRow).text(aData.overSalary.toLocaleString());

                  $('td:eq(2)', nRow).text(replaceDate(aData.serviceDate, null, "-", ".", null, 10));
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var hourresult = 0;
                  api.column(4, {search: 'applied'}).data().each(function (data, index) {
                      hourresult += parseFloat(data);
                  });
                  $(api.column(4).footer()).html(hourresult.toLocaleString());

                   var overHourresult = 0;
                  api.column(5, {search: 'applied'}).data().each(function (data, index) {
                      overHourresult += parseFloat(data);
                  });
                  $(api.column(5).footer()).html(overHourresult.toLocaleString());

                  var salaryresult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      salaryresult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(salaryresult.toLocaleString());

                   var overSalaryresult = 0;
                  api.column(7, {search: 'applied'}).data().each(function (data, index) {
                      overSalaryresult += parseFloat(data);
                  });
                  $(api.column(7).footer()).html(overSalaryresult.toLocaleString());
              },
          });

      });


  </script>

{% endblock %}