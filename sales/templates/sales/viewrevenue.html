{% extends "dashboard/layout.html" %}
{% load humanize %}

{% block title %}
  영업관리
{% endblock %}


{% block css %}

  <style type="text/css">
    .pc-table{
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .pc-table td, .pc-table th{
      padding: 10px;
      text-align: center;
      vertical-align: middle;
      font-size: 18px;
      border-top: 1px dotted #858796a3;
    }

    .mobile-table{
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .mobile-table td, .mobile-table th{
      padding: 4px;
      vertical-align: middle;
      font-size: 16px;
      border-top: 1px dotted #858796a3;
    }

  </style>

{% endblock %}


{% block content %}

  <div class="row">
    <div class="col-xl-2"></div>

    <!-- PC화면-->
    <div class="col-xl-8 d-none d-xl-block">
      <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 h3 text-gray-800"> {{ revenue.revenueName }} </h6>
        </div>

        <div class="card-body">
          <table class="pc-table">
            <tbody>
            <tr>
              <td style="width: 20%; border-top: 0px;"><b>매출금액</b></td>
              <td style="width: 30%; border-top: 0px;">{{ revenue.salePrice | intcomma }} 원</td>
              <td style="width: 20%; border-top: 0px;"><b>빌링일자</b></td>
              <td style="width: 30%; border-top: 0px;">{{ revenue.billingDate }}</td>
            </tr>
            <tr>
              <td><b>수금금액</b></td>
              <td>{% if revenue.collectPrice %}{{ revenue.collectPrice | intcomma }} 원{% else %}-{% endif %}</td>
              <td><b>수금일자</b></td>
              <td>{% if revenue.collectDate %}{{ revenue.collectDate }}{% else %}-{% endif %}</td>
            </tr>
            <tr>
              <td><b>단계</b></td>
              <td>{{ revenue.revenueStep }}</td>
              <td><b>수금예정일자</b></td>
              <td>{% if revenue.predictCollectDate %}{{ revenue.predictCollectDate }}{% else %}-{% endif %}</td>
            </tr>

            </tbody>
          </table>

          <div class="text-center">
            <a href="#" class="btn btn-danger btn-icon-split" onclick="btn_delete()">
              <span class="icon text-white-50"> <i class="fas fa-trash-alt"> </i> </span>
              <span class="text"> 삭제 </span>
            </a>
            <a href="#" class="btn btn-info btn-icon-split" onclick="btn_modify()">
              <span class="icon text-white-50"> <i class="fas fa-edit"> </i> </span>
              <span class="text"> 수정 </span>
            </a>
          </div>
        </div>

      </div>

      <div class="text-center" id="more">
        <a href="#" class="btn btn-success btn-icon-split" onclick="btn_contract()">
          <span class="icon text-white-50"> <i class="fas fa-sticky-note"> </i> </span>
          <span class="text"> 계약내용 </span>
        </a>
      </div>

      <div class="card shadow mb-4 d-none" id="contract">
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 h3 text-gray-800"> {{ contract.contractName }} </h6>
        </div>

        <div class="card-body">
          <table class="pc-table">
            <tbody>
            <tr>
              <td style="width: 20%; border-top: 0px;"><b>단계</b></td>
              <td style="width: 30%; border-top: 0px;">{{ contract.contractStep }}</td>
              <td style="width: 20%; border-top: 0px;"><b>영업담당</b></td>
              <td style="width: 30%; border-top: 0px;">{{ contract.empName }}</td>
            </tr>
            <tr>
              <td><b>판매유형</b></td>
              <td>{{ contract.saleType }}</td>
              <td><b>산업군</b></td>
              <td>{{ contract.saleIndustry }}</td>
            </tr>
            <tr>
              <td><b>거래처</b></td>
              <td>{{ contract.saleCompanyName.companyName }}</td>
              <td><b>거래처 담당자</b></td>
              <td>{{ contract.saleCustomerName }}</td>
            </tr>
            <tr>
              <td><b>고객사</b></td>
              <td>{{ contract.endCompanyName.companyName }}</td>
              <td><b>고객사 담당자</b></td>
              <td>{{ contract.endCustomerName }}</td>
            </tr>
            <tr {% if contract.contractStep == 'Firm' %}class="text-gray-500"{% endif %}>
              <td><b>예상계약금액</b></td>
              <td>{{ contract.predictSalePrice | intcomma }} 원</td>
              <td><b>예상이익금액</b></td>
              <td>{{ contract.predictProfitPrice | intcomma }} 원</td>
            </tr>
            <tr {% if contract.contractStep == 'Firm' %}class="text-gray-500"{% endif %}>
              <td><b>예상이익율</b></td>
              <td>{{ contract.predictProfitRatio }} %</td>
              <td><b>예상계약일</b></td>
              <td>{{ contract.predictContractDate }}</td>
            </tr>
            {% if contract.contractStep == 'Firm' %}
              <tr>
                <td><b>계약금액</b></td>
                <td>{{ contract.salePrice | intcomma }} 원</td>
                <td><b>이익금액</b></td>
                <td>{{ contract.profitPrice | intcomma }} 원</td>
              </tr>
              <tr>
                <td><b>이익율</b></td>
                <td>{{ contract.profitRatio }} %</td>
                <td><b>계약일</b></td>
                <td>{{ contract.contractDate }}</td>
              </tr>
              <tr>
                <td><b>계약시작일</b></td>
                <td>{{ contract.contractStartDate }}</td>
                <td><b>계약종료일</b></td>
                <td>{{ contract.contractEndDate }}</td>
              </tr>
            {% endif %}
            <tr>
              <td><b>참고사항</b></td>
              <td colspan="3">{% if contract.comment == None %} {% else %}{{ contract.comment }}{% endif %}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 모바일 화면 수정해야 됨. -->
    <div class="col-xl-8 d-block d-xl-none">
      <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 h3 text-gray-800"> {{ contract.contractName }} </h6>
        </div>
        <div class="card-body ">
          <table class="mobile-table">
            <tbody>
            <tr>
              <td style="width: 40%; border-top: 0px;"><b>영업담당</b></td>
              <td style="width: 60%; border-top: 0px;">{{ contract.empName }}</td>
            </tr>
            <tr>
              <td><b>예상계약일</b></td>
              <td>{{ contract.predictContractDate }}</td>
            </tr>
            <tr>
              <td><b>판매유형</b></td>
              <td>{{ contract.saleType }}</td>
            </tr>
            <tr>
              <td><b>산업군</b></td>
              <td>{{ contract.saleIndustry }}</td>
            </tr>
            <tr>
              <td><b>거래처</b></td>
              <td>{{ contract.saleCompanyName.companyName }}</td>
            </tr>
            <tr>
              <td><b>거래처 담당자</b></td>
              <td>{{ contract.saleCustomerName }}</td>
            </tr>
            <tr>
              <td><b>고객사</b></td>
              <td>{{ contract.endCompanyName.companyName }}</td>
            </tr>
            <tr>
              <td><b>고객사 담당자</b></td>
              <td>{{ contract.endCustomerName }}</td>
            </tr>
            <tr>
              <td><b>예상계약금액</b></td>
              <td>{{ contract.predictSalePrice | intcomma }} 원</td>
            </tr>
            <tr>
              <td><b>예상이익금액</b></td>
              <td>{{ contract.predictProfitPrice | intcomma }} 원 ({{ contract.predictProfitRatio }}%)</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-xl-2"></div>
  </div>

{% endblock %}


{% block script %}

  <script type="text/javascript">

      function btn_modify(){
          location.href = '/sales/modifycontract/' + {{ contract.contractId }} + '/';
      }

      function btn_delete(){
          if (confirm("삭제 하시겠습니까?") === true) {
              location.href = '/sales/deleterevenue/' + {{ contract.contractId }} + '/';
          }
      }

      function btn_contract(){
          $('#contract').removeClass('d-none');
          $('#more').addClass('d-none');
      }

  </script>

{% endblock %}