{% extends "dashboard/layout.html" %}


{% block title %}
  영업관리
{% endblock %}


{% block content %}

  <div class="row">
    <div class="col-xl-2"></div>

    <div class="col-xl-8">
      <div class="card shadow mb-4">

        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 h3 text-gray-800"> Opportunity 등록 </h6>
        </div>

        <div class="card-body">
          <form id="OpportunityForm" method="POST">

            {% csrf_token %}
            <div class="form-group row">
              <div class="col-12 mb-2">
                <label for="contractName" class="font-weight-bold text-primary"> 영업기회명 </label> {{ form.contractName }}
              </div>
            </div>
            <div class="form-group row">
              <div class="col-6 mb-2">
                <label for="empId" class="font-weight-bold text-primary"> 영업담당 </label> {{ form.empId }}
              </div>
              <div class="col-6">
                <label for="saleCustomerId" class="font-weight-bold text-primary"> 예상계약일 </label> {{ form.predictContractDate }}
              </div>
            </div>
            <div class="form-group row">
              <div class="col-6 mb-2">
                <label for="empId" class="font-weight-bold text-primary"> 판매유형 </label> {{ form.saleType }}
              </div>
              <div class="col-6">
                <label for="empId" class="font-weight-bold text-primary"> 산업군 </label> {{ form.saleIndustry }}
              </div>
            </div>
            <div class="form-group row">
              <div class="col-6 mb-2">
                <label for="saleCompanyName" class="font-weight-bold text-primary"> 거래처 </label> {{ form.saleCompanyName }}
              </div>
              <div class="col-6">
                <label for="saleCustomerId" class="font-weight-bold text-primary"> 거래처 담당자 </label> {{ form.saleCustomerId }}
              </div>
            </div>
            <div class="form-group row">
              <div class="col-6 mb-2">
                <label for="saleCompanyName" class="font-weight-bold text-primary"> 최종고객사 </label> {{ form.endCompanyName }}
              </div>
              <div class="col-6">
                <label for="saleCustomerId" class="font-weight-bold text-primary"> 최종고객사 담당자 </label> {{ form.endCustomerId }}
              </div>
            </div>
            <div class="form-group row">
              <div class="col-4 mb-2">
                <label for="saleCustomerId" class="font-weight-bold text-primary"> 예상계약금액 </label> {{ form.predictSalePrice }}
              </div>
              <div class="col-4">
                <label for="saleCustomerId" class="font-weight-bold text-primary"> 예상이익금액 </label> {{ form.predictProfitPrice }}
              </div>
              <div class="col-4">
                <label for="saleCustomerId" class="font-weight-bold text-primary"> 예상이익율 </label> {{ form.predictProfitRatio }}
              </div>
            </div>

            <div class="text-center">
              <a href="#" class="btn btn-danger btn-icon-split" onclick="btn_cancel()">
                <span class="icon text-white-50"> <i class="fas fa-times"> </i> </span>
                <span class="text"> 취소 </span>
              </a>
              <a href="#" class="btn btn-success btn-icon-split" onclick="btn_save()">
                <span class="icon text-white-50"> <i class="fas fa-check"> </i> </span>
                <span class="text"> 저장 </span>
              </a>
            </div>
          </form>
        </div>

      </div>
    </div>

    <div class="col-xl-2"></div>
  </div>

{% endblock %}


{% block script %}

  <script type="text/javascript">

      function btn_cancel() {
          if (confirm("취소하시겠습니까?") === true) {
              history.back();
          } else {
              return false;
          }
      }

      function btn_save() {
          if (confirm("양식등록을 하시겠습니까?") === true) {    //확인
              document.getElementById("OpportunityForm").submit();
          }
      }

      function changeCompany(saleCompanyName,selectId) {

          $.ajax({
              url: "{% url 'sales:salemanager_ajax_url' %}",
              method: 'POST',
              cache: false,
              data: {"saleCompanyName": saleCompanyName},
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnData) {
                  var salecompany = returnData;
                  $('#'+selectId).empty();

                  for (var count = 0; count < salecompany.length; count++) {
                      var option = $("<option value="+salecompany[count].pk+">" + salecompany[count].fields.customerName + "</option>");
                      $('#'+selectId).append(option);
                  }
              }
          })
      }

  </script>

{% endblock %}