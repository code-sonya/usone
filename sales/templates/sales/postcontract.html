{% extends "dashboard/layout.html" %}


{% block title %}
  영업관리
{% endblock %}


{% block css %}

  <style type="text/css">
    .input-form {
      border: 1px solid #d1d3e2;
      border-radius: .35rem;
      padding: .375rem .75rem;
      font-size: 0.9em;
      color: #6e707e;
      width: 170px;
    }

    .td-img {
      max-width: 40%;
      height: auto;
    }

    .flow-table {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .flow-table td, .flow-table th {
      padding: 5px 15px;
      text-align: center;
      vertical-align: middle;
      font-size: 17px;
      border-top: 0px dotted #858796a3;
    }

  </style>

{% endblock %}


{% block content %}

  <div class="row">
    <div class="col-xl-12">
      <div class="card shadow mb-4">

        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 h3 text-gray-800"> 영업기회 및 계약 등록 </h6>
          <div class="dropdown no-arrow">
            <a class="dropdown-toggle mr-2" href="#" role="button" id="customerLink" data-toggle="modal" data-target="#customerModal">
              <i class="fas fa-user-edit fa-fw text-success"></i>
            </a>
            <a class="dropdown-toggle" href="#" role="button" id="companyLink" data-toggle="modal" data-target="#companyModal">
              <i class="fas fa-hotel fa-fw text-warning"></i>
            </a>
          </div>
        </div>

        <div class="card-body">
          <form id="ContractForm" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <h5 class="text-dark mb-3"><b>
              <span id="OpportunityDown" onclick="downClick('Opportunity', 'OpportunityUp', 'OpportunityDown')">▼</span>
              <span id="OpportunityUp" class="d-none" onclick="upClick('Opportunity', 'OpportunityUp', 'OpportunityDown')">▶</span>
              계약내용
            </b></h5>
            <div id="Opportunity">
              <div class="form-group row">
                <div class="col-2 mb-3">
                  <label for="empId" class="font-weight-bold text-primary"> 영업대표 </label> {{ form.empId }}
                </div>
                <div class="col-10 mb-3">
                  <label for="contractName" class="font-weight-bold text-primary"> 계약명 </label> {{ form.contractName }}
                </div>
              </div>

              <div class="form-group row">
                <div class="col-2 mb-3">
                  <label for="saleType" class="font-weight-bold text-primary"> 판매유형 </label> {{ form.saleType }}
                </div>
                <div class="col-2 mb-3">
                  <label for="saleIndustry" class="font-weight-bold text-primary"> 산업군 </label> {{ form.saleIndustry }}
                </div>
                <div class="col-2 mb-3">
                  <label for="saleCompanyNames" class="font-weight-bold text-primary"> 거래처 </label> {{ form.saleCompanyNames }}
                </div>
                <div class="col-2 mb-3">
                  <label for="saleCustomerId" class="font-weight-bold"> 거래처 담당자 </label> {{ form.saleCustomerId }}
                </div>
                 <div class="col-2 mb-3">
                  <label for="saleTaxCustomerId" class="font-weight-bold"> 거래처 세금담당자 </label> {{ form.saleTaxCustomerId }}
                </div>
                <div class="col-2 mb-3">
                  <label for="endCompanyNames" class="font-weight-bold"> 최종고객사 </label> {{ form.endCompanyNames }}
                </div>
              </div>

              <div class="form-group row">
                <div class="col-2 mb-3">
                  <label for="salePrice" class="font-weight-bold text-primary">계약금액 (원) </label> {{ form.salePrice }}
                </div>
                <div class="col-2 mb-3">
                  <label for="profitPrice" class="font-weight-bold text-primary">이익금액 (원) </label> {{ form.profitPrice }}
                </div>
                <div class="col-2 mb-3">
                  <label for="profitRatio" class="font-weight-bold">이익율 (%) </label> {{ form.profitRatio }}
                </div>
                <div class="col-2 mb-3">
                  <label for="contractDate" class="font-weight-bold text-primary">계약일 </label> {{ form.contractDate }}
                </div>
                <div class="col-2 mb-3">
                  <label for="contractStartDate" class="font-weight-bold"> 계약시작일 </label> {{ form.contractStartDate }}
                </div>
                <div class="col-2 mb-3">
                  <label for="contractEndDate" class="font-weight-bold"> 계약종료일 </label> {{ form.contractEndDate }}
                </div>
              </div>

              <div class="form-group row">
                <div class="col-2">
                  <label for="depositCondition" class="font-weight-bold"> 수금조건 </label> {{ form.depositCondition }}
                </div>
                <div class="col-2">
                  <label for="depositConditionDay" class="font-weight-bold"> 수금조건일자 </label> {{ form.depositConditionDay }}
                </div>
                <!--{#                계약서는 추후 필요시 오픈#}-->
                <!--{#                <div class="col-2">#}-->
                <!--{#                  <label for="contractPaper" class="font-weight-bold"> 계약서 </label>#}-->
                <!--{#                  <div class="input-group">#}-->
                <!--{#                    <input class="form-control bg-white" type="text" id="contractPaper_route" value="{{ contractPaper }}" readonly>#}-->
                <!--{#                    <label class="m-0 btn btn-info btn-icon-split">#}-->
                <!--{#                      <span class="icon text-white-100"> <i class="fas fa-file-upload"> </i> </span>#}-->
                <!--{#                      {{ form.contractPaper }}#}-->
                <!--{#                    </label>#}-->
                <!--{#                  </div>#}-->
                <!--{#                </div>#}-->
                <!--<div class="col-2">-->
                  <!--<label for="orderPaper" class="font-weight-bold"> 수주통보서 </label>-->
                  <!--<div class="input-group">-->
                    <!--<input class="form-control bg-white" type="text" value="{{ orderPaper }}" id="orderPaper_route" readonly>-->
                    <!--<label class="m-0 btn btn-info btn-icon-split">-->
                      <!--<span class="icon text-white-100"> <i class="fas fa-file-upload"> </i> </span>-->
                      <!--{{ form.orderPaper }}-->
                    <!--</label>-->
                  <!--</div>-->
                <!--</div>-->
                <div class="col-2">
                  <label for="modifyContractPaper" class="font-weight-bold text-primary"> 수정수주통보서대상 </label> {{ form.modifyContractPaper }}
                </div>
                <div class="col-6">
                  <label for="comment" class="font-weight-bold"> 참고사항 </label> {{ form.comment }}
                </div>
              </div>
            </div>

            <hr class="divider">
            <div class="form-group row">
              <div class="col-xl-12">
                <h5 class="text-dark mb-3"><b> ▼ 세부사항</b></h5>
                <table id="categoryItem" class="display" style="width:100%">
                  <thead style="width:100%">
                  <tr>
                    <th>구분</th>
                    <th class="font-weight-bold text-primary">대분류</th>
                    <th class="font-weight-bold text-primary">소분류</th>
                    <th>상세내용</th>
                    <th class="font-weight-bold text-primary">금액</th>
                    <th><i id="addItem" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                  </tr>
                  </thead>
                  <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th class="text-right">TOTAL : </th>
                    <th><span class="totalItemPrice"></span></th>
                    <th></th>
                  </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <div class="form-group row" id="revenuediv">
              <hr class="divider">
              <div class="col-xl-12">
                <h5 class="text-dark mb-3"><b>▼ 매출세부정보</b></h5>
                <table id="revenue" class="display" style="width:100%">
                  <thead style="width:100%">
                  <tr>
                    <th>구분</th>
                    <th class="font-weight-bold text-primary">매출예정일</th>
                    <th>매출일</th>
                    <th>수금예정일</th>
                    <th>수금일</th>
                    <th class="font-weight-bold text-primary">매출처 <i class="fas fa-angle-double-down" onclick="changeRevenueCompany()"></i></th>
                    <th class="font-weight-bold text-primary">매출금액</th>
                    <th class="font-weight-bold text-primary">이익금액</th>
                    <th>비고</th>
                    <th><i id="addRevenue" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                  </tr>
                  </thead>
                  <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>TOTAL :</th>
                    <th><span class="totalRevenuePrice"></span></th>
                    <th><span class="totalRevenueProfitPrice"></span></th>
                    <th></th>
                    <th></th>
                  </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <div class="form-group row" id="purchasediv">
              <hr class="divider">
              <div class="col-xl-12">
                <h5 class="text-dark mb-3"><b>▼ 매입세부정보 (세금계산서 접수항목)</b></h5>
                <table id="purchase" class="display" style="width:100%">
                  <thead style="width:100%">
                  <tr>
                    <th>구분</th>
                    <th class="font-weight-bold text-primary">매입예정일</th>
                    <th>매입일</th>
                    <th>지급예정일</th>
                    <th>지급일</th>
                    <th class="font-weight-bold text-primary">매입처</th>
                    <th class="font-weight-bold text-primary">매입금액</th>
                    <th>비고</th>
                    <th><i id="addPurchase" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                  </tr>
                  </thead>
                  <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>TOTAL : </th>
                    <th><span class="totalPurchasePrice"></span></th>
                    <th></th>
                    <th></th>
                  </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <div class="form-group row" id="costdiv">
              <hr class="divider">
              <div class="col-xl-12">
                <h5 class="text-dark mb-3"><b>▼ 매입세부정보 (세금계산서 미접수항목)</b></h5>
                <table id="cost" class="display" style="width:100%">
                  <thead style="width:100%">
                  <tr>
                    <th>구분</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th class="font-weight-bold text-primary">매입연도</th>
                    <th class="font-weight-bold text-primary">매입내역</th>
                    <th class="font-weight-bold text-primary">매입금액</th>
                    <th>비고</th>
                    <th><i id="addCost" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                  </tr>
                  </thead>
                  <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>TOTAL : </th>
                    <th><span class="totalCostPrice"></span></th>
                    <th></th>
                    <th></th>
                  </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <div class="form-group row" id="purchasetypediv">
              <hr class="divider">
              <h5 class="text-dark mb-3"><b>▼ 하도급계약 상세내용</b></h5>
              <div class="form-group row">
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>1. 상품_HW</b></div>
                  <table id="goodsHW" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">거래처</th>
                      <th class="font-weight-bold text-primary">내역</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addGoodsHW" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalGoodsHWPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>2. 상품_SW</b></div>
                  <table id="goodsSW" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">거래처</th>
                      <th class="font-weight-bold text-primary">내역</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addGoodsSW" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalGoodsSWPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>3. 유지보수_HW</b></div>
                  <table id="maintenanceHW" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">거래처</th>
                      <th class="font-weight-bold text-primary">내역</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addMaintenanceHW" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalMaintenanceHWPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>4. 유지보수_SW</b></div>
                  <table id="maintenanceSW" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">거래처</th>
                      <th class="font-weight-bold text-primary">내역</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addMaintenanceSW" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalMaintenanceSWPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>5. 인력지원_자사서비스</b></div>
                  <table id="supportInternal" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">구분</th>
                      <th>횟수</th>
                      <th>사이트수</th>
                      <th class="font-weight-bold text-primary">단가</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addSupportInternal" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalSupportInternalPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>6. 인력지원_타사서비스</b></div>
                  <table id="supportExternal" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">구분</th>
                      <th class="font-weight-bold text-primary">내역</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addSupportExternal" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalSupportExternalPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

              <div class="form-group row">
                <!--<div class="col-xl-6">-->
                <!--<div class="text-dark mb-3"><b>7. 프로젝트</b></div>-->
                <!--<table id="project" class="display" style="width:100%">-->
                <!--<thead style="width:100%">-->
                <!--<tr>-->
                <!--<th>체크</th>-->
                <!--<th class="font-weight-bold text-primary">구분</th>-->
                <!--<th>횟수</th>-->
                <!--<th>사이트수</th>-->
                <!--<th class="font-weight-bold text-primary">단가</th>-->
                <!--<th class="font-weight-bold text-primary">금액</th>-->
                <!--<th><i id="addProject" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>-->
                <!--</tr>-->
                <!--</thead>-->
                <!--<tfoot>-->
                <!--<tr>-->
                <!--<th></th>-->
                <!--<th></th>-->
                <!--<th></th>-->
                <!--<th></th>-->
                <!--<th>TOTAL : </th>-->
                <!--<th><span class="totalProjectPrice"></span></th>-->
                <!--<th></th>-->
                <!--</tr>-->
                <!--</tfoot>-->
                <!--</table>-->
                <!--</div>-->
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>7. DB COSTS</b></div>
                  <table id="dbCosts" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">계약번호</th>
                      <th>계약시작일</th>
                      <th>계약종료일</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addDbCosts" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalDbCostsPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
                <div class="col-xl-6">
                  <div class="text-dark mb-3"><b>8. 기타</b></div>
                  <table id="others" class="display" style="width:100%">
                    <thead style="width:100%">
                    <tr>
                      <th>체크</th>
                      <th class="font-weight-bold text-primary">구분</th>
                      <th class="font-weight-bold text-primary">내역</th>
                      <th class="font-weight-bold text-primary">금액</th>
                      <th><i id="addOthers" class="fas fa-plus-square fa-fw text-info" style="font-size: 2rem"></i></th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                      <th></th>
                      <th></th>
                      <th>TOTAL :</th>
                      <th><span class="totalOthersPrice"></span></th>
                      <th></th>
                    </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>

            <div class="text-center">
              <a href="#" class="btn btn-danger btn-icon-split" onclick="btn_cancel()">
                <span class="icon text-white-50"> <i class="fas fa-times"> </i> </span>
                <span class="text"> 취소 </span>
              </a>
              <a href="#" class="btn btn-success btn-icon-split" onclick="btn_save()">
                <span class="icon text-white-50"> <i class="fas fa-check"> </i> </span>
                <span class="text"> 저장 </span>
              </a>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>

  <!-- company Modal -->
  <div class="modal fade" id="companyModal" tabindex="-1" role="dialog" aria-labelledby="companyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-header bg-info text-gray-100">
          <h5 class="modal-title" id="filterModalLabel">고객사 등록</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span class="text-gray-100" aria-hidden="true">×</span>
          </button>
        </div>

        <div class="modal-body">
          <form id="companyForm" onkeydown="javascript: if (event.keyCode == 13) {btn_register();}">
            {% csrf_token %}
            <div class="row mb-1">
              <div class="col-12 mb-6 mb-sm-0">
                <label for="companyName" class="font-weight-bold text-primary">[기술]고객사 명</label>
                <input type="text" class="form-control" id="companyName" name="companyName">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12 mb-6 mb-sm-0">
                <label for="companyNameKo" class="font-weight-bold text-primary">[영업]고객사 명</label>
                <input type="text" class="form-control" id="companyNameKo" name="companyNameKo">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="companyNumber" class="font-weight-bold text-secondary">사업자등록번호</label>
                <input class="form-control" id="companyNumber" name="companyNumber">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="salesEmpId" class="font-weight-bold text-secondary">영업대표</label>
                <select class="form-control" id="salesEmpId" name="salesEmpId">
                  <option value="" selected="">---------</option>
                  {% for emp in empNames %}
                    <option value="{{ emp.id }}">{{ emp.value }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="companyAddress" class="font-weight-bold text-secondary">주소</label>
                <input class="form-control" id="companyAddress" name="companyAddress">
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
          <a class="btn btn-info" href="#" onclick="btn_register()">등록</a>
        </div>
      </div>
    </div>
  </div>

  <!-- customer Modal -->
  <div class="modal fade" id="customerModal" tabindex="-1" role="dialog" aria-labelledby="customerModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-header bg-info text-gray-100">
          <h5 class="modal-title" id="customerModalLabel">담당자등록</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span class="text-gray-100" aria-hidden="true">×</span>
          </button>
        </div>

        <div class="modal-body">
          <form id="customerForm" onkeydown="javascript: if (event.keyCode == 13) {btn_customer();}">
            {% csrf_token %}
            <div class="row mb-1">
              <div class="col-12">
                <label for="customerCompany" class="font-weight-bold text-primary">고객사 명</label>
                <input type="text" class="magicsearch form-control" id="customerCompany" name="customerCompany" autocomplete="off" onkeydown="magicsearchtab(customerCompany)">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12 mb-6 mb-sm-0">
                <label for="customerName" class="font-weight-bold text-primary">담당자 명</label>
                <input type="text" class="form-control" id="customerName" name="customerName">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="customerDept" class="font-weight-bold text-secondary">담당자 부서</label>
                <input class="form-control" id="customerDept" name="customerDept">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="customerPhone" class="font-weight-bold text-secondary">담당자 연락처</label>
                <input class="form-control" id="customerPhone" name="customerPhone">
              </div>
            </div>
            <div class="row mb-1">
              <div class="col-12">
                <label for="customerEmail" class="font-weight-bold text-secondary">담당자 이메일</label>
                <input class="form-control" id="customerEmail" name="customerEmail">
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
          <a class="btn btn-info" href="#" onclick="btn_customer()">등록</a>
        </div>
      </div>
    </div>
  </div>

{% endblock %}


{% block script %}

  <script type="text/javascript">

      var value = "";
      var resultcompanyName;
      var resultcompanyNameKo;
      var companyList = new Array();
      companyList ={{ companyNames|safe }};

      function magicsearchtab(input) {
          console.log(input);
          value = $(input).attr('data-id');
          $(input).blur(function() {
              if (value !== "") {
                  console.log(value);
                  $(input).trigger('set', {id: value});
              }
          });
      }

      function btn_cancel() {
          if (confirm("취소 하시겠습니까?") === true) {
              location.href = "/sales/showcontracts"
          } else {
              return false;
          }
      }

      function btn_register() {

          const companyName = document.getElementById("companyName").value;
          const companyNameKo = document.getElementById("companyNameKo").value;
          const companyNumber = document.getElementById("companyNumber").value;
          const salesEmpId = document.getElementById("salesEmpId").value;
          const companyAddress = document.getElementById("companyAddress").value;

          if (document.getElementById("companyName").value === '') {
              alert("[기술]고객사 명 입력해주세요.");
              return false;
          }

          if (document.getElementById("companyNameKo").value === '') {
              alert("[영업]고객사 명 입력해주세요.");
              return false;
          }

          $.ajax({
              url: "{% url 'sales:savecompany' %}",
              method: 'POST',
              cache: false,
              data: {
                  "companyName": companyName,
                  "companyNameKo": companyNameKo,
                  "companyNumber": companyNumber,
                  "salesEmpId": salesEmpId,
                  "companyAddress": companyAddress
              },
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnData) {
                  if (returnData == 'N') {
                      alert('이미 등록된 고객사입니다.');
                      companyList ={{ companyNames|safe }};
                  } else if (returnData[0] == 'Y') {
                      $('.close').click();
                      alert('등록이 완료되었습니다.');
                      resultcompanyName = returnData[1];
                      resultcompanyNameKo = returnData[2];
                      companyList.push({id: resultcompanyName, value: resultcompanyNameKo});
                      replaceMagic();
                  }
              }
          });

      }

      function btn_customer() {
          const customerCompany = $("#customerCompany").attr('data-id');
          const customerName = document.getElementById("customerName").value;
          const customerDept = document.getElementById("customerDept").value;
          const customerPhone = document.getElementById("customerPhone").value;
          const customerEmail = document.getElementById("customerEmail").value;

          if (customerCompany === '') {
              alert("고객사 명을 선택해주세요.");
              return false;
          }

          if (customerName === '') {
              alert("담당자 명 입력해주세요.");
              return false;
          }

          $.ajax({
              url: "{% url 'sales:savecustomer' %}",
              method: 'POST',
              cache: false,
              data: {
                  "customerCompany": customerCompany,
                  "customerName": customerName,
                  "customerDept": customerDept,
                  "customerPhone": customerPhone,
                  "customerEmail": customerEmail
              },
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnData) {
                  if (returnData == 'N') {
                      alert('이미 등록된 고객입니다.');
                  } else if(returnData == 'Y') {
                      $('.close').click();
                      alert('등록이 완료되었습니다.');
                  }
              }
          });


      }

      function replaceMagic() {
          $('#saleCompanyNames').magicsearch({
              dataSource: companyList,
              fields: 'value',
              id: 'id',
              format: '%value%',
              multiStyle: {space: 5, width: 80},
              noResult: '검색결과없음',
              focusShow: true,
              success: function ($input, data) {
                  $.ajax({
                      url: "{% url 'sales:salemanager_ajax_url' %}",
                      method: 'POST',
                      cache: false,
                      data: {"saleCompanyName": data.id},
                      headers: {'X-CSRFToken': '{{ csrf_token }}'},
                      success: function (returnData) {
                          var salecompany = returnData;
                          const saleType = $("#saleType").val();
                          if(saleType == '직판'){
                              const endCompanyNames = $('#endCompanyNames');
                              endCompanyNames.trigger('set',{id: data.id});
                          }
                          $('#saleCustomerId').empty();
                          $('#saleCustomerId').append('<option value="" selected="">---------</option>');

                          for (var count = 0; count < salecompany.length; count++) {
                              var option = $("<option value=" + salecompany[count].pk + ">" + salecompany[count].fields.customerName + "</option>");
                              $('#saleCustomerId').append(option);
                          }
                          $('#saleTaxCustomerId').empty();
                          $('#saleTaxCustomerId').append('<option value="" selected="">---------</option>');

                          for (var count = 0; count < salecompany.length; count++) {
                              var option = $("<option value=" + salecompany[count].pk + ">" + salecompany[count].fields.customerName + "</option>");
                              $('#saleTaxCustomerId').append(option);
                          }
                      }
                  });
              }
          });

          $('#endCompanyNames').magicsearch({
              dataSource: companyList,
              fields: 'value',
              id: 'id',
              format: '%value%',
              multiStyle: {space: 5, width: 80},
              noResult: '검색결과없음',
              focusShow: true,
          });

          var lengthrevenueCompany = $('[name="revenueCompany"]').length;
          var lengthpurchaseCompany = $('[name="purchaseCompany"]').length;

          for (var i = 0; i < lengthrevenueCompany; i++) {
              $('#revenue5' + i).magicsearch({
                  dataSource: companyList,
                  fields: 'value',
                  id: 'id',
                  format: '%value%',
                  multiStyle: {space: 5, width: 80},
                  noResult: '검색결과없음',
                  focusShow: true,
              });
          }

          for (var j = 0; j < lengthpurchaseCompany; j++) {
              $('#purchase5' + j).magicsearch({
                  dataSource: companyList,
                  fields: 'value',
                  id: 'id',
                  format: '%value%',
                  multiStyle: {space: 5, width: 80},
                  noResult: '검색결과없음',
                  focusShow: true,
              });
          }

      }

      function btn_save() {
          if (document.getElementById("contractName").value === '') {
              alert("계약명을 입력해주세요.");
              return false;
          }
          if (document.getElementById("empId").value === '') {
              alert("영업대표를 입력해주세요.");
              return false;
          }
          if (document.getElementById("saleCompanyNames").value === '') {
              alert("거래처를 입력해주세요.");
              return false;
          }
          if (document.getElementById("salePrice").value === '') {
              alert("계약금액을 입력해주세요.");
              return false;
          }
          if (document.getElementById("profitPrice").value === '') {
              alert("이익금액을 입력해주세요.");
              return false;
          }
          if (document.getElementById("contractDate").value === '') {
              alert("계약일을 입력해주세요.");
              return false;
          }
           if (document.getElementById("modifyContractPaper").value === '') {
              alert("수주통보서수정대상 여부를 선택해 주세요.");
              return false;
          }

          moneyChange();

          const ContractForm = document.getElementById("ContractForm");

          // 세부사항
          const lengthItem = $('[name="itemId"]').length;
          const listItem = new Array();
          for (var i = 0; i <= lengthItem - 1; i++) {
              if ($('select[name="mainCategory"]').eq(i).val() == '') {
                  alert("세부사항의 대분류를 입력해주세요.");
                  return false;
              }
              if ($('select[name="subCategory"]').eq(i).val() == '') {
                  alert("세부사항의 소분류를 입력해주세요.");
                  return false;
              }
              if ($('input[name="itemPrice"]').eq(i).val() == '') {
                  alert("세부사항의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.itemId = $('div[name="itemId"]').eq(i).text();
              data.mainCategory = $('select[name="mainCategory"]').eq(i).val();
              data.subCategory = $('select[name="subCategory"]').eq(i).val();
              data.itemName = $('input[name="itemName"]').eq(i).val();
              data.itemPrice = $('input[name="itemPrice"]').eq(i).val();
              listItem.push(data);
          }
          const jsonItem = JSON.stringify(listItem);
          const item = document.createElement("input");
          item.setAttribute("type", "hidden");
          item.setAttribute("name", "jsonItem");
          item.setAttribute("value", jsonItem);
          ContractForm.appendChild(item);

          // 매출세부정보
          const lengthRevenue = $('[name="revenueId"]').length;
          const listRevenue = new Array();
          for (var i = 0; i <= lengthRevenue - 1; i++) {
              if ($('input[name="predictBillingDate"]').eq(i).val() == '') {
                  alert("매출세부정보의 매출예정일을 입력해주세요.");
                  return false;
              }
              if ($('input[name="revenueCompany"]').eq(i).val() == '') {
                  alert("매출세부정보의 매출처를 입력해주세요.");
                  return false;
              }
              if ($('input[name="revenuePrice"]').eq(i).val() == '') {
                  alert("매출세부정보의 매출금액을 입력해주세요.");
                  return false;
              }
              if ($('input[name="revenueProfitPrice"]').eq(i).val() == '') {
                  alert("매출세부정보의 이익금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.revenueId = $('div[name="revenueId"]').eq(i).text();
              data.predictBillingDate = $('input[name="predictBillingDate"]').eq(i).val();
              data.billingDate = $('input[name="billingDate"]').eq(i).val();
              data.predictDepositDate = $('input[name="predictDepositDate"]').eq(i).val();
              data.depositDate = $('input[name="depositDate"]').eq(i).val();
              data.revenueCompany = $('input[name="revenueCompany"]').eq(i).val();
              data.revenuePrice = $('input[name="revenuePrice"]').eq(i).val();
              data.revenueProfitPrice = $('input[name="revenueProfitPrice"]').eq(i).val();
              data.revenueComment = $('input[name="revenueComment"]').eq(i).val();
              listRevenue.push(data);
          }
          const jsonRevenue = JSON.stringify(listRevenue);
          const revenue = document.createElement("input");
          revenue.setAttribute("type", "hidden");
          revenue.setAttribute("name", "jsonRevenue");
          revenue.setAttribute("value", jsonRevenue);
          ContractForm.appendChild(revenue);

          // 매입세부정보
          const lengthPurchase = $('[name="purchaseId"]').length;
          const listPurchase = new Array();
          for (var i = 0; i <= lengthPurchase - 1; i++) {
              if ($('input[name="predictPurchaseDate"]').eq(i).val() == '') {
                  alert("매입세부정보의 매입예정일 입력해주세요.");
                  return false;
              }
              if ($('input[name="purchaseCompany"]').eq(i).val() == '') {
                  alert("매입세부정보의 매입처를 입력해주세요.");
                  return false;
              }
              if ($('input[name="purchasePrice"]').eq(i).val() == '') {
                  alert("매입세부정보의 매입금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.purchaseId = $('div[name="purchaseId"]').eq(i).text();
              data.predictPurchaseDate = $('input[name="predictPurchaseDate"]').eq(i).val();
              data.purchaseDate = $('input[name="purchaseDate"]').eq(i).val();
              data.predictWithdrawDate = $('input[name="predictWithdrawDate"]').eq(i).val();
              data.withdrawDate = $('input[name="withdrawDate"]').eq(i).val();
              data.purchaseCompany = $('input[name="purchaseCompany"]').eq(i).val();
              data.purchasePrice = $('input[name="purchasePrice"]').eq(i).val();
              data.purchaseComment = $('input[name="purchaseComment"]').eq(i).val();
              listPurchase.push(data);
          }
          const jsonPurchase = JSON.stringify(listPurchase);
          const purchase = document.createElement("input");
          purchase.setAttribute("type", "hidden");
          purchase.setAttribute("name", "jsonPurchase");
          purchase.setAttribute("value", jsonPurchase);
          ContractForm.appendChild(purchase);

          // 원가세부정보
          const lengthCost = $('[name="costId"]').length;
          const listCost = new Array();
          for (var i = 0; i <= lengthCost - 1; i++) {
              if ($('input[name="costDate"]').eq(i).val() == '') {
                  alert("원가세부정보의 매입연도를 입력해주세요.");
                  return false;
              }
              if ($('input[name="costCompany"]').eq(i).val() == '') {
                  alert("원가세부정보의 원가항목을 입력해주세요.");
                  return false;
              }
              if ($('input[name="costPrice"]').eq(i).val() == '') {
                  alert("원가세부정보의 원가금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.costId = $('div[name="costId"]').eq(i).text();
              data.costDate = $('input[name="costDate"]').eq(i).val();
              data.costCompany = $('input[name="costCompany"]').eq(i).val();
              data.costPrice = $('input[name="costPrice"]').eq(i).val();
              data.costComment = $('input[name="costComment"]').eq(i).val();
              listCost.push(data);
          }
          const jsonCost = JSON.stringify(listCost);
          const cost = document.createElement("input");
          cost.setAttribute("type", "hidden");
          cost.setAttribute("name", "jsonCost");
          cost.setAttribute("value", jsonCost);
          ContractForm.appendChild(cost);

          // 하도급계약 상세내용
          let sumPurchaseDetails = 0;
          let statusPurchaseDetails = false;
          // 1. 상품_HW
          const lengthGoodsHW = $('[name="goodsHWTypeId"]').length;
          const listGoodsHW = new Array();
          if (lengthGoodsHW>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthGoodsHW - 1; i++) {
              if ($('input[name="goodsHWCompany"]').eq(i).val() == '') {
                  alert("상품_HW의 거래처를 입력해주세요.");
                  return false;
              }
              if ($('input[name="goodsHWContents"]').eq(i).val() == '') {
                  alert("상품_HW의 내역을 입력해주세요.");
                  return false;
              }
              if ($('input[name="goodsHWPrice"]').eq(i).val() == '') {
                  alert("상품_HW의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="goodsHWTypeId"]').eq(i).text();
              data.company = $('input[name="goodsHWCompany"]').eq(i).val();
              data.contents = $('input[name="goodsHWContents"]').eq(i).val();
              data.price = Number($('input[name="goodsHWPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listGoodsHW.push(data);
          }
          const jsonGoodsHW = JSON.stringify(listGoodsHW);
          const goodsHW = document.createElement("input");
          goodsHW.setAttribute("type", "hidden");
          goodsHW.setAttribute("name", "jsonGoodsHW");
          goodsHW.setAttribute("value", jsonGoodsHW);
          ContractForm.appendChild(goodsHW);
          // 2. 상품_SW
          const lengthGoodsSW = $('[name="goodsSWTypeId"]').length;
          const listGoodsSW = new Array();
          if (lengthGoodsSW>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthGoodsSW - 1; i++) {
              if ($('input[name="goodsSWCompany"]').eq(i).val() == '') {
                  alert("상품_SW의 거래처를 입력해주세요.");
                  return false;
              }
              if ($('input[name="goodsSWContents"]').eq(i).val() == '') {
                  alert("상품_SW의 내역을 입력해주세요.");
                  return false;
              }
              if ($('input[name="goodsSWPrice"]').eq(i).val() == '') {
                  alert("상품_SW의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="goodsSWTypeId"]').eq(i).text();
              data.company = $('input[name="goodsSWCompany"]').eq(i).val();
              data.contents = $('input[name="goodsSWContents"]').eq(i).val();
              console.log($('input[name="goodsSWPrice"]').eq(i).val());
              data.price = Number($('input[name="goodsSWPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listGoodsSW.push(data);
          }
          const jsonGoodsSW = JSON.stringify(listGoodsSW);
          const goodsSW = document.createElement("input");
          goodsSW.setAttribute("type", "hidden");
          goodsSW.setAttribute("name", "jsonGoodsSW");
          goodsSW.setAttribute("value", jsonGoodsSW);
          ContractForm.appendChild(goodsSW);
          // 3. 유지보수_HW
          const lengthMaintenanceHW= $('[name="maintenanceHWTypeId"]').length;
          const listMaintenanceHW = new Array();
          if (lengthMaintenanceHW>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthMaintenanceHW - 1; i++) {
              if ($('input[name="maintenanceHWCompany"]').eq(i).val() == '') {
                  alert("유지보수_HW의 거래처를 입력해주세요.");
                  return false;
              }
              if ($('input[name="maintenanceHWContents"]').eq(i).val() == '') {
                  alert("유지보수_HW의 내역을 입력해주세요.");
                  return false;
              }
              if ($('input[name="maintenanceHWPrice"]').eq(i).val() == '') {
                  alert("유지보수_HW의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="maintenanceHWTypeId"]').eq(i).text();
              data.company = $('input[name="maintenanceHWCompany"]').eq(i).val();
              data.contents = $('input[name="maintenanceHWContents"]').eq(i).val();
              console.log($('input[name="maintenanceHWPrice"]').eq(i).val());
              data.price = Number($('input[name="maintenanceHWPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listMaintenanceHW.push(data);
          }
          const jsonMaintenanceHW = JSON.stringify(listMaintenanceHW);
          const maintenanceHW = document.createElement("input");
          maintenanceHW.setAttribute("type", "hidden");
          maintenanceHW.setAttribute("name", "jsonMaintenanceHW");
          maintenanceHW.setAttribute("value", jsonMaintenanceHW);
          ContractForm.appendChild(maintenanceHW);
           // 4. 유지보수_SW
          const lengthMaintenanceSW= $('[name="maintenanceSWTypeId"]').length;
          const listMaintenanceSW = new Array();
          if (lengthMaintenanceSW>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthMaintenanceSW - 1; i++) {
              if ($('input[name="maintenanceSWCompany"]').eq(i).val() == '') {
                  alert("유지보수_SW의 거래처를 입력해주세요.");
                  return false;
              }
              if ($('input[name="maintenanceSWContents"]').eq(i).val() == '') {
                  alert("유지보수_SW의 내역을 입력해주세요.");
                  return false;
              }
              if ($('input[name="maintenanceSWPrice"]').eq(i).val() == '') {
                  alert("유지보수_SW의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="maintenanceSWTypeId"]').eq(i).text();
              data.company = $('input[name="maintenanceSWCompany"]').eq(i).val();
              data.contents = $('input[name="maintenanceSWContents"]').eq(i).val();
              console.log($('input[name="maintenanceSWPrice"]').eq(i).val());
              data.price = Number($('input[name="maintenanceSWPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listMaintenanceSW.push(data);
          }
          const jsonMaintenanceSW = JSON.stringify(listMaintenanceSW);
          const maintenanceSW = document.createElement("input");
          maintenanceSW.setAttribute("type", "hidden");
          maintenanceSW.setAttribute("name", "jsonMaintenanceSW");
          maintenanceSW.setAttribute("value", jsonMaintenanceSW);
          ContractForm.appendChild(maintenanceSW);
           // 5. 인력지원_자사서비스
          const lengthSupportInternal= $('[name="supportInternalTypeId"]').length;
          const listSupportInternal = new Array();
          if (lengthSupportInternal>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthSupportInternal - 1; i++) {
              if ($('input[name="supportInternalType"]').eq(i).val() == '') {
                  alert("인력지원_자사서비스의 구분을 입력해주세요.");
                  return false;
              }
              if ($('input[name="supportInternalUnits"]').eq(i).val() == '') {
                  alert("인력지원_자사서비스의 단가를 입력해주세요.");
                  return false;
              }
              if ($('input[name="supportInternalPrice"]').eq(i).val() == '') {
                  alert("인력지원_자사서비스의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="supportInternalTypeId"]').eq(i).text();
              data.type = $('input[name="supportInternalType"]').eq(i).val();
              data.times = $('input[name="supportInternalTimes"]').eq(i).val();
              data.sites = $('input[name="supportInternalSites"]').eq(i).val();
              data.units = $('input[name="supportInternalUnits"]').eq(i).val();
              console.log($('input[name="supportInternalPrice"]').eq(i).val());
              data.price = Number($('input[name="supportInternalPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listSupportInternal.push(data);
          }
          const jsonSupportInternal = JSON.stringify(listSupportInternal);
          const supportInternal = document.createElement("input");
          supportInternal.setAttribute("type", "hidden");
          supportInternal.setAttribute("name", "jsonSupportInternal");
          supportInternal.setAttribute("value", jsonSupportInternal);
          ContractForm.appendChild(supportInternal);
           // 6. 인력지원_타사서비스
          const lengthSupportExternal= $('[name="supportExternalTypeId"]').length;
          const listSupportExternal = new Array();
          if (lengthSupportExternal>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthSupportExternal - 1; i++) {
              if ($('input[name="supportExternalType"]').eq(i).val() == '') {
                  alert("인력지원_타사서비스의 구분을 입력해주세요.");
                  return false;
              }
              if ($('input[name="supportExternalContents"]').eq(i).val() == '') {
                  alert("인력지원_타사서비스의 내역을 입력해주세요.");
                  return false;
              }
              if ($('input[name="supportExternalPrice"]').eq(i).val() == '') {
                  alert("인력지원_타사서비스의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="supportExternalTypeId"]').eq(i).text();
              data.type = $('input[name="supportExternalType"]').eq(i).val();
              data.contents = $('input[name="supportExternalContents"]').eq(i).val();
              console.log($('input[name="supportExternalPrice"]').eq(i).val());
              data.price = Number($('input[name="supportExternalPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listSupportExternal.push(data);
          }
          const jsonSupportExternal = JSON.stringify(listSupportExternal);
          const supportExternal = document.createElement("input");
          supportExternal.setAttribute("type", "hidden");
          supportExternal.setAttribute("name", "jsonSupportExternal");
          supportExternal.setAttribute("value", jsonSupportExternal);
          ContractForm.appendChild(supportExternal);
           // 7. DB COSTS
          const lengthDbCosts= $('[name="dbCostsTypeId"]').length;
          const listDbCosts = new Array();
          if (lengthDbCosts>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthDbCosts - 1; i++) {
              if ($('input[name="dbCostsNumber"]').eq(i).val() == '') {
                  alert("DB COSTS의 계약번호를 입력해주세요.");
                  return false;
              }
              if ($('input[name="dbCostsPrice"]').eq(i).val() == '') {
                  alert("DB COSTS의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="dbCostsTypeId"]').eq(i).text();
              data.number = $('input[name="dbCostsNumber"]').eq(i).val();
              data.start = $('input[name="dbCostsStart"]').eq(i).val();
              data.end = $('input[name="dbCostsEnd"]').eq(i).val();
              data.price = Number($('input[name="dbCostsPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listDbCosts.push(data);
          }
          const jsonDbCosts = JSON.stringify(listDbCosts);
          const dbCosts = document.createElement("input");
          dbCosts.setAttribute("type", "hidden");
          dbCosts.setAttribute("name", "jsonDbCosts");
          dbCosts.setAttribute("value", jsonDbCosts);
          ContractForm.appendChild(dbCosts);
           // 8. 기타
          const lengthOthers= $('[name="othersTypeId"]').length;
          const listOthers = new Array();
          if (lengthOthers>0){
              statusPurchaseDetails = true;
          }
          for (var i = 0; i <= lengthOthers - 1; i++) {
              if ($('input[name="othersType"]').eq(i).val() == '') {
                  alert("기타의 구분을 입력해주세요.");
                  return false;
              }
              if ($('input[name="othersContents"]').eq(i).val() == '') {
                  alert("기타의 내역을 입력해주세요.");
                  return false;
              }
              if ($('input[name="othersPrice"]').eq(i).val() == '') {
                  alert("기타의 금액을 입력해주세요.");
                  return false;
              }
              var data = new Object();
              data.typeId = $('div[name="othersTypeId"]').eq(i).text();
              data.type = $('input[name="othersType"]').eq(i).val();
              data.contents = $('input[name="othersContents"]').eq(i).val();
              console.log($('input[name="othersPrice"]').eq(i).val());
              data.price = Number($('input[name="othersPrice"]').eq(i).val().replace(/,/g, ''));
              sumPurchaseDetails += data.price;
              listOthers.push(data);
          }
          const jsonOthers = JSON.stringify(listOthers);
          const others = document.createElement("input");
          others.setAttribute("type", "hidden");
          others.setAttribute("name", "jsonOthers");
          others.setAttribute("value", jsonOthers);
          ContractForm.appendChild(others);

          // 금액 일치 계산
          let sumItemPrice = 0;
          for (i = 0; i < $('input[name="itemPrice"]').length; i++) {
              sumItemPrice += Number($('input[name="itemPrice"]').eq(i).val().replace(/,/g, ''));
          }
          if (sumItemPrice != $('#salePrice').val().replace(/,/g, '')) {
              alert("계약금액 : " + ($('#salePrice').val() * 1).toLocaleString() + "\n" +
                  "세부금액 : " + sumItemPrice.toLocaleString() + "\n" +
                  "계약금액과 세부사항 금액의 합이 일치하지 않습니다.");
              return false;
          }

          if ('{{ contractStep }}' !== 'Drop') {
              let sumRevenuePrice = 0;
              for (i = 0; i < $('input[name="revenuePrice"]').length; i++) {
                  sumRevenuePrice += Number($('input[name="revenuePrice"]').eq(i).val().replace(/,/g, ''));
              }
              if (sumRevenuePrice != $('#salePrice').val().replace(/,/g, '')) {
                  alert("계약금액 : " + ($('#salePrice').val() * 1).toLocaleString() + "\n" +
                      "매출금액 : " + sumRevenuePrice.toLocaleString() + "\n" +
                      "계약금액과 매출금액의 합이 일치하지 않습니다.");
                  return false;
              }

              let sumRevenueProfitPrice = 0;
              for (i = 0; i < $('input[name="revenueProfitPrice"]').length; i++) {
                  sumRevenueProfitPrice += Number($('input[name="revenueProfitPrice"]').eq(i).val().replace(/,/g, ''));
              }
              if (sumRevenueProfitPrice != $('#profitPrice').val().replace(/,/g, '')) {
                  alert("이익금액 : " + ($('#profitPrice').val() * 1).toLocaleString() + "\n" +
                      "GP : " + sumRevenueProfitPrice.toLocaleString() + "\n" +
                      "이익금액과 GP의 합이 일치하지 않습니다.");
                  return false;
              }

              let sumPurchasePrice = 0;
              for (i = 0; i < $('input[name="purchasePrice"]').length; i++) {
                  sumPurchasePrice += Number($('input[name="purchasePrice"]').eq(i).val().replace(/,/g, ''));
              }

              let sumCostPrice = 0;
              for (i = 0; i < $('input[name="costPrice"]').length; i++) {
                  sumCostPrice += Number($('input[name="costPrice"]').eq(i).val().replace(/,/g, ''));
              }

              if (statusPurchaseDetails == true){
                let sumPurchase = sumPurchasePrice+sumCostPrice;
                if (sumPurchaseDetails != sumPurchase){
                    alert("매입금액 합계금액: " + sumPurchase.toLocaleString() + "\n" +
                      "하도급계약 합계금액 : " + sumPurchaseDetails.toLocaleString() + "\n" +
                      "매입금액 하도급계약 금액의 합이 일치하지 않습니다.")
                }
              }

              let revenueMinusPurchase = sumRevenuePrice - sumPurchasePrice;
              {#if (revenueMinusPurchase != sumRevenueProfitPrice) {#}
              {#    alert("매출금액 : " + sumRevenuePrice.toLocaleString() + "\n" +#}
              {#        "매입금액 : " + sumRevenueProfitPrice.toLocaleString() + "\n" +#}
              {#        "매출-매입 : " + revenueMinusPurchase.toLocaleString() + "\n" +#}
              {#        "GP : " + sumRevenueProfitPrice.toLocaleString() + "\n" +#}
              {#        "매출금액 - 매입금액이 GP와 일치하지 않습니다.");#}
              {#    return false;}#}
          }

          if (confirm("저장 하시겠습니까?") === true) {
              ContractForm.submit();
          }
      }

      function itemChange(main, sub) {
          var selectItem = $(main).val();

          $.ajax({
              url: "{% url 'sales:category_ajax_url' %}",
              method: 'POST',
              cache: false,
              data: {"mainCategory": selectItem},
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnData) {
                  var mainCategory = returnData;
                  $(sub).empty();

                  for (var count = 0; count < mainCategory.length; count++) {
                      var option = $("<option value=" + mainCategory[count].fields.subCategory + ">" + mainCategory[count].fields.subCategory + "</option>");
                      $(sub).append(option);
                  }
              }
          });
      }

      function itemChangeAdd(main, sub, subCategory, itemCounter) {
          if ($.type(main) === 'string') {
              main = '#' + main
          }
          if ($.type(sub) === 'string') {
              sub = '#' + sub
          }
          var selectItem = $(main).val();

          $.ajax({
              url: "{% url 'sales:category_ajax_url' %}",
              method: 'POST',
              cache: false,
              data: {"mainCategory": selectItem},
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnData) {
                  var mainCategory = returnData;
                  $(sub).empty();

                  for (var count = 0; count < mainCategory.length; count++) {
                      var option = $("<option value=" + mainCategory[count].fields.subCategory + ">" + mainCategory[count].fields.subCategory + "</option>");
                      $(sub).append(option);
                      $('#item2' + itemCounter).val(subCategory).prop("selected", true);
                  }
              }
          });
      }

      function changeRevenueCompany() {
          $('input[name=revenueCompany]').trigger('set', {id: $('#saleCompanyNames').attr('data-id')});
      }

      function changeStep(t2, t3, t4, c1, c2, c3, c4, c5, c6, c7, c8) {
          const contractStep = '{{ contractStep }}';
          if (contractStep === 'Firm') {
              $('#contractStartDate').removeAttr('readonly');
              $('#contractEndDate').removeAttr('readonly');
              $('span[name=predict]').addClass('d-none');
          } else {
              $('#contractStartDate').val('');
              $('#contractStartDate').attr('readonly', '');
              $('#contractEndDate').val('');
              $('#contractEndDate').attr('readonly', '');
              $('span[name=predict]').removeClass('d-none');
          }

          if (contractStep === 'Drop') {
              t2.rows().remove().draw();
              $('#revenuediv').addClass('d-none');
              t3.rows().remove().draw();
              $('#purchasediv').addClass('d-none');
              t4.rows().remove().draw();
              $('#costdiv').addClass('d-none');
              c1.rows().remove().draw();
              c2.rows().remove().draw();
              c3.rows().remove().draw();
              c4.rows().remove().draw();
              c5.rows().remove().draw();
              c6.rows().remove().draw();
              c7.rows().remove().draw();
              c8.rows().remove().draw();
              $('#purchasetypediv').addClass('d-none');
          } else {
              $('#revenuediv').removeClass('d-none');
              if (t2.rows().data().length === 0) {
                  $('#addRevenue').click();
              }
              $('#purchasediv').removeClass('d-none');
              if (t3.rows().data().length === 0) {
                  $('#addPurchase').click();
              }
              $('#costdiv').removeClass('d-none');
              if (t4.rows().data().length === 0) {
                  $('#addCost').click();
              }
              $('#purchasetypediv').removeClass('d-none');
              if (c1.rows().data().length === 0) {
                  $('#addGoodsHW').click();
              }
              if (c2.rows().data().length === 0) {
                  $('#addGoodsSW').click();
              }
              if (c3.rows().data().length === 0) {
                  $('#addMaintenanceHW').click();
              }
              if (c4.rows().data().length === 0) {
                  $('#addMaintenanceSW').click();
              }
              if (c5.rows().data().length === 0) {
                  $('#addSupportInternal').click();
              }
              if (c6.rows().data().length === 0) {
                  $('#addSupportExternal').click();
              }
              if (c7.rows().data().length === 0) {
                  $('#addDbCosts').click();
              }
              if (c8.rows().data().length === 0) {
                  $('#addOthers').click();
              }
          }
      }

      function changeCondition() {
          if ($('#depositCondition').val() == '계산서 발행 후' || $('#depositCondition').val() == '당월' || $('#depositCondition').val() == '익월') {
              $('#depositConditionDay').removeAttr('readonly');
          } else {
              $('#depositConditionDay').val(0);
              $('#depositConditionDay').attr('readonly', '');
          }
      }

      function changeBillingDates(billingDate, predictBillingDate, predictExecutionDate) {
          const date = $('#' + billingDate).val();
          $('#' + predictBillingDate).val(date.substring(0, 7));

          if (typeof (predictExecutionDate) != 'undefined') {
              const condition = $('#depositCondition').val();
              if (condition === '당월 말') {
                  const tmld = new Date(date.substring(0, 4), date.substring(5, 7), 0);
                  $('#' + predictExecutionDate).val(date.substring(0, 8) + tmld.getDate());
              } else if (condition === '익월 초') {
                  const nmfd = new Date(date.substring(0, 4), date.substring(5, 7), 1);
                  $('#' + predictExecutionDate).val(nmfd.getFullYear() + '-' + ((nmfd.getMonth() + 1) > 9 ? '' : '0') + (nmfd.getMonth() + 1) + '-' + '01');
              } else if (condition === '익월 말') {
                  const nmld = new Date(date.substring(0, 4), date.substring(5, 7) * 1 + 1, 0);
                  $('#' + predictExecutionDate).val(nmld.getFullYear() + '-' + ((nmld.getMonth() + 1) > 9 ? '' : '0') + (nmld.getMonth() + 1) + '-' + (nmld.getDate() > 9 ? '' : '0') + nmld.getDate());
              } else if (condition === '계산서 발행 후') {
                  const aftd = new Date(date.substring(0, 4), date.substring(5, 7) * 1 - 1, date.substring(8, 10));
                  aftd.setDate(aftd.getDate() + $('#depositConditionDay').val() * 1);
                  $('#' + predictExecutionDate).val(aftd.getFullYear() + '-' + ((aftd.getMonth() + 1) > 9 ? '' : '0') + (aftd.getMonth() + 1) + '-' + (aftd.getDate() > 9 ? '' : '0') + aftd.getDate());
              } else if (condition === '당월') {
                  const tmsd = new Date(date.substring(0, 4), date.substring(5, 7) * 1 - 1, $('#depositConditionDay').val());
                  $('#' + predictExecutionDate).val(tmsd.getFullYear() + '-' + ((tmsd.getMonth() + 1) > 9 ? '' : '0') + (tmsd.getMonth() + 1) + '-' + (tmsd.getDate() > 9 ? '' : '0') + tmsd.getDate());
              } else if (condition === '익월') {
                  const nmsd = new Date(date.substring(0, 4), date.substring(5, 7) * 1, $('#depositConditionDay').val());
                  $('#' + predictExecutionDate).val(nmsd.getFullYear() + '-' + ((nmsd.getMonth() + 1) > 9 ? '' : '0') + (nmsd.getMonth() + 1) + '-' + (nmsd.getDate() > 9 ? '' : '0') + nmsd.getDate());
              }
          }
      }

      function changeExecutionDates(executionDate, predictExecutionDate) {
          const date = $('#' + executionDate).val();
          $('#' + predictExecutionDate).val(date);
      }

      function totalPrice(inputName, className) {
          let price = 0;
          for (var i = 0; i < $('input[name=' + inputName + ']').length; i++) {
              price += Number($('input[name=' + inputName + ']').eq(i).val().replace(/,/g, ''));
          }
          $('.' + className).text(price.toLocaleString());
      }

      function downClick(table, up, down) {
          $('#' + table).addClass('d-none');
          $('#' + up).removeClass('d-none');
          $('#' + down).addClass('d-none');
      }

      function upClick(table, up, down) {
          $('#' + table).removeClass('d-none');
          $('#' + up).addClass('d-none');
          $('#' + down).removeClass('d-none');
      }

      function typeChange() {
          const saleType = $("#saleType").val();
          const saleCompanyNames = $("#saleCompanyNames").attr('data-id');
          const endCompanyNames = $('#endCompanyNames');
          if(saleType == '직판'){
              endCompanyNames.trigger('set',{id: saleCompanyNames});
          }else{
              endCompanyNames.trigger('clear');
          }
      }


      $(document).ready(function () {
          // 담당자 등록 고객사명 자동완성
          const customerCompany = document.getElementById('customerCompany');
          $('#customerCompany').magicsearch({
              dataSource: companyList,
              fields: 'value',
              id: 'id',
              format: '%value%',
              multiStyle: {space: 5, width: 80},
              noResult: '검색결과없음',
              focusShow: true,
          });

          customerCompany.removeAttribute("style");
          customerCompany.parentElement.removeAttribute("style");

          // 거래처 자동완성
          const saleCompanyNames = document.getElementById('saleCompanyNames');
          {% if saleCompanyNames %}
              saleCompanyNames.setAttribute("data-id", "{{ saleCompanyNames }}");
          {% endif %}
          $('#saleCompanyNames').magicsearch({
              dataSource: companyList,
              fields: 'value',
              id: 'id',
              format: '%value%',
              multiStyle: {space: 5, width: 80},
              noResult: '검색결과없음',
              focusShow: true,
              maxShow: 100,
              success: function ($input, data) {
                  $.ajax({
                      url: "{% url 'sales:salemanager_ajax_url' %}",
                      method: 'POST',
                      cache: false,
                      data: {"saleCompanyName": data.id},
                      headers: {'X-CSRFToken': '{{ csrf_token }}'},
                      success: function (returnData) {
                          const saleType = $("#saleType").val();
                          const endCompanyNames = $('#endCompanyNames');
                          if(saleType == '직판'){
                              endCompanyNames.trigger('set',{id: data.id});
                          }
                          var salecompany = returnData;
                          $('#saleCustomerId').empty();
                          $('#saleCustomerId').append('<option value="" selected="">---------</option>');

                          for (var count = 0; count < salecompany.length; count++) {
                              var option = $("<option value=" + salecompany[count].pk + ">" + salecompany[count].fields.customerName + "</option>");
                              $('#saleCustomerId').append(option);
                          }
                          $('#saleTaxCustomerId').empty();
                          $('#saleTaxCustomerId').append('<option value="" selected="">---------</option>');

                          for (var count = 0; count < salecompany.length; count++) {
                              var option = $("<option value=" + salecompany[count].pk + ">" + salecompany[count].fields.customerName + "</option>");
                              $('#saleTaxCustomerId').append(option);
                          }
                      }
                  });
              }
          });
          saleCompanyNames.removeAttribute("style");
          saleCompanyNames.parentElement.removeAttribute("style");

          const endCompanyNames = document.getElementById('endCompanyNames');
          // 최종고객사 자동완성
          {% if endCompanyNames %}
              endCompanyNames.setAttribute("data-id", "{{ endCompanyNames }}");
          {% endif %}
          $('#endCompanyNames').magicsearch({
              dataSource: companyList,
              fields: 'value',
              id: 'id',
              format: '%value%',
              multiStyle: {space: 5, width: 80},
              noResult: '검색결과없음',
              focusShow: true,
              maxShow: 100,
          });
          endCompanyNames.removeAttribute("style");
          endCompanyNames.parentElement.removeAttribute("style");

          // 이익율 자동계산
          $('#salePrice').on("propertychange change keyup paste input", function () {
              const salePrice = $('#salePrice').val().replace(/,/g, '');
              const profitPrice = $('#profitPrice').val().replace(/,/g, '');
              if (salePrice === '0') {
                  $('#profitRatio').val(0);
              } else {
                  $('#profitRatio').val(((profitPrice / salePrice) * 100).toFixed(0));
              }
          });

          $('#profitPrice').on("propertychange change keyup paste input", function () {
              const salePrice = $('#salePrice').val().replace(/,/g, '');
              const profitPrice = $('#profitPrice').val().replace(/,/g, '');
              if (salePrice === '0') {
                  $('#profitRatio').val(0);
              } else {
                  $('#profitRatio').val(((profitPrice / salePrice) * 100).toFixed(0));
              }
          });

          // 계약종료일 자동입력
          $('#contractStartDate').on("propertychange change keyup paste input", function () {
              $('#contractEndDate').val($('#contractStartDate').val());
          });

          // 수금조건
          changeCondition();

          $('#depositCondition').on("propertychange change keyup paste input", function () {
              changeCondition();
          });

          // 세부사항
          var t1 = $('#categoryItem').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "24%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "24%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "24%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "24%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var itemCounter = 0;

          $('#addItem').on('click', function () {
              t1.row.add([
                  '<div class="text-center d-none" value="0" name="itemId" id="item0' + itemCounter + '">추가</div>',
                  '<select style="width:200px" class="input-form" size="1" id="item1' + itemCounter + '" name="mainCategory" onchange="itemChange( item1' + itemCounter + ",item2" + itemCounter + ')">' +
                  '<option value="" selected="selected">--대분류--</option>' +
                  '<option value="상품_Oracle">상품_Oracle</option>' +
                  '<option value="상품_IBM">상품_IBM</option>' +
                  '<option value="상품_Lenovo">상품_Lenovo</option>' +
                  '<option value="상품_DELL">상품_DELL</option>' +
                  '<option value="상품_기타">상품_기타</option>' +
                  '<option value="용역_유지보수">용역_유지보수</option>' +
                  '<option value="용역_기술지원">용역_기술지원</option></select>',
                  '<select style="width:200px" class="input-form" size="1" id="item2' + itemCounter + '" name="subCategory"> <option value="init" selected="selected">--소분류--</option>',
                  '<input style="width:200px" class="input-form" type="text" name="itemName" id="item3' + itemCounter + '">',
                  '<input style="width:200px" class="money input-form" name="itemPrice" id="item4' + itemCounter + '">',
                  '<i class="fas fa-times-circle" name="remove" >'
              ]).draw(false);
              itemCounter++;
              $('.money').simpleMoneyFormat();
              $('input[name=itemPrice]').on("change keyup paste input", function() {
                  totalPrice('itemPrice', 'totalItemPrice');
              });
          });

          {% if items %}
              {% for item in items %}
                  t1.row.add([
                      '<div class="text-center d-none" value="0" name="itemId" id="item0' + itemCounter + '">{{ item.contractItemId }}</div>',
                      '<select style="width:200px" class="input-form" size="1" id="item1' + itemCounter + '" name="mainCategory" onchange="itemChange( item1' + itemCounter + ",item2" + itemCounter + ')">' +
                      '<option value="" selected="selected">--대분류--</option>' +
                      '<option value="상품_Oracle">상품_Oracle</option>' +
                      '<option value="상품_IBM">상품_IBM</option>' +
                      '<option value="상품_Lenovo">상품_Lenovo</option>' +
                      '<option value="상품_DELL">상품_DELL</option>' +
                      '<option value="상품_기타">상품_기타</option>' +
                      '<option value="용역_유지보수">용역_유지보수</option>' +
                      '<option value="용역_기술지원">용역_기술지원</option></select>',
                      '<select style="width:200px" class="input-form" size="1" id="item2' + itemCounter + '" name="subCategory"> <option value="init" selected="selected">--소분류--</option>',
                      '<input style="width:200px" class="input-form" type="text" name="itemName" id="item3' + itemCounter + '" value="{{ item.itemName }}">',
                      '<input style="width:200px" class="money input-form" name="itemPrice" id="item4' + itemCounter + '" value="{{ item.itemPrice }}">',
                      '<i class="fas fa-times-circle" name="remove" >'
                  ]).draw(false);
                  $('#item1' + itemCounter).val("{{ item.mainCategory }}").prop("selected", true);
                  itemChangeAdd("item1" + itemCounter, "item2" + itemCounter, "{{ item.subCategory }}", itemCounter);
                  itemCounter++;
              {% endfor %}
              $('.money').simpleMoneyFormat();
              $('input[name=itemPrice]').on("change keyup paste input", function() {
                  totalPrice('itemPrice', 'totalItemPrice');
              });
          {% else %}
              $('#addItem').click();
          {% endif %}

          $('#categoryItem').on('click', 'i', function () {
              t1
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 매출세부정보
          var t2 = $('#revenue').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var revenueCounter = 0;

          $('#addRevenue').on('click', function () {
              t2.row.add([
                  '<div class="text-center d-none" value="0" name="revenueId" id="revenue0' + revenueCounter + '">추가</div>',
                  '<input class="input-form" type="month" max="9999-12" name="predictBillingDate" id="revenue1' + revenueCounter + '">',
                  '<input class="input-form" type="date" max="9999-12-31" name="billingDate" id="revenue2' + revenueCounter + '" ' +
                  'onchange="changeBillingDates(\'revenue2' + revenueCounter + '\',\'revenue1' + revenueCounter + '\',\'revenue3' + revenueCounter + '\')">',
                  '<input class="input-form" type="date" max="9999-12-31" name="predictDepositDate" id="revenue3' + revenueCounter + '">',
                  '<input class="input-form" type="date" max="9999-12-31" name="depositDate" id="revenue4' + revenueCounter + '" ' +
                  'onchange="changeExecutionDates(\'revenue4' + revenueCounter + '\',\'revenue3' + revenueCounter + '\')">',
                  '<input class="magicsearch input-form" autocomplete="off" type="text" name="revenueCompany" ' +
                  'id="revenue5' + revenueCounter + '" onkeydown="magicsearchtab(revenue5' + revenueCounter + ')">',
                  '<input class="money input-form" name="revenuePrice" id="revenue6' + revenueCounter + '">',
                  '<input class="money input-form" name="revenueProfitPrice" id="revenue7' + revenueCounter + '">',
                  '<input class="input-form" type="text" name="revenueComment" id="revenue8' + revenueCounter + '">',
                  '<i class="fas fa-times-circle" name="remove">'
              ]).draw(false);
              $('.money').simpleMoneyFormat();
              document.getElementById("revenue5" + revenueCounter).setAttribute("data-id", $('#saleCompanyNames').attr('data-id'));
              $('#revenue5' + revenueCounter).magicsearch({
                  dataSource: companyList,
                  fields: 'value',
                  id: 'id',
                  format: '%value%',
                  multiStyle: {space: 5, width: 80},
                  noResult: '검색결과없음',
                  focusShow: true,
                  maxShow: 100,
              });

              $('input[name=revenuePrice]').on("change keyup paste input", function() {
                  totalPrice('revenuePrice', 'totalRevenuePrice');
              });
              $('input[name=revenueProfitPrice]').on("change keyup paste input", function() {
                  totalPrice('revenueProfitPrice', 'totalRevenueProfitPrice');
              });

              revenueCounter++;
          });

          {% if revenues %}
              {% for revenue in revenues %}
                  t2.row.add([
                      '<div class="text-center d-none" value="0" name="revenueId" id="revenue0' + revenueCounter + '">{{ revenue.revenueId }}</div>',
                      '<input class="input-form" type="month" max="9999-12" name="predictBillingDate" id="revenue1' + revenueCounter + '" value="{{ revenue.predictBillingDate | date:"Y-m" }}">',
                      '<input class="input-form" type="date" max="9999-12-31" name="billingDate" id="revenue2' + revenueCounter + '" value="{{ revenue.billingDate | date:"Y-m-d" }}" ' +
                      'onchange="changeBillingDates(\'revenue2' + revenueCounter + '\',\'revenue1' + revenueCounter + '\',\'revenue3' + revenueCounter + '\')">',
                      '<input class="input-form" type="date" max="9999-12-31" name="predictDepositDate" id="revenue3' + revenueCounter + '" value="{{ revenue.predictDepositDate | date:"Y-m-d" }}">',
                      '<input class="input-form" type="date" max="9999-12-31" name="depositDate" id="revenue4' + revenueCounter + '" value="{{ revenue.depositDate | date:"Y-m-d" }}" ' +
                      'onchange="changeExecutionDates(\'revenue4' + revenueCounter + '\',\'revenue3' + revenueCounter + '\')">',
                      '<input class="magicsearch input-form" autocomplete="off" type="text" name="revenueCompany" id="revenue5' + revenueCounter + '" data-id="{{ revenue.revenueCompany }}" onkeydown="magicsearchtab(revenue5' + revenueCounter + ')">',
                      '<input class="money input-form" name="revenuePrice" id="revenue6' + revenueCounter + '" value="{{ revenue.revenuePrice }}">',
                      '<input class="money input-form" name="revenueProfitPrice" id="revenue7' + revenueCounter + '" value="{{ revenue.revenueProfitPrice }}">',
                      '<input class="input-form" type="text" name="revenueComment" id="revenue8' + revenueCounter + '" value="{{ revenue.comment }}">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  revenueCounter++;
              {% endfor %}
              t2.draw();
              for (var r = 0; r < revenueCounter; r++) {
                  $('#revenue5' + r).magicsearch({
                      dataSource: companyList,
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();
              $('input[name=revenuePrice]').on("change keyup paste input", function() {
                  totalPrice('revenuePrice', 'totalRevenuePrice');
              });
              $('input[name=revenueProfitPrice]').on("change keyup paste input", function() {
                  totalPrice('revenueProfitPrice', 'totalRevenueProfitPrice');
              });
          {% else %}
              $('#addRevenue').click();
          {% endif %}

          $('#revenue').on('click', 'i', function () {
              t2
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 매입세부정보 (세금계산서 접수항목)
          var t3 = $('#purchase').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "18%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "18%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var purchaseCounter = 0;

          $('#addPurchase').on('click', function () {
              t3.row.add([
                  '<div class="text-center d-none" value="0" name="purchaseId" id="purchase0' + purchaseCounter + '">추가</div>',
                  '<input class="input-form" type="month" max="9999-12" name="predictPurchaseDate" id="purchase1' + purchaseCounter + '">',
                  '<input class="input-form" type="date" max="9999-12-31" name="purchaseDate" id="purchase2' + purchaseCounter + '" ' +
                  'onchange="changeBillingDates(\'purchase2' + purchaseCounter + '\',\'purchase1' + purchaseCounter + '\')">',
                  '<input class="input-form" type="date" max="9999-12-31" name="predictWithdrawDate" id="purchase3' + purchaseCounter + '">',
                  '<input class="input-form" type="date" max="9999-12-31" name="withdrawDate" id="purchase4' + purchaseCounter + '" ' +
                  'onchange="changeExecutionDates(\'purchase4' + purchaseCounter + '\',\'purchase3' + purchaseCounter + '\')">',
                  '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 255px;" name="purchaseCompany" ' +
                  'id="purchase5' + purchaseCounter + '" onkeydown="magicsearchtab(purchase5' + purchaseCounter + ')">',
                  '<input class="money input-form" style="width: 255px;"  name="purchasePrice" id="purchase6' + purchaseCounter + '">',
                  '<input class="input-form" type="text" name="purchaseComment" id="purchase7' + purchaseCounter + '">',
                  '<i class="fas fa-times-circle" name="remove">'
              ]).draw(false);
              $('.money').simpleMoneyFormat();
              $('#purchase5' + purchaseCounter).magicsearch({
                  dataSource: companyList,
                  fields: 'value',
                  id: 'id',
                  format: '%value%',
                  multiStyle: {space: 5, width: 80},
                  noResult: '검색결과없음',
                  focusShow: true,
                  maxShow: 100,
              });

              $('input[name=purchasePrice]').on("change keyup paste input", function() {
                  totalPrice('purchasePrice', 'totalPurchasePrice');
              });

              purchaseCounter++;
          });

          {% if purchases %}
              {% for purchase in purchases %}
                  t3.row.add([
                      '<div class="text-center d-none" value="0" name="purchaseId" id="purchase0' + purchaseCounter + '">{{ purchase.purchaseId }}</div>',
                      '<input class="input-form" type="month" max="9999-12" name="predictPurchaseDate" id="purchase1' + purchaseCounter + '" value="{{ purchase.predictBillingDate | date:"Y-m" }}">',
                      '<input class="input-form" type="date" max="9999-12-31" name="purchaseDate" id="purchase2' + purchaseCounter + '" value="{{ purchase.billingDate | date:"Y-m-d" }}" ' +
                      'onchange="changeBillingDates(\'purchase2' + purchaseCounter + '\',\'purchase1' + purchaseCounter + '\')">',
                      '<input class="input-form" type="date" max="9999-12-31" name="predictWithdrawDate" id="purchase3' + purchaseCounter + '" value="{{ purchase.predictWithdrawDate | date:"Y-m-d" }}">',
                      '<input class="input-form" type="date" max="9999-12-31" name="withdrawDate" id="purchase4' + purchaseCounter + '" value="{{ purchase.withdrawDate | date:"Y-m-d" }}" ' +
                      'onchange="changeExecutionDates(\'purchase4' + purchaseCounter + '\',\'purchase3' + purchaseCounter + '\')">',
                      '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 255px;" name="purchaseCompany" id="purchase5' + purchaseCounter + '" data-id="{{ purchase.purchaseCompany }}" onkeydown="magicsearchtab(purchase5' + purchaseCounter + ')">',
                      '<input class="money input-form" style="width: 255px;" name="purchasePrice" id="purchase6' + purchaseCounter + '" value="{{ purchase.purchasePrice }}">',
                      '<input class="input-form" type="text" name="purchaseComment" id="purchase7' + purchaseCounter + '" value="{{ purchase.comment }}">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  purchaseCounter++;
              {% endfor %}
              t3.draw();
              for (var p = 0; p < purchaseCounter; p++) {
                  $('#purchase5' + p).magicsearch({
                      dataSource: companyList,
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=purchasePrice]').on("change keyup paste input", function() {
                  totalPrice('purchasePrice', 'totalPurchasePrice');
              });
          {% else %}
              $('#addPurchase').click();
          {% endif %}

          $('#purchase').on('click', 'i', function () {
              t3
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 매입세부정보 (세금계산서 미접수항목)
          var t4 = $('#cost').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "18%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "18%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "12%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var costCounter = 0;

          $('#addCost').on('click', function () {
              t4.row.add([
                  '<div class="d-none" value="0" name="costId" id="cost0' + costCounter + '">추가</div>',
                  '<input class="input-form d-none" type="month" max="9999-12" name="" id="cost1' + costCounter + '">',
                  '<input class="input-form d-none" type="date" max="9999-12-31" name="" id="cost2' + costCounter + '" ' +
                  'onchange="changeBillingDates(\'cost2' + costCounter + '\',\'cost1' + costCounter + '\')">',
                  '<input class="input-form d-none" type="date" max="9999-12-31" name="" id="cost3' + costCounter + '">',
                  '<input class="input-form" type="number" min="1000" max="9999" name="costDate" id="cost4' + costCounter + '">',
                  '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 255px;" name="costCompany" ' +
                  'id="cost5' + costCounter + '" onkeydown="magicsearchtab(cost5' + costCounter + ')">',
                  '<input class="money input-form" style="width: 255px;"  name="costPrice" id="cost6' + costCounter + '">',
                  '<input class="input-form" type="text" name="costComment" id="cost7' + costCounter + '">',
                  '<i class="fas fa-times-circle" name="remove">'
              ]).draw(false);
              $('.money').simpleMoneyFormat();
              $('#cost5' + costCounter).magicsearch({
                  dataSource: {{ costCompany | safe }},
                  fields: 'value',
                  id: 'id',
                  format: '%value%',
                  multiStyle: {space: 5, width: 80},
                  noResult: '검색결과없음',
                  focusShow: true,
                  maxShow: 100,
              });

              $('input[name=costPrice]').on("change keyup paste input", function() {
                  totalPrice('costPrice', 'totalCostPrice');
              });

              costCounter++;
          });

          {% if costs %}
              {% for cost in costs %}
                  t4.row.add([
                      '<div class="d-none" value="0" name="costId" id="cost0' + costCounter + '">{{ cost.costId }}</div>',
                      '<input class="input-form d-none" type="month" max="9999-12" name="" id="cost1' + costCounter + '" value="">',
                      '<input class="input-form d-none" type="date" max="9999-12-31" name="" id="cost2' + costCounter + '" value="" ' +
                      'onchange="changeBillingDates(\'cost2' + costCounter + '\',\'cost1' + costCounter + '\')">',
                      '<input class="input-form d-none" type="date" max="9999-12-31" name="" id="cost3' + costCounter + '" value="">',
                      '<input class="input-form" type="number" min="1000" max="9999" name="costDate" id="cost4' + costCounter + '" value="{{ cost.billingDate | date:"Y" }}">',
                      '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 255px;" name="costCompany" id="cost5' + costCounter + '" data-id="{{ cost.costCompany }}" onkeydown="magicsearchtab(cost5' + costCounter + ')">',
                      '<input class="money input-form" style="width: 255px;" name="costPrice" id="cost6' + costCounter + '" value="{{ cost.costPrice }}">',
                      '<input class="input-form" type="text" name="costComment" id="cost7' + costCounter + '" value="{{ cost.comment }}">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  costCounter++;
              {% endfor %}
              t4.draw();
              for (var c = 0; c < costCounter; c++) {
                  $('#cost5' + c).magicsearch({
                      dataSource: {{ costCompany | safe }},
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=costPrice]').on("change keyup paste input", function() {
                  totalPrice('costPrice', 'totalcostPrice');
              });
          {% else %}
              $('#addCost').click();
          {% endif %}

          $('#cost').on('click', 'i', function () {
              t4
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 하도급계약 상세항목
          // 1. 상품 HW
          var c1 = $('#goodsHW').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "0%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "50%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "26%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });
          var goodsHWCounter = 0;

          $('#addGoodsHW').on('click', function () {
            c1.row.add([
                '<div class="d-none" value="0" name="goodsHWTypeId" id="goodsHW0' + goodsHWCounter + '">추가</div>',
                '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" name="goodsHWCompany" ' +
                'id="goodsHW1' + goodsHWCounter + '" onkeydown="magicsearchtab(goodsHW1' + goodsHWCounter + ')">',
                '<input class="input-form" type="text" style="width: 350px;" name="goodsHWContents" id="goodsHW2' + goodsHWCounter + '">',
                '<input class="money input-form"  name="goodsHWPrice" style="width: 200px;" id="goodsHW3' + goodsHWCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('#goodsHW1' + goodsHWCounter).magicsearch({
                dataSource: companyList,
                fields: 'value',
                id: 'id',
                format: '%value%',
                multiStyle: {space: 5, width: 80},
                noResult: '검색결과없음',
                focusShow: true,
                maxShow: 100,
            });

              $('input[name=goodsHWPrice]').on("change keyup paste input", function() {
                  totalPrice('goodsHWPrice', 'totalGoodsHWPrice');
              });

              goodsHWCounter++;
          });

          {% if goodsHWs %}
              {% for goodsHW in goodsHWs %}
              console.log("{{ goodsHW.companyName }}");
                  c1.row.add([
                      '<div class="d-none" value="0" name="goodsHWTypeId" id="goodsHW0' + goodsHWCounter + '">{{ goodsHW.typeId }}</div>',
                      '<input class="magicsearch input-form" autocomplete="off" data-id="{{ goodsHW.companyName }}" type="text" style="width: 200px;" name="goodsHWCompany" ' +
                      'id="goodsHW1' + goodsHWCounter + '" onkeydown="magicsearchtab(goodsHW1' + goodsHWCounter + ')">',
                      '<input class="input-form" type="text" style="width: 350px;" value="{{ goodsHW.contents }}" name="goodsHWContents" id="goodsHW2' + goodsHWCounter + '">',
                      '<input class="money input-form"  name="goodsHWPrice" value="{{ goodsHW.price }}" style="width: 200px;" id="goodsHW3' + goodsHWCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  goodsHWCounter++;
              {% endfor %}
              c1.draw();
              console.log(goodsHWCounter);
              for (var c = 0; c < goodsHWCounter; c++) {
                  $('#goodsHW1' + c).magicsearch({
                      dataSource: companyList,
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=goodsHWPrice]').on("change keyup paste input", function() {
                  totalPrice('goodsHWPrice', 'totalGoodsHWPrice');
              });
          // {% else %}
          //     $('#addGoodsHW').click();
          {% endif %}

           $('#goodsHW').on('click', 'i', function () {
              c1
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 2. 상품 SW
          var c2 = $('#goodsSW').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "0%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "50%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "26%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var goodsSWCounter = 0;

          $('#addGoodsSW').on('click', function () {
            c2.row.add([
                '<div class="d-none" value="0" name="goodsSWTypeId" id="goodsSW0' + goodsSWCounter + '">추가</div>',
                '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" name="goodsSWCompany" ' +
                'id="goodsSW1' + goodsSWCounter + '" onkeydown="magicsearchtab(goodsSW1' + goodsSWCounter + ')">',
                '<input class="input-form" type="text" style="width: 350px;" name="goodsSWContents" id="goodsSW2' + goodsSWCounter + '">',
                '<input class="money input-form"  name="goodsSWPrice" style="width: 200px;" id="goodsSW3' + goodsSWCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('#goodsSW1' + goodsSWCounter).magicsearch({
                dataSource: companyList,
                fields: 'value',
                id: 'id',
                format: '%value%',
                multiStyle: {space: 5, width: 80},
                noResult: '검색결과없음',
                focusShow: true,
                maxShow: 100,
            });

              $('input[name=goodsSWPrice]').on("change keyup paste input", function() {
                  totalPrice('goodsSWPrice', 'totalGoodsSWPrice');
              });

              goodsHWCounter++;
          });

          {% if goodsSWs %}
              {% for goodsSW in goodsSWs %}
              console.log("{{ goodsSW.companyName }}");
                  c2.row.add([
                      '<div class="d-none" value="0" name="goodsSWTypeId" id="goodsSW0' + goodsSWCounter + '">{{ goodsSW.typeId }}</div>',
                      '<input class="magicsearch input-form" autocomplete="off" data-id="{{ goodsSW.companyName }}" type="text" style="width: 200px;" name="goodsSWCompany" ' +
                      'id="goodsSW1' + goodsSWCounter + '" onkeydown="magicsearchtab(goodsSW1' + goodsSWCounter + ')">',
                      '<input class="input-form" type="text" style="width: 350px;" value="{{ goodsSW.contents }}" name="goodsSWContents" id="goodsSW2' + goodsSWCounter + '">',
                      '<input class="money input-form"  name="goodsSWPrice" value="{{ goodsSW.price }}" style="width: 200px;" id="goodsSW3' + goodsSWCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  goodsSWCounter++;
              {% endfor %}
              c2.draw();
              console.log(goodsSWCounter);
              for (var c = 0; c < goodsSWCounter; c++) {
                  $('#goodsSW1' + c).magicsearch({
                      dataSource: companyList,
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=goodsSWPrice]').on("change keyup paste input", function() {
                  totalPrice('goodsSWPrice', 'totalGoodsSWPrice');
              });
          {% endif %}


           $('#goodsSW').on('click', 'i', function () {
              c2
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });
          // 3. 유지보수 HW
          var c3 = $('#maintenanceHW').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "0%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "50%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "26%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var maintenanceHWCounter = 0;

          $('#addMaintenanceHW').on('click', function () {
            c3.row.add([
                '<div class="d-none" value="0" name="maintenanceHWTypeId" id="maintenanceHW0' + maintenanceHWCounter + '">추가</div>',
                '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" name="maintenanceHWCompany" ' +
                'id="maintenanceHW1' + maintenanceHWCounter + '" onkeydown="magicsearchtab(maintenanceHW1' + maintenanceHWCounter + ')">',
                '<input class="input-form" type="text" style="width: 350px;" name="maintenanceHWContents" id="maintenanceHW2' + maintenanceHWCounter + '">',
                '<input class="money input-form"  name="maintenanceHWPrice" style="width: 200px;" id="maintenanceHW3' + maintenanceHWCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('#maintenanceHW1' + maintenanceHWCounter).magicsearch({
                dataSource: companyList,
                fields: 'value',
                id: 'id',
                format: '%value%',
                multiStyle: {space: 5, width: 80},
                noResult: '검색결과없음',
                focusShow: true,
                maxShow: 100,
            });

              $('input[name=maintenanceHWPrice]').on("change keyup paste input", function() {
                  totalPrice('maintenanceHWPrice', 'totalMaintenanceHWPrice');
              });

              maintenanceHWCounter++;
          });

          {% if maintenanceHWs %}
              {% for maintenanceHW in maintenanceHWs %}
              console.log("{{ maintenanceHW.companyName }}");
                  c3.row.add([
                      '<div class="d-none" value="0" name="maintenanceHWTypeId" id="maintenanceHW0' + maintenanceHWCounter + '">{{ maintenanceHW.typeId }}</div>',
                      '<input class="magicsearch input-form" autocomplete="off" data-id="{{ maintenanceHW.companyName }}" type="text" style="width: 200px;" name="maintenanceHWCompany" ' +
                      'id="maintenanceHW1' + maintenanceHWCounter + '" onkeydown="magicsearchtab(maintenanceHW1' + maintenanceHWCounter + ')">',
                      '<input class="input-form" type="text" style="width: 350px;" value="{{ maintenanceHW.contents }}" name="maintenanceHWContents" id="maintenanceHW2' + maintenanceHWCounter + '">',
                      '<input class="money input-form"  name="maintenanceHWPrice" value="{{ maintenanceHW.price }}" style="width: 200px;" id="maintenanceHW3' + maintenanceHWCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  maintenanceHWCounter++;
              {% endfor %}
              c3.draw();
              console.log(maintenanceHWCounter);
              for (var c = 0; c < maintenanceHWCounter; c++) {
                  $('#maintenanceHW1' + c).magicsearch({
                      dataSource: companyList,
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=maintenanceHWPrice]').on("change keyup paste input", function() {
                  totalPrice('maintenanceHWPrice', 'totalMaintenanceHWPrice');
              });
          {% endif %}

           $('#maintenanceHW').on('click', 'i', function () {
              c3
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 4. 유지보수 SW
          var c4 = $('#maintenanceSW').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "0%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "50%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "26%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var maintenanceSWCounter = 0;

          $('#addMaintenanceSW').on('click', function () {
            c4.row.add([
                '<div class="d-none" value="0" name="maintenanceSWTypeId" id="maintenanceSW0' + maintenanceSWCounter + '">추가</div>',
                '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" name="maintenanceSWCompany" ' +
                'id="maintenanceSW1' + maintenanceSWCounter + '" onkeydown="magicsearchtab(maintenanceSW1' + maintenanceSWCounter + ')">',
                '<input class="input-form" type="text" style="width: 350px;" name="maintenanceSWContents" id="maintenanceSW2' + maintenanceSWCounter + '">',
                '<input class="money input-form"  name="maintenanceSWPrice" style="width: 200px;" id="maintenanceSW3' + maintenanceSWCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('#maintenanceSW1' + maintenanceSWCounter).magicsearch({
                dataSource: companyList,
                fields: 'value',
                id: 'id',
                format: '%value%',
                multiStyle: {space: 5, width: 80},
                noResult: '검색결과없음',
                focusShow: true,
                maxShow: 100,
            });

              $('input[name=maintenanceSWPrice]').on("change keyup paste input", function() {
                  totalPrice('maintenanceSWPrice', 'totalMaintenanceSWPrice');
              });

              maintenanceSWCounter++;
          });

          {% if maintenanceSWs %}
              {% for maintenanceSW in maintenanceSWs %}
              console.log("{{ maintenanceSW.companyName }}");
                  c4.row.add([
                      '<div class="d-none" value="0" name="maintenanceSWTypeId" id="maintenanceSW0' + maintenanceSWCounter + '">{{ maintenanceSW.typeId }}</div>',
                      '<input class="magicsearch input-form" autocomplete="off" data-id="{{ maintenanceSW.companyName }}" type="text" style="width: 200px;" name="maintenanceSWCompany" ' +
                      'id="maintenanceSW1' + maintenanceHWCounter + '" onkeydown="magicsearchtab(maintenanceSW1' + maintenanceSWCounter + ')">',
                      '<input class="input-form" type="text" style="width: 350px;" value="{{ maintenanceSW.contents }}" name="maintenanceSWContents" id="maintenanceSW2' + maintenanceSWCounter + '">',
                      '<input class="money input-form"  name="maintenanceSWPrice" value="{{ maintenanceSW.price }}" style="width: 200px;" id="maintenanceSW3' + maintenanceSWCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  maintenanceSWCounter++;
              {% endfor %}
              c4.draw();
              console.log(maintenanceSWCounter);
              for (var c = 0; c < maintenanceSWCounter; c++) {
                  $('#maintenanceSW1' + c).magicsearch({
                      dataSource: companyList,
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=maintenanceSWPrice]').on("change keyup paste input", function() {
                  totalPrice('maintenanceSWPrice', 'totalMaintenanceSWPrice');
              });
          {% endif %}

           $('#maintenanceSW').on('click', 'i', function () {
              c4
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });


           // 5. 인력지원 자사
          var c5 = $('#supportInternal').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "15%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "15%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "20%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "26%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var supportInternalCounter = 0;

          $('#addSupportInternal').on('click', function () {
            c5.row.add([
                '<div class="d-none" value="0" name="supportInternalTypeId" id="supportInternal0' + supportInternalCounter + '">추가</div>',
                '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" name="supportInternalType" ' +
                'id="supportInternal1' + supportInternalCounter + '" onkeydown="magicsearchtab(supportInternal1' + supportInternalCounter + ')">',
                '<input class="input-form" type="digit" style="width: 50px;" name="supportInternalTimes" id="supportInternal2' + supportInternalCounter + '">',
                '<input class="input-form" type="digit" style="width: 50px;" name="supportInternalSites" id="supportInternal3' + supportInternalCounter + '">',
                '<input class="input-form" type="digit" style="width: 200px;" name="supportInternalUnits" id="supportInternal4' + supportInternalCounter + '">',
                '<input class="money input-form"  name="supportInternalPrice" style="width: 200px;" id="supportInternal5' + supportInternalCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('#supportInternal1' + supportInternalCounter).magicsearch({
                dataSource: {{ classificationB | safe }},
                fields: 'value',
                id: 'id',
                format: '%value%',
                multiStyle: {space: 5, width: 80},
                noResult: '검색결과없음',
                focusShow: true,
                maxShow: 100,
            });
            $('input[name=supportInternalPrice]').on("change keyup paste input", function() {
                totalPrice('supportInternalPrice', 'totalSupportInternalPrice');
            });
              supportInternalCounter++;
          });

          {% if supportInternals %}
              {% for supportInternal in supportInternals %}
              console.log("{{ supportInternal.classification }}");
                  c5.row.add([
                      '<div class="d-none" value="0" name="supportInternalTypeId" id="supportInternal0' + supportInternalCounter + '">{{ supportInternal.typeId }}</div>',
                      '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" data-id="{{ supportInternal.classification }}" name="supportInternalType" ' +
                      'id="supportInternal1' + supportInternalCounter + '" onkeydown="magicsearchtab(supportInternal1' + supportInternalCounter + ')">',
                      '<input class="input-form" type="digit" style="width: 50px;" value="{{ supportInternal.times }}" name="supportInternalTimes" id="supportInternal2' + supportInternalCounter + '">',
                      '<input class="input-form" type="digit" style="width: 50px;" value="{{ supportInternal.sites }}" name="supportInternalSites" id="supportInternal3' + supportInternalCounter + '">',
                      '<input class="input-form" type="digit" style="width: 200px;" value="{{ supportInternal.units }}" name="supportInternalUnits" id="supportInternal4' + supportInternalCounter + '">',
                      '<input class="money input-form"  value="{{ supportInternal.price }}" name="supportInternalPrice" style="width: 200px;" id="supportInternal5' + supportInternalCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  supportInternalCounter++;
              {% endfor %}
              c5.draw();
              console.log(supportInternalCounter);
              for (var c = 0; c < supportInternalCounter; c++) {
                  $('#supportInternal1' + c).magicsearch({
                      dataSource: {{ classificationB | safe }},
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=supportInternalPrice]').on("change keyup paste input", function() {
                  totalPrice('supportInternalPrice', 'totalSupportInternalPrice');
              });
          {% endif %}

           $('#supportInternal').on('click', 'i', function () {
              c5
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 6. 인력지원 타사
          var c6 = $('#supportExternal').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "0%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "50%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "26%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var supportExternalCounter = 0;

          $('#addSupportExternal').on('click', function () {
            c6.row.add([
                '<div class="d-none" value="0" name="supportExternalTypeId" id="supportExternal0' + supportExternalCounter + '">추가</div>',
                '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" name="supportExternalType" ' +
                'id="supportExternal1' + supportExternalCounter + '" onkeydown="magicsearchtab(supportExternal1' + supportExternalCounter + ')">',
                '<input class="input-form" type="text" style="width: 350px;" name="supportExternalContents" id="supportExternal2' + supportExternalCounter + '">',
                '<input class="money input-form"  name="supportExternalPrice" style="width: 200px;" id="supportExternal3' + supportExternalCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('#supportExternal1' + supportExternalCounter).magicsearch({
                dataSource: {{ classificationC | safe }},
                fields: 'value',
                id: 'id',
                format: '%value%',
                multiStyle: {space: 5, width: 80},
                noResult: '검색결과없음',
                focusShow: true,
                maxShow: 100,
            });
            $('input[name=supportExternalPrice]').on("change keyup paste input", function() {
                totalPrice('supportExternalPrice', 'totalSupportExternalPrice');
            });

              supportExternalCounter++;
          });

          {% if supportExternals %}
              {% for supportExternal in supportExternals %}
              console.log("{{ supportExternal.classification }}");
                  c6.row.add([
                      '<div class="d-none" value="0" name="supportExternalTypeId" id="supportExternal0' + supportExternalCounter + '">{{ supportExternal.typeId }}</div>',
                      '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" data-id="{{ supportExternal.classification }}" name="supportExternalType" ' +
                      'id="supportExternal1' + supportExternalCounter + '" onkeydown="magicsearchtab(supportExternal1' + supportExternalCounter + ')">',
                      '<input class="input-form" type="text" style="width: 350px;" value="{{ supportExternal.contents }}" name="supportExternalContents" id="supportExternal2' + supportExternalCounter + '">',
                      '<input class="money input-form" value="{{ supportExternal.price }}" name="supportExternalPrice" style="width: 200px;" id="supportExternal3' + supportExternalCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  supportExternalCounter++;
              {% endfor %}
              c6.draw();
              console.log(supportExternalCounter);
              for (var c = 0; c < supportExternalCounter; c++) {
                  $('#supportExternal1' + c).magicsearch({
                      dataSource: {{ classificationC | safe }},
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=supportExternalPrice]').on("change keyup paste input", function() {
                  totalPrice('supportExternalPrice', 'totalSupportExternalPrice');
              });
          {% endif %}

           $('#supportExternal').on('click', 'i', function () {
              c6
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

           // 7. DB COSTS
          var c7 = $('#dbCosts').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "0%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "30%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "30%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "20%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var dbCostsCounter = 0;

          $('#addDbCosts').on('click', function () {
            c7.row.add([
                '<div class="d-none" value="0" name="dbCostsTypeId" id="dbCosts0' + dbCostsCounter + '">추가</div>',
                '<input class="input-form" type="text" style="width: 130px;" name="dbCostsNumber" id="dbCosts1' + dbCostsCounter + '">',
                '<input class="input-form" type="date" style="width: 200px;" name="dbCostsStart" id="dbCosts2' + dbCostsCounter + '">',
                '<input class="input-form" type="date" style="width: 200px;" name="dbCostsEnd" id="dbCosts3' + dbCostsCounter + '">',
                '<input class="money input-form"  name="dbCostsPrice" style="width: 200px;" id="dbCosts4' + dbCostsCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('input[name=dbCostsPrice]').on("change keyup paste input", function() {
                totalPrice('dbCostsPrice', 'totalDbCostsPrice');
            });
              dbCostsCounter++;
          });

          {% if dbCosts %}
              {% for dbCost in dbCosts %}
              console.log("{{ dbCosts.classification }}");
                  c7.row.add([
                      '<div class="d-none" value="0" name="dbCostsTypeId" id="dbCosts0' + dbCostsCounter + '">{{ dbCost.typeId }}</div>',
                      '<input class="input-form" type="text" style="width: 130px;" value="{{ dbCost.contractNo }}" name="dbCostsNumber" id="dbCosts1' + dbCostsCounter + '">',
                      '<input class="input-form" type="date" style="width: 200px;" value="{{ dbCost.contractStartDate }}" name="dbCostsStart" id="dbCosts2' + dbCostsCounter + '">',
                      '<input class="input-form" type="date" style="width: 200px;" value="{{ dbCost.contractEndDate }}" name="dbCostsEnd" id="dbCosts3' + dbCostsCounter + '">',
                      '<input class="money input-form" value="{{ dbCost.price }}" name="dbCostsPrice" style="width: 200px;" id="dbCosts4' + dbCostsCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  dbCostsCounter++;
              {% endfor %}
              c7.draw();
              $('.money').simpleMoneyFormat();
              $('input[name=dbCostsPrice]').on("change keyup paste input", function() {
                  totalPrice('dbCostsPrice', 'totalDbCostsPrice');
              });
          {% endif %}

           $('#dbCosts').on('click', 'i', function () {
              c7
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

          // 8. 기타
          var c8 = $('#others').DataTable({
              "autoWidth": true,
              "searching": false,
              "paging": false,
              "info": false,
              "scrollY": "60vh",
              "scrollX": true,
              "scrollCollapse": true,
              'fnCreatedRow': function (nRow, aData, iDataIndex) {
                  $(nRow).attr('id', 'row' + iDataIndex);
              },
              "ordering": false,
              "columnDefs": [
                  {targets: 0, width: "0%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap d-none"},
                  {targets: 1, width: "20%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "50%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "26%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "4%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
              ],
          });

          var othersCounter = 0;

          $('#addOthers').on('click', function () {
            c8.row.add([
                '<div class="d-none" value="0" name="othersTypeId" id="others0' + othersCounter + '">추가</div>',
                '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" name="othersType" ' +
                'id="others1' + othersCounter + '" onkeydown="magicsearchtab(others1' + othersCounter + ')">',
                '<input class="input-form" type="text" style="width: 350px;" name="othersContents" id="others2' + othersCounter + '">',
                '<input class="money input-form"  name="othersPrice" style="width: 200px;" id="others3' + othersCounter + '">',
                '<i class="fas fa-times-circle" name="remove">'
            ]).draw(false);
            $('.money').simpleMoneyFormat();
            $('#others1' + othersCounter).magicsearch({
                dataSource: {{ classificationC | safe }},
                fields: 'value',
                id: 'id',
                format: '%value%',
                multiStyle: {space: 5, width: 80},
                noResult: '검색결과없음',
                focusShow: true,
                maxShow: 100,
            });
            $('input[name=othersPrice]').on("change keyup paste input", function() {
                totalPrice('othersPrice', 'totalOthersPrice');
            });

              othersCounter++;
          });

          {% if others %}
              {% for other in others %}
              console.log("{{ other.classification }}");
                  c8.row.add([
                      '<div class="d-none" value="0" name="othersTypeId" id="others0' + othersCounter + '">{{ other.typeId }}</div>',
                      '<input class="magicsearch input-form" autocomplete="off" type="text" style="width: 200px;" data-id="{{ other.classification }}" name="othersType" ' +
                      'id="others1' + othersCounter + '" onkeydown="magicsearchtab(others1' + othersCounter + ')">',
                      '<input class="input-form" type="text" style="width: 350px;" value="{{ other.contents }}" name="othersContents" id="others2' + othersCounter + '">',
                      '<input class="money input-form" value="{{ other.price }}" name="othersPrice" style="width: 200px;" id="others3' + othersCounter + '">',
                      '<i class="fas fa-times-circle" name="remove">'
                  ]);
                  othersCounter++;
              {% endfor %}
              c8.draw();
              console.log(othersCounter);
              for (var c = 0; c < othersCounter; c++) {
                  $('#others1' + c).magicsearch({
                      dataSource: {{ classificationC | safe }},
                      fields: 'value',
                      id: 'id',
                      format: '%value%',
                      multiStyle: {space: 5, width: 80},
                      noResult: '검색결과없음',
                      focusShow: true,
                      maxShow: 100,
                  });
              }
              $('.money').simpleMoneyFormat();

              $('input[name=othersPrice]').on("change keyup paste input", function() {
                  totalPrice('othersPrice', 'totalOthersPrice');
              });
          {% endif %}

           $('#supportExternal').on('click', 'i', function () {
              c6
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });

           $('#others').on('click', 'i', function () {
              c8
                  .row($(this).parents('tr'))
                  .remove()
                  .draw();
          });


          // 단계에 따른 표기 방법
          changeStep(t2, t3, t4, c1, c2, c3, c4, c5, c6, c7, c8);

          // 합계 수동으로 구해서 넣어주는 것
          totalPrice('itemPrice', 'totalItemPrice');
          totalPrice('revenuePrice', 'totalRevenuePrice');
          totalPrice('revenueProfitPrice', 'totalRevenueProfitPrice');
          totalPrice('purchasePrice', 'totalPurchasePrice');
          totalPrice('costPrice', 'totalCostPrice');

          totalPrice('goodsHWPrice', 'totalGoodsHWPrice');
          totalPrice('dbCostsPrice', 'totalDbCostsPrice');
          totalPrice('goodsSWPrice', 'totalGoodsSWPrice');
          totalPrice('maintenanceHWPrice', 'totalMaintenanceHWPrice');
          totalPrice('maintenanceSWPrice', 'totalMaintenanceSWPrice');
          totalPrice('supportInternalPrice', 'totalSupportInternalPrice');
          totalPrice('supportExternalPrice', 'totalSupportExternalPrice');
          totalPrice('othersPrice', 'totalOthersPrice');
      })
  </script>

{% endblock %}