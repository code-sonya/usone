{% extends "dashboard/layout.html" %}


{% block title %}
  영업관리
{% endblock %}


{% block css %}
  <style>
    .file-table {
      color: #333333;
      width: 100%;
      margin-bottom: 2rem;
    }

    .file-table td, .file-table th {
      padding: .75rem;
      vertical-align: middle;
      border-bottom: 1px solid #e3e6f0;
      font-size: 14px;
      text-align: center;
      white-space: nowrap;
    }
  </style>
{% endblock %}


{% block content %}
  <div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
      <h6 class="m-0 h3 text-gray-800">
        [{{ purchaseOrder.contractId.contractName }}]
        {{ purchaseOrder.purchaseCompany.companyNameKo }}
        매입발주서
      </h6>
      <div class="dropdown no-arrow">
        <a class="dropdown-toggle" href="#" role="button" id="emailLink" data-toggle="modal" data-target="#emailModal">
          <i class="fas fa-at fa-fw text-info"></i>
        </a>
      </div>
    </div>

    <div class="card-body">
      <label class="font-weight-bold text-primary">제목</label>
      <div class="mb-3 ml-2">
        <h5 class="h5 text-gray-900">{{ purchaseOrder.title }}</h5>
      </div>

      <label for="contentHtml" class="font-weight-bold text-primary">본문</label>
      <div class="mb-3 ml-2 text-gray-900">
        {{ purchaseOrder.contentHtml | safe }}
      </div>

      <div class="row">
        <div class="col-6">
          <label class="font-weight-bold text-primary mt-3">첨부파일</label>
          <form id="filesForm" method="POST" enctype="multipart/form-data" class="d-none">{% csrf_token %}</form>
          <table class="file-table">
            <thead>
            <tr>
              <td width="65%"><b>파일명</b></td>
              <td width="20%"><b>파일크기</b></td>
              <td width="15%">
                <label class="m-0 btn btn-info btn-icon-split">
                  <span class="icon text-white-100"><i class="fas fa-file-upload"></i></span>
                  <input id="files" name="files" type="file" multiple="multiple" class="d-none" onchange=file_upload()>
                </label>
              </td>
            </tr>
            </thead>
            <tbody>
            {% for file in purchaseOrderFiles %}
              <tr>
                <td class="text-left">{{ file.fileName }}</td>
                <td class="text-right">{{ file.fileSize }} MB</td>
                <td><i class="fas fa-times-circle" onclick="file_delete({{ file.fileId }})"></i></td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>


    {% if purchaseOrder.writeEmp == request.user.employee and purchaseOrder.sendDatetime is None %}
    <div class="text-center mb-3">
      <a href="/sales/deletepurchaseorder/{{ purchaseOrder.orderId }}" class="btn btn-danger btn-icon-split" onclick="btn_delete()">
        <span class="icon text-white-50"> <i class="fas fa-times"> </i> </span>
        <span class="text">삭제</span>
      </a>
      <a href="/sales/modifypurchaseorder/{{ purchaseOrder.orderId }}/" class="btn btn-success btn-icon-split">
        <span class="icon text-white-50"> <i class="fas fa-check"> </i> </span>
        <span class="text">수정</span>
      </a>
    </div>
  {% endif %}
  </div>

{% endblock %}


{% block script %}
  <script type="text/javascript">

      function file_upload() {
          let form = $('#filesForm');
          form.attr("action", "/sales/uploadpurchaseorderfiles/{{ purchaseOrder.orderId }}/");
          form.append($("#files"));
          form.submit();
      }

      function file_delete(fileId) {
          console.log(fileId);
          location.href = '/sales/deletepurchaseorderfile/' + fileId + '/';
      }

      $(document).ready(function () {

      })

  </script>
{% endblock %}
