{% extends "dashboard/layout.html" %}

{% block title %}
  월별손익계산서
{% endblock %}
{% load humanize %}
{% block css %}
  <style type="text/css">
    .pc-table {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .pc-table td, .pc-table th {
      padding: 5px 10px;
      vertical-align: middle;
      font-size: 13px;
      text-align: center;
      border: 1px solid lightgray;
      border-collapse: collapse;
    }

    .mobile-table {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .mobile-table td, .mobile-table th {
      padding: 5px 10px;
      vertical-align: middle;
      font-size: 14px;
      text-align: center;
      border: 1px solid lightgray;
      border-collapse: collapse;
    }

    .thtd {
      text-align: center;
      border: 1px solid lightgray;
      border-collapse: collapse;
    }
  </style>
{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-xl-12">

      <div class="card shadow mb-4">

        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 h3 text-gray-800">손익계산서</h6>
          <span class="text-right">[부가세 별도]</span>
        </div>

        <div class="card-body">
          <div class="row ml-1 mr-1 mb-2 justify-content-between">
            <span class="font-weight-bold text-dark h5">1. {{ todayYear }}년 손익 현황</span>
            <span>[단위 : 백만원]</span>
          </div>
          {% if user.employee.empDeptName == '경영지원본부' %}
            <div class="float-right">
              <i class="fas fa-upload"><a href="/sales/uploadprofitloss/"> 손익/원가데이터업로드</a></i>
            </div>
            <br>
          {% endif %}
          <div class="row">
            <div class="col-sm-12 col-xl-6">
              <span>① <span class="text-warning font-weight-bold">{{ todayMonth }}월</span> 손익계산서</span>
              <table class="pc-table">
                <thead>
                <tr class="bg-light">
                  <td>계정과목</td>
                  <td>금액</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td>매출</td>
                  <td class="text-right">{{ todayMonth_table.revenuePrice |slugify|slice:"0:-6"|intcomma }}</td>
                </tr>
                <tr>
                  <td>매출원가</td>
                  <td class="text-right">{{ todayMonth_table.cogs |slugify|slice:"0:-6"|intcomma }}</td>
                </tr>
                <tr>
                  <td>GP</td>
                  <td class="text-right">{{ todayMonth_table.revenueProfitPrice |slugify|slice:"0:-6"|intcomma }}</td>
                </tr>
                <tr>
                  <td>판관비</td>
                  <td class="text-right">{{ todayMonth_table.expenses |slugify|slice:"0:-6"|intcomma }}</td>
                </tr>
                <tr class="bg-light">
                  <td>영업이익</td>
                  <td class="text-right">{{ todayMonth_table.profit |slugify|slice:"0:-6"|intcomma }}</td>
                </tr>
                </tbody>
              </table>
            </div>
            <div class="col-sm-12 col-xl-6">
              <span>② <span class="text-primary">판관비</span> 상세 내역 [업로드일자:{{ expenseDate }}]</span>
              <table class="pc-table">
                <thead>
                <tr class="bg-light">
                  <td>계정과목</td>
                  <td>금액</td>
                </tr>
                </thead>
                <tbody>
                {% for expense in expenseDetail %}
                  <tr class="expense">
                    <td>{{ expense.expenseGroup }}</td>
                    <td class="text-right">{{ expense.expenseMoney__sum |slugify|slice:"0:-6"|intcomma }} ({{ expense.expensePercent |floatformat:0 }}%)</td>
                  </tr>
                {% endfor %}
                <tr class="sum_expense bg-light">
                  <td>합계</td>
                  <td class="text-right">{{ sum_expenseDetail.sum_expenseDetail |slugify|slice:"0:-6"|intcomma }} ({{ sum_expenseDetail.sum_expensePercent |floatformat:0 }}%)</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        <br>
        <div class="d-none d-xl-block">
          <div class="row ml-1 mr-1 mb-2 justify-content-between">
            <span class="font-weight-bold text-dark h5">2. {{ todayYear }}년 월별 손익 계산서 현황</span>
            <span>[단위 : 원]</span>
          </div>
          <div class="row">
            <table class="pc-table ml-3 mr-3">
              <thead>
              <tr class="bg-light">
                <td>계정과목</td>
                <td>1월</td>
                <td>2월</td>
                <td>3월</td>
                <td>4월</td>
                <td>5월</td>
                <td>6월</td>
                <td>7월</td>
                <td>8월</td>
                <td>9월</td>
                <td>10월</td>
                <td>11월</td>
                <td>12월</td>
                <td>합계</td>
              </tr>
              </thead>
              <tbody>
              {% for row in month_table %}
                {% if row.name == '영업이익' %}
                  <tr class="bg-light">
                    <td class="bg-light">{{ row.name }}</td>
                    {% if row.month1 > 0 %}
                      <td class="text-danger">{{ row.month1 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month1 | intcomma }}</td>
                    {% endif %}
                    {% if row.month2 > 0 %}
                      <td class="text-danger">{{ row.month2 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month2 | intcomma }}</td>
                    {% endif %}
                    {% if row.month3 > 0 %}
                      <td class="text-danger">{{ row.month3 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month3 | intcomma }}</td>
                    {% endif %}
                    {% if row.month4 > 0 %}
                      <td class="text-danger">{{ row.month4 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month4 | intcomma }}</td>
                    {% endif %}
                    {% if row.month5 > 0 %}
                      <td class="text-danger">{{ row.month5 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month5 | intcomma }}</td>
                    {% endif %}
                    {% if row.month6 > 0 %}
                      <td class="text-danger">{{ row.month6 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month6 | intcomma }}</td>
                    {% endif %}
                    {% if row.month7 > 0 %}
                      <td class="text-danger">{{ row.month7 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month7 | intcomma }}</td>
                    {% endif %}
                    {% if row.month8 > 0 %}
                      <td class="text-danger">{{ row.month8 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month8 | intcomma }}</td>
                    {% endif %}
                    {% if row.month9 > 0 %}
                      <td class="text-danger">{{ row.month9 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month9 | intcomma }}</td>
                    {% endif %}
                    {% if row.month10 > 0 %}
                      <td class="text-danger">{{ row.month10 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month10 | intcomma }}</td>
                    {% endif %}
                    {% if row.month11 > 0 %}
                      <td class="text-danger">{{ row.month11 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month11 | intcomma }}</td>
                    {% endif %}
                    {% if row.month12 > 0 %}
                      <td class="text-danger">{{ row.month12 | intcomma }}</td>
                    {% else %}
                      <td class="text-primary">{{ row.month12 | intcomma }}</td>
                    {% endif %}
                    {% if row.sum > 0 %}
                      <td class="text-danger font-weight-bold">{{ row.sum | intcomma }}</td>
                    {% else %}
                      <td class="text-primary font-weight-bold">{{ row.sum | intcomma }}</td>
                    {% endif %}
                   </tr>
                  {% else %}
                  <tr>
                    <td class="bg-light">{{ row.name }}</td>
                    <td>{{ row.month1 | intcomma }}</td>
                    <td>{{ row.month2 | intcomma }}</td>
                    <td>{{ row.month3 | intcomma }}</td>
                    <td>{{ row.month4 | intcomma }}</td>
                    <td>{{ row.month5 | intcomma }}</td>
                    <td>{{ row.month6 | intcomma }}</td>
                    <td>{{ row.month7 | intcomma }}</td>
                    <td>{{ row.month8 | intcomma }}</td>
                    <td>{{ row.month9 | intcomma }}</td>
                    <td>{{ row.month10 | intcomma }}</td>
                    <td>{{ row.month11 | intcomma }}</td>
                    <td>{{ row.month12 | intcomma }}</td>
                    <td>{{ row.sum | intcomma }}</td>
                  </tr>
                {% endif %}
              {% endfor %}
              </tbody>
            </table>
          </div>
          <br>
          <div class="row ml-1 mr-1 mb-2 justify-content-between">
            <span class="font-weight-bold text-dark h5">3. 판관비 세부내역</span>
            <span>[단위 : 원]</span>
          </div>
        {% for lst in business %}
          <div class="row">
            <span class="ml-3"> {{ lst.name }}</span>
            <br>
            <table class="pc-table ml-3 mr-3">
              <thead>
              <tr class="bg-light">
                <td>계정과목</td>
                <td>1월</td>
                <td>2월</td>
                <td>3월</td>
                <td>4월</td>
                <td>5월</td>
                <td>6월</td>
                <td>7월</td>
                <td>8월</td>
                <td>9월</td>
                <td>10월</td>
                <td>11월</td>
                <td>12월</td>
                <td>합계</td>
              </tr>
              </thead>
              <tbody>
              {% for row in lst.expense %}
              <tr class="{{ lst.class }}">
                <td class="bg-light">{{ row.expenseSub }}</td>
                <td>{% if row.month1_expense != None %}{{ row.month1_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month2_expense != None %}{{ row.month2_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month3_expense != None %}{{ row.month3_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month4_expense != None %}{{ row.month4_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month5_expense != None %}{{ row.month5_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month6_expense != None %}{{ row.month6_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month7_expense != None %}{{ row.month7_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month8_expense != None %}{{ row.month8_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month9_expense != None %}{{ row.month9_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month10_expense != None %}{{ row.month10_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month11_expense != None %}{{ row.month11_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month12_expense != None %}{{ row.month12_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month_expense != None %}{{ row.month_expense |intcomma }}{% else %}-{% endif %}</td>
              </tr>
              {% endfor %}
              {% for row in lst.sum %}
              <tr class="bg-light">
                <td>합계</td>
                <td>{% if row.month1_expense != None %}{{ row.month1_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month2_expense != None %}{{ row.month2_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month3_expense != None %}{{ row.month3_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month4_expense != None %}{{ row.month4_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month5_expense != None %}{{ row.month5_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month6_expense != None %}{{ row.month6_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month7_expense != None %}{{ row.month7_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month8_expense != None %}{{ row.month8_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month9_expense != None %}{{ row.month9_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month10_expense != None %}{{ row.month10_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month11_expense != None %}{{ row.month11_expense |intcomma }}{% else %}-{% endif %}</td>
                <td>{% if row.month12_expense != None %}{{ row.month12_expense |intcomma }}{% else %}-{% endif %}</td>
                <td class="font-weight-bold">{% if row.month_expense != None %}{{ row.month_expense |intcomma }}{% else %}-{% endif %}</td>
              </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% endfor %}
          </div>
          <div class="d-xl-none text-center">※ 상세 내역은 <span class="text-primary">PC화면</span>에서 확인 가능합니다.</div>
        </div>
      </div>
    </div>
  </div>

{% endblock %}


|intcomma {% block script %}

  <script>
      const etc ='<tr><td>기타</td><td style="text-align:right" class="text-primary"><i class="fas fa-plus-circle" id="btn"> 더보기</td></tr>';
      const etc_businessAll ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_businessAll"> 더보기</td><td colspan=13></td></tr>';
      const etc_businessExecutives ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_businessExecutives"> 더보기</td><td colspan=13></td></tr>';
      const etc_businessSales1 ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_businessSales1"> 더보기</td><td colspan=13></td></tr>';
      const etc_businessSales2 ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_businessSales2"> 더보기</td><td colspan=13></td></tr>';
      const etc_businessInfra ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_businessInfra"> 더보기</td><td colspan=13></td></tr>';
      const etc_serviceAll ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_serviceAll"> 더보기</td><td colspan=13></td></tr>';
      const etc_serviceExecutives ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_serviceExecutives"> 더보기</td><td colspan=13></td></tr>';
      const etc_serviceSolution ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_serviceSolution"> 더보기</td><td colspan=13></td></tr>';
      const etc_serviceDB ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_serviceDB"> 더보기</td><td colspan=13></td></tr>';
      const etc_supportAll ='<tr><td class="text-primary"><i class="fas fa-plus-circle" id="btn_supportAll"> 더보기</td><td colspan=13></td></tr>';
      $('.expense:gt(2)').hide().last().after(etc);
      $('.businessAll').hide().last().after(etc_businessAll);
      $('.businessExecutives').hide().last().after(etc_businessExecutives);
      $('.businessSales1').hide().last().after(etc_businessSales1);
      $('.businessSales2').hide().last().after(etc_businessSales2);
      $('.businessInfra').hide().last().after(etc_businessInfra);
      $('.serviceAll').hide().last().after(etc_serviceAll);
      $('.serviceExecutives').hide().last().after(etc_serviceExecutives);
      $('.serviceSolution').hide().last().after(etc_serviceSolution);
      $('.serviceDB').hide().last().after(etc_serviceDB);
      $('.supportAll').hide().last().after(etc_supportAll);


      $('#btn').click(function(){
          let a = this;
          if($('#btn').attr('class')=='fas fa-plus-circle'){
              $('.expense:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.expense:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.expense:gt(2)').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_businessAll').click(function(){
          let a = this;
          if($('#btn_businessAll').attr('class')=='fas fa-plus-circle'){
              $('.businessAll:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.businessAll:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.businessAll').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_businessExecutives').click(function(){
          let a = this;
          if($('#btn_businessExecutives').attr('class')=='fas fa-plus-circle'){
              $('.businessExecutives:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.businessExecutives:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.businessExecutives').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_businessSales1').click(function(){
          let a = this;
          if($('#btn_businessSales1').attr('class')=='fas fa-plus-circle'){
              $('.businessSales1:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.businessSales1:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.businessSales1').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_businessSales2').click(function(){
          let a = this;
          if($('#btn_businessSales2').attr('class')=='fas fa-plus-circle'){
              $('.businessSales2:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.businessSales2:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.businessSales2').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_businessInfra').click(function(){
          let a = this;
          if($('#btn_businessInfra').attr('class')=='fas fa-plus-circle'){
              $('.businessInfra:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.businessInfra:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.businessInfra').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_serviceAll').click(function(){
          let a = this;
          if($('#btn_serviceAll').attr('class')=='fas fa-plus-circle'){
              $('.serviceAll:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.serviceAll:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.serviceAll').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_serviceExecutives').click(function(){
          let a = this;
          if($('#btn_serviceExecutives').attr('class')=='fas fa-plus-circle'){
              $('.serviceExecutives:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.serviceExecutives:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.serviceExecutives').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_serviceSolution').click(function(){
          let a = this;
          if($('#btn_serviceSolution').attr('class')=='fas fa-plus-circle'){
              $('.serviceSolution:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.serviceSolution:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.serviceSolution').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_serviceDB').click(function(){
          let a = this;
          if($('#btn_serviceDB').attr('class')=='fas fa-plus-circle'){
              $('.serviceDB:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.serviceDB:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.serviceDB').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

      $('#btn_supportAll').click(function(){
          let a = this;
          if($('#btn_supportAll').attr('class')=='fas fa-plus-circle'){
              $('.supportAll:not(:visible):lt(50)').fadeIn(function () {
                  if ($('.supportAll:not(:visible)').length == 0) $(a).attr('class', 'fas fa-minus-circle').text(' 접기');
          });return false;
          }else{
              $('.supportAll').hide();
              $(a).attr('class', 'fas fa-plus-circle').text(' 더보기')
          }
      });

  </script>


{% endblock %}