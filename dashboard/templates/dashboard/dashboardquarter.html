{% extends "dashboard/layout.html" %}
{% block title %}
  연간 영업 실적
{% endblock %}
{% load humanize %}

{% block css %}

  <style type="text/css">
    .buttons-copy {
      background-color: #4e73df;
      color: white;
      margin-bottom: 1rem;
    }

    .buttons-excel {
      background-color: #36b9cc;
      color: white;
      margin-bottom: 1rem;
    }

    .buttons-print {
      background-color: #f6c23e;
      color: white;
      margin-bottom: 1rem;
    }
  </style>

{% endblock %}
{% block content %}
  <div class="py-3 d-flex flex-row align-items-center justify-content-between p-0">
    <h3 class="mb-2 text-gray-800 ml-0">{{ todayYear }}년 영업 실적</h3>
    <div class="dropdown">
      <a class="btn btn-success" href="#" role="button" id="filterLink" data-toggle="modal" data-target="#filterModal">
        <i class="fas fa-filter d-xl-none"></i><span class="d-none d-xl-block"><i class="fas fa-filter"></i> 조회</span>
      </a>
    </div>
  </div>
  <h6 class="mb-3 text-gray-800">[단위 : 백만원]</h6>
  <div class="row"><p class="text-secondary col-xl-12">▶ Firm</p></div>

  <div class="row">
    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem; padding-bottom: 0.6rem">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-primary text-uppercase mb-1">[{{ todayYear }}년]<br>목표매출 / 누적매출 / 달성률</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {% if salesTarget %}{{ salesTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if cumulative_sales_amount %}{{ cumulative_sales_amount|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if Sales_rate %}{{ Sales_rate }}{% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto"><i class="fas fa-won-sign fa-2x text-gray-300"></i></div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem; padding-bottom: 0.6rem">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-primary text-uppercase mb-1">[{{ todayYear }}년]<br>목표이익 / 누적이익 / 달성률</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {% if profitTarget %}{{ profitTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if cumulative_profit_amount %}{{ cumulative_profit_amount|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if Profit_rate %}{{ Profit_rate }}{% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-won-sign fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem; padding-bottom: 0.6rem">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-success text-uppercase mb-1">[{{ todayQuarter }}분기]<br>목표매출 / 누적매출 / 달성률</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {% if salesQuarterTarget %}{{ salesQuarterTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if quarterly_cumulative_sales %}{{ quarterly_cumulative_sales|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if Salesquater_rate %}{{ Salesquater_rate }}{% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-money-bill-alt fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem;padding-bottom: 0.6rem">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-success text-uppercase mb-1">[{{ todayQuarter }}분기]<br>목표이익 / 누적이익 / 달성률</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {% if profitQuarterTarget %}{{ profitQuarterTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if quarterly_cumulative_profit %}{{ quarterly_cumulative_profit|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if Profitquater_rate %}{{ Profitquater_rate }}{% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-money-bill-alt fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <br>

  <div class="row"><p class="text-secondary col-xl-12">▶ Firm, Opportunity</p></div>

  <div class="row">
    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem; padding-bottom: 0.6rem;">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-info text-uppercase mb-1">[{{ todayYear }}년]<br>목표매출 / 예상매출 / 달성률</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {% if salesTarget %}{{ salesTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if opp_firm_sales %}{{ opp_firm_sales|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if opp_firm_sales_rate %}{{ opp_firm_sales_rate }}{% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-search-dollar fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem; padding-bottom: 0.6rem;">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-info text-uppercase mb-1">[{{ todayYear }}년]<br>목표이익 / 예상이익 / 달성률</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {% if profitTarget %}{{ profitTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if opp_firm_profits %}{{ opp_firm_profits|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if opp_firm_profits_rate %}{{ opp_firm_profits_rate }}{% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-search-dollar fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-warning shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem; padding-bottom: 0.6rem;">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-warning text-uppercase mb-1">[{{ todayQuarter }}분기]<br>목표매출 / 예상매출 / 달성률</div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {% if salesQuarterTarget %}{{ salesQuarterTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if quarter_opp_firm_sales %}{{ quarter_opp_firm_sales|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if quarter_opp_firm_sales_rate %}{{ quarter_opp_firm_sales_rate }}{% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-coins fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-0">
      <div class="card border-left-warning shadow h-100 py-2">
        <div class="card-body" style="padding-top: 0.6rem; padding-bottom: 0.6rem;">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-sm font-weight-bold text-warning text-uppercase mb-1">[{{ todayQuarter }}분기]<br>목표이익 / 예상이익 / 달성률</div>
              <div class="h5 b-0 font-weight-bold text-gray-800">
                {% if profitQuarterTarget %}{{ profitQuarterTarget|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if quarter_opp_firm_profits %}{{ quarter_opp_firm_profits|slugify|slice:"0:-6"|intcomma }}{% else %}0{% endif %} /
                {% if quarter_opp_firm_profits_rate %}
                  {{ quarter_opp_firm_profits_rate }}
                {% else %}-{% endif %}%
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-coins fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <br>
  <!-- Content Row -->
  <div class="row">
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">{{ todayQuarter }}분기 누적 매출</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Oppt'y & Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="todayquarterPiechart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">{{ todayQuarter }}분기 누적 매출&이익</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="todayquarterCumulativechart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row d-none" id="firm1">
    <div class="col-xl-12 col-lg-12">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">매출 상세 내용</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="table-responsive">
            <table id="showFirms1" class="hover row-border" width="100%" style="width: 100%;">
              <thead>
              <tr>
                <th>관리번호</th>
                <th>소속</th>
                <th>영업대표</th>
                <th>계약명</th>
                <th>매출처</th>
                <th>매출금액</th>
                <th>이익금액</th>
                <th>매출예정일</th>
                <th>매출일</th>
                <th class="d-none">revenueId</th>
              </tr>
              </thead>
              <tfoot>
              <th></th>
              <th></th>
              <th></th>
              <th>TOTAL :</th>
              <th></th>
              <th></th>
              <th></th>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="row">
    <!-- Area Chart -->
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header - Dropdown -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">분기별 매출</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Oppt'y & Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="quarterBarchart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header - Dropdown -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">분기별 매출&이익</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="quarterProfitBarchart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row d-none" id="firm2">
    <div class="col-xl-12 col-lg-12">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">매출 상세 내용</h6>
        </div>
        <div class="dropdown no-arrow">
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="table-responsive">
            <table id="showFirms2" class="hover row-border" width="100%" style="width: 100%;">
              <thead>
              <tr>
                <th>관리번호</th>
                <th>소속</th>
                <th>영업대표</th>
                <th>계약명</th>
                <th>매출처</th>
                <th>매출금액</th>
                <th>이익금액</th>
                <th>매출예정일</th>
                <th>매출일</th>
                <th class="d-none">revenueId</th>
              </tr>
              </thead>
              <tfoot>
              <th></th>
              <th></th>
              <th></th>
              <th>TOTAL :</th>
              <th></th>
              <th></th>
              <th></th>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Area Chart -->
    <div class="col-xl-12 col-lg-12">
      <div class="card shadow mb-4">
        <!-- Card Header - Dropdown -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">월별 매출</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="contractMonthlychart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- data table -->
  <div class="row d-none" id="firm3">
    <div class="col-xl-12 col-lg-12">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">매출 상세 내용</h6><!-- Card Body -->
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table id="showFirms3" class="hover row-border" width="100%" style="width: 100%;">
              <thead>
              <tr>
                <th>관리번호</th>
                <th>소속</th>
                <th>영업대표</th>
                <th>계약명</th>
                <th>매출처</th>
                <th>매출금액</th>
                <th>이익금액</th>
                <th>매출예정일</th>
                <th>매출일</th>
                <th class="d-none">revenueId</th>
              </tr>
              </thead>
              <tfoot>
              <th></th>
              <th></th>
              <th></th>
              <th>TOTAL :</th>
              <th></th>
              <th></th>
              <th></th>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Row -->
  <div class="row">
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">상품별 매출(대분류)</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="maincategoryPiechart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">상품별 매출(소분류)</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <div class="text-gray-400 font-weight-bold h3" style="text-align: center" id="notice">대분류를 선택해 주세요.</div>
            <canvas id="subcategoryPiechart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row d-none" id="firm4">
    <div class="col-xl-12 col-lg-12">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">매출 상세 내용</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="table-responsive">
            <table id="showFirms4" class="hover row-border" width="100%" style="width: 100%;">
              <thead>
              <tr>
                <th>관리번호</th>
                <th>소속</th>
                <th>영업대표</th>
                <th>계약명</th>
                <th>매출처</th>
                <th>매출금액</th>
                <th>이익금액</th>
                <th>매출예정일</th>
                <th>매출일</th>
                <th class="d-none">revenueId</th>
              </tr>
              </thead>
              <tfoot>
              <th></th>
              <th></th>
              <th></th>
              <th>TOTAL :</th>
              <th></th>
              <th></th>
              <th></th>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Row -->
  <div class="row">
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">산업군별 매출</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="industryPiechart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">판매유형별 매출</h6>
          <h6 class="m-0 font-weight-bold text-secondary">[Firm]</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="chart-area">
            <canvas id="salestypePiechart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row d-none" id="firm5">
    <div class="col-xl-12 col-lg-12">
      <div class="card shadow mb-4">
        <!-- Card Header-->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-secondary">매출 상세 내용</h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="table-responsive">
            <table id="showFirms5" class="hover row-border" width="100%" style="width: 100%;">
              <thead>
              <tr>
                <th>관리번호</th>
                <th>소속</th>
                <th>영업대표</th>
                <th>계약명</th>
                <th>매출처</th>
                <th>매출금액</th>
                <th>이익금액</th>
                <th>매출예정일</th>
                <th>매출일</th>
                <th class="d-none">revenueId</th>
              </tr>
              </thead>
              <tfoot>
              <th></th>
              <th></th>
              <th></th>
              <th>TOTAL :</th>
              <th></th>
              <th></th>
              <th></th>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Filter Modal -->
  <div class="modal fade" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">

        <div class="modal-header bg-success text-gray-100">
          <h5 class="modal-title" id="filterModalLabel">검색조건</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span class="text-gray-100" aria-hidden="true">×</span>
          </button>
        </div>

        <div class="modal-body">
          <form id="filterForm" method="POST" onkeydown="javascript: if (event.keyCode == 13) {btn_filter();}">
            {% csrf_token %}
            <div class="row mb-1">
              <div class="col-12 mb-3 mb-sm-0">
                <label for="searchYear" class="text-primary">조회년도</label>
                <input type="number" max="9999" class="form-control" id="searchYear" name="searchYear" value="{{ todayYear }}">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">취소</button>
          <a class="btn btn-success" href="#" onclick="btn_filter()">조회</a>
        </div>
      </div>
    </div>
  </div>


{% endblock %}

{% block script %}
  <script src="/static/hr/js/demo/chart-bar-demo.js"></script>
  <script src="/static/hr/js/demo/chart-area-demo.js"></script>
  <script src="/static/hr/js/demo/chart-pie-demo.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.4.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-piechart-outlabels"></script>

  <script>
      function btn_filter() {
          document.getElementById("filterForm").submit();
      }

      function btn_filter2() {
          document.getElementById("filterDatatableForm").submit();
      }

      function replaceAll(str, searchStr, replaceStr) {
          var new_str = str.split(searchStr).join(replaceStr);
          return new_str.split("T").join(" ").slice(0, 10);
      }

      function changeDeptName(empDeptName, selectId) {
          $.ajax({
              url: "{% url 'sales:empdept_ajax_url' %}",
              method: 'POST',
              cache: false,
              data: {"empDeptName": empDeptName,
                    "empStatus": "Y"},
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnData) {
                  var empName = returnData;
                  console.log(empName);
                  $('#' + selectId).empty();

                  $('#' + selectId).append("<option value='전체'>전체</option>");
                  for (var count = 0; count < empName.length; count++) {
                      var option = $("<option value=" + empName[count].pk + ">" + empName[count].fields.empName + "</option>");
                      $('#' + selectId).append(option);
                  }
              }
          })
      }

  </script>

  <script>

      const filterArray = new Array();
      filterArray['quarter'] = '';
      filterArray['step'] = '';
      filterArray['team'] = '';
      filterArray['cumulative'] = '';
      filterArray['month'] = '';
      filterArray['maincategory'] = '';
      filterArray['subcategory'] = '';
      filterArray['industry'] = '';
      filterArray['salestype'] = '';

      const colors = ["#4e73df", "#1cc88a", "#36b9cc", "#f6c23e", "#e74a3b", "#858796", "#e83e8c", "grey",
          "#4e73df", "#1cc88a", "#36b9cc", "#f6c23e", "#e74a3b", "#858796", "#e83e8c", "grey",
          "#4e73df", "#1cc88a", "#36b9cc", "#f6c23e", "#e74a3b", "#858796", "#e83e8c", "grey"];
      const options = {
          maintainAspectRatio: false,
          plugins: {
              datalabels: {
                  align: 'end',
                  anchor: 'end',
                  color: function (context) {
                      return context.dataset.backgroundColor;
                  },
                  font: function (context) {
                      var w = context.chart.width;
                      return {
                          size: w < 512 ? 12 : 14
                      };
                  },
                  formatter: function (value, context) {
                      if (window.innerWidth < 400) {
                          return ''
                      } else {
                          return number_format(value).slice(0, -8);
                      }
                  }
              }
          },
          layout: {
              padding: {
                  left: 0,
                  right: 0,
                  top: 0,
                  bottom: 0
              }
          },
          scales: {
              xAxes: [{
                  time: {
                      unit: 'week'
                  },
                  gridLines: {
                      display: false,
                      drawBorder: false
                  },
                  ticks: {
                      maxTicksLimit: 8
                  },
                  maxBarThickness: 30,
              }],
              yAxes: [{
                  ticks: {
                      min: 0,
                      maxTicksLimit: 5,
                      padding: 5,
                      // Include a dollar sign in the ticks
                      callback: function (value, index, values) {
                          return number_format(value).slice(0, -8);
                      }
                  },
                  gridLines: {
                      color: "rgb(234, 236, 244)",
                      zeroLineColor: "rgb(234, 236, 244)",
                      drawBorder: false,
                      borderDash: [2],
                      zeroLineBorderDash: [2]
                  }
              }],
          },
          tooltips: {
              titleMarginBottom: 5,
              titleFontColor: '#6e707e',
              titleFontSize: 14,
              backgroundColor: "rgb(255,255,255)",
              bodyFontColor: "#4e73df",
              borderColor: '#dddfeb',
              borderWidth: 3,
              xPadding: 15,
              yPadding: 15,
              displayColors: true,
              caretPadding: 10,
              callbacks: {
                  label: function (tooltipItem, chart) {
                      return ' ' + number_format(tooltipItem.yLabel);
                  }
              }
          }
      };
      // Pie Chart 1
      const ctx1 = document.getElementById("todayquarterPiechart");
      const todayquarterPiechart = new Chart(ctx1, {
          type: 'pie',
          data: {
              labels: ["Opportunity", 'Firm'],
              datasets: [{
                  data: {{ quarter_opp_Firm }},
                  backgroundColor: ['#1cc88a', '#4e73df'],
                  hoverBackgroundColor: ['#1cc88a', '#4e73df'],
                  hoverBorderColor: "rgba(234, 236, 244, 1)",
              }],
          },
          options: {
              legend: {
                  display: true,
              },
              layout: {
                  padding: {
                      left: 10,
                      right: 10,
                      top: 20,
                      bottom: 20
                  }
              },
              maintainAspectRatio: false,
              tooltips: {
                  titleMarginBottom: 5,
                  titleFontColor: '#6e707e',
                  titleFontSize: 14,
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#4e73df",
                  borderColor: '#dddfeb',
                  borderWidth: 3,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
                  callbacks: {
                      label: function (tooltipItem, data) {
                          let Arr = data.datasets[0].data;
                          return number_format(Arr[tooltipItem.index]);
                      }
                  },
              },
              plugins: {
                  datalabels: {
                      formatter: (value, ctx) => {

                          let sum = 0;
                          let dataArr = ctx.chart.data.datasets[0].data;
                          dataArr.map(data => {
                              sum += data;
                          });
                          let dataSum = number_format(value).slice(0, -8);
                          return dataSum;


                      },
                      color: '#fff',
                  },
                  outlabels: {
                      text: '%l %p',
                      color: 'white',
                      stretch: 5,
                      font: {
                          resizable: true,
                          minSize: 12,
                          maxSize: 18
                      }
                  }
              }
          },
      });

      $("#todayquarterPiechart").click(
          function (evt) {
              const activeElement = todayquarterPiechart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const stepLabel = todayquarterPiechart.data.labels[idx];
              filterArray['quarter'] = '{{ todayQuarter }}분기';
              filterArray['step'] = stepLabel;
              filterArray['cumulative'] = 'Y';
              filterArray['team'] = "";
              filterArray['month'] = "";
              filterArray['maincategory'] = '';
              filterArray['subcategory'] = '';
              filterArray['industry'] = '';
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable1.clear().draw();
              $('#firm1').attr('class', 'row d-block');
              $('#firm2').attr('class', 'row d-none');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-none');
              pushData(firmTable1);
          }
      );

      // Bar Chart 2
      const ctx2 = document.getElementById("todayquarterCumulativechart");
      const todayquarterCumulativechart = new Chart(ctx2, {
          type: 'bar',
          data: {
              labels: ["{{ todayQuarter }}분기 누적 매출", "{{ todayQuarter }}분기 누적 이익"],
              datasets: [{
                  type: 'bar',
                  label: '목표매출',
                  borderColor: "#4365B0",

                  borderWidth: 2,
                  fill: false,
                  data: [{{ salesQuarterTarget }}, ''],
              }, {
                  label: "매출금액",
                  backgroundColor: "#4365B0",
                  borderColor: "#4365B0",
                  data: [{{ quarterly_cumulative_sales }}, '']
              }, {
                  type: 'bar',
                  label: '목표이익',
                  borderColor: "#F29220",
                  borderWidth: 2,
                  fill: false,
                  data: ['', {{ profitQuarterTarget }}],
              }, {
                  label: "이익금액",
                  backgroundColor: "#F29220",
                  borderColor: "#F29220",
                  data: ['', {{ quarterly_cumulative_profit }}]
              },
              ],
          },
          options: {
              maintainAspectRatio: false,
              plugins: {
                  datalabels: {
                      align: 'end',
                      anchor: 'end',
                      color: function (context) {
                          return context.dataset.backgroundColor;
                      },
                      font: function (context) {
                          var w = context.chart.width;
                          return {
                              size: w < 512 ? 12 : 14
                          };
                      },
                      formatter: function (value, context) {
                          if (window.innerWidth < 400) {
                              return ''
                          } else {
                              return '                     ' + number_format(value).slice(0, -8);
                          }
                      }
                  }
              },
              layout: {
                  padding: {
                      left: 0,
                      right: 0,
                      top: 0,
                      bottom: 0
                  }
              },
              scales: {
                  xAxes: [{
                      stacked: true,
                      time: {
                          unit: 'week'
                      },
                      gridLines: {
                          display: false,
                          drawBorder: false
                      },
                      ticks: {
                          maxTicksLimit: 8
                      },
                      maxBarThickness: 30,
                  }],
                  yAxes: [{
                      stacked: false,
                      ticks: {
                          min: 0,
                          maxTicksLimit: 5,
                          padding: 5,
                          // Include a dollar sign in the ticks
                          callback: function (value, index, values) {
                              return number_format(value).slice(0, -8);
                          }
                      },
                      gridLines: {
                          color: "rgb(234, 236, 244)",
                          zeroLineColor: "rgb(234, 236, 244)",
                          drawBorder: false,
                          borderDash: [2],
                          zeroLineBorderDash: [2]
                      }
                  }],
              },
              tooltips: {
                  titleMarginBottom: 5,
                  titleFontColor: '#6e707e',
                  titleFontSize: 14,
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#4e73df",
                  borderColor: '#dddfeb',
                  borderWidth: 3,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
                  callbacks: {
                      label: function (tooltipItem, chart) {
                          return ' ' + number_format(tooltipItem.yLabel);
                      }
                  }
              }
          }
      });

      $("#todayquarterCumulativechart").click(
          function (evt) {
              const activeElement = todayquarterCumulativechart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const stepLabel = todayquarterCumulativechart.data.labels[idx];
              filterArray['quarter'] = '{{ todayQuarter }}분기';
              filterArray['cumulative'] = 'Y';
              filterArray['step'] = "Firm";
              filterArray['team'] = "";
              filterArray['month'] = "";
              filterArray['maincategory'] = '';
              filterArray['subcategory'] = '';
              filterArray['industry'] = '';
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable1.clear().draw();
              $('#firm1').attr('class', 'row d-block');
              $('#firm2').attr('class', 'row d-none');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-none');
              pushData(firmTable1);

          }
      );

      // Bar Chart 3
      const ctx3 = document.getElementById("quarterBarchart");
      const quarterBarchart = new Chart(ctx3, {
          type: 'bar',
          data: {
              labels: ["1분기", "2분기", "3분기", "4분기"],
              datasets: [
                  {
                      type: 'line',
                      label: "목표매출",
                      borderColor: "grey",
                      borderWidth: 1,
                      fill: false,
                      data: [{{ goalsSum.sum_salesq1 }}, {{ goalsSum.sum_salesq2 }}, {{ goalsSum.sum_salesq3 }}, {{ goalsSum.sum_salesq4 }}]
                  }, {
                      label: "Firm",
                      backgroundColor: "#4e73df",
                      borderColor: "#4e73df",
                      data: [
                          {% for i in quarter_firm %}
                              {{ i }},
                          {% endfor %}
                      ]
                  }, {
                      label: "Opportunity",
                      backgroundColor: "#1cc88a",
                      borderColor: "#1cc88a",
                      data: [
                          {% for i in quarter_opp %}
                              {{ i }},
                          {% endfor %}
                      ]
                  },],
          },
          options: {
              maintainAspectRatio: false,
              plugins: {
                  datalabels: {
                      align: 'end',
                      anchor: 'end',
                      color: function (context) {
                          return context.dataset.backgroundColor;
                      },
                      font: function (context) {
                          var w = context.chart.width;
                          return {
                              size: w < 512 ? 12 : 14
                          };
                      },
                      formatter: function (value, context) {
                          if (window.innerWidth < 400) {
                              return ''
                          } else {
                              return number_format(value).slice(0, -8);
                          }
                      }
                  }
              },
              layout: {
                  padding: {
                      left: 0,
                      right: 0,
                      top: 0,
                      bottom: 0
                  }
              },
              scales: {
                  xAxes: [{
                      stacked: true,
                      time: {
                          unit: 'week'
                      },
                      gridLines: {
                          display: false,
                          drawBorder: false
                      },
                      ticks: {
                          maxTicksLimit: 8
                      },
                      maxBarThickness: 30,
                  }],
                  yAxes: [{
                      stacked: true,
                      ticks: {
                          min: 0,
                          maxTicksLimit: 5,
                          padding: 5,
                          // Include a dollar sign in the ticks
                          callback: function (value, index, values) {
                              return number_format(value).slice(0, -8);
                          }
                      },
                      gridLines: {
                          color: "rgb(234, 236, 244)",
                          zeroLineColor: "rgb(234, 236, 244)",
                          drawBorder: false,
                          borderDash: [2],
                          zeroLineBorderDash: [2]
                      }
                  }],
              },
              tooltips: {
                  titleMarginBottom: 5,
                  titleFontColor: '#6e707e',
                  titleFontSize: 14,
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#4e73df",
                  borderColor: '#dddfeb',
                  borderWidth: 3,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
                  callbacks: {
                      label: function (tooltipItem, chart) {
                          return ' ' + number_format(tooltipItem.yLabel);
                      }
                  }
              }
          }
      });

      $("#quarterBarchart").click(
          function (evt) {
              const activeElement = quarterBarchart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const datasetIndex = activeElement[0]._datasetIndex;
              const quarterLabel = quarterBarchart.data.labels[idx];
              const stepLabel = quarterBarchart.data.datasets[datasetIndex].label;
              filterArray['step'] = stepLabel;
              filterArray['team'] = "";
              filterArray['quarter'] = quarterLabel;
              filterArray['cumulative'] = 'N';
              filterArray['month'] = "";
              filterArray['maincategory'] = '';
              filterArray['subcategory'] = '';
              filterArray['industry'] = '';
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable2.clear().draw();
              $('#firm1').attr('class', 'row d-none');
              $('#firm2').attr('class', 'row d-block');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-none');
              pushData(firmTable2);
          }
      );

      // Bar Chart 3
      const ctx7 = document.getElementById("quarterProfitBarchart");
      const quarterProfitBarchart = new Chart(ctx7, {
          type: 'bar',
          data: {
              labels: ["1분기", "2분기", "3분기", "4분기"],
              datasets: [
                  {
                      type: 'line',
                      label: "목표매출",
                      borderColor: "#4365B0",
                      borderWidth: 1,
                      fill: false,
                      data: [{{ goalsSum.sum_salesq1 }}, {{ goalsSum.sum_salesq2 }}, {{ goalsSum.sum_salesq3 }}, {{ goalsSum.sum_salesq4 }}]
                  },
                  {
                      type: 'line',
                      label: "목표이익",
                      borderColor: "#F29220",
                      borderWidth: 1,
                      fill: false,
                      data: [{{ goalsSum.sum_profitq1 }}, {{ goalsSum.sum_profitq2 }}, {{ goalsSum.sum_profitq3 }}, {{ goalsSum.sum_profitq4 }}]
                  },
                  {
                      label: "매출금엑",
                      backgroundColor: "#4365B0",
                      borderColor: "#4365B0",
                      data: [
                          {% for i in quarter_firm %}
                              {{ i }},
                          {% endfor %}
                      ]
                  }, {
                      label: "이익금액",
                      backgroundColor: "#F29220",
                      borderColor: "#F29220",
                      data: [
                          {% for i in quarterFirmProfitSum %}
                              {{ i }},
                          {% endfor %}
                      ]
                  }],
          },
          options: options
      });

      $("#quarterProfitBarchart").click(
          function (evt) {
              const activeElement = quarterProfitBarchart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const datasetIndex = activeElement[0]._datasetIndex;
              const quarterLabel = quarterBarchart.data.labels[idx];
              filterArray['step'] = 'Firm';
              filterArray['team'] = "";
              filterArray['quarter'] = quarterLabel;
              filterArray['cumulative'] = 'N';
              filterArray['month'] = "";
              filterArray['maincategory'] = '';
              filterArray['subcategory'] = '';
              filterArray['industry'] = '';
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable2.clear().draw();
              $('#firm1').attr('class', 'row d-none');
              $('#firm2').attr('class', 'row d-block');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-none');
              pushData(firmTable2);
          }
      );

      const team1 = new Array();
      const team2 = new Array();
      const teamSum = new Array();
      {% for i in team_revenues %}
          {% if i.contractId__empDeptName == '영업1팀' %}
              team1.push({{ i.revenuePrice__sum }});
          {% elif i.contractId__empDeptName == '영업2팀'%}
              team2.push({{ i.revenuePrice__sum }});
          {% endif %}
      {% endfor %}
      for (var x = 0; x < 12; x++) {
          teamSum[x] = team1[x] + team2[x]
      }
      // Bar Chart 4
      const ctx4 = document.getElementById("contractMonthlychart");
      const contractMonthlychart = new Chart(ctx4, {
              type: 'bar',
              data: {
                  labels: ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"],
                  datasets: [
                      {
                          type: 'line',
                          label: "목표매출",
                          borderColor: "#4365B0",
                          borderWidth: 1,
                          fill: false,
                          data: [{{ goalsSum.sum_sales1 }}, {{ goalsSum.sum_sales2 }}, {{ goalsSum.sum_sales3 }}, {{ goalsSum.sum_sales4 }}, {{ goalsSum.sum_sales5 }}, {{ goalsSum.sum_sales6 }},
                              {{ goalsSum.sum_sales7 }}, {{ goalsSum.sum_sales8 }}, {{ goalsSum.sum_sales9 }}, {{ goalsSum.sum_sales10 }}, {{ goalsSum.sum_sales11 }}, {{ goalsSum.sum_sales12 }}]
                      },
                      {
                          type: 'line',
                          label: "목표이익",
                          borderColor: "#F29220",
                          borderWidth: 1,
                          fill: false,
                          data: [{{ goalsSum.sum_profit1 }}, {{ goalsSum.sum_profit2 }}, {{ goalsSum.sum_profit3 }}, {{ goalsSum.sum_profit4 }}, {{ goalsSum.sum_profit5 }}, {{ goalsSum.sum_profit6 }},
                              {{ goalsSum.sum_profit7 }}, {{ goalsSum.sum_profit8 }}, {{ goalsSum.sum_profit9 }}, {{ goalsSum.sum_profit10 }}, {{ goalsSum.sum_profit11 }}, {{ goalsSum.sum_profit12 }}]
                      }, {
                          label: "이익금액",
                          backgroundColor: "#F29220",
                          borderColor: "#F29220",
                          data: [
                              {% for m in monthRevenues %}
                                  {{ m.sumProfitPrice }},
                              {% endfor %}
                          ]
                      }, {
                          label: "매출금액",
                          backgroundColor: "#4365B0",
                          borderColor: "#4365B0",
                          data: [
                              {% for m in monthRevenues %}
                                  {{ m.sumPrice }},
                              {% endfor %}
                          ]
                      },],
              },
              options: options
          }
      );

      $("#contractMonthlychart").click(
          function (evt) {
              const activeElement = contractMonthlychart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const monthLabel = contractMonthlychart.data.labels[idx];
              const datasetIndex = activeElement[0]._datasetIndex;
              {#const teamLabel = contractMonthlychart.data.datasets[datasetIndex].label;#}
              filterArray['month'] = monthLabel;
              filterArray['team'] = '';
              filterArray['quarter'] = "";
              filterArray['cumulative'] = "";
              filterArray['step'] = "Firm";
              filterArray['maincategory'] = "";
              filterArray['subcategory'] = "";
              filterArray['industry'] = '';
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable3.clear().draw();
              $('#firm1').attr('class', 'row d-none');
              $('#firm2').attr('class', 'row d-none');
              $('#firm3').attr('class', 'row d-block');
              $('#firm4').attr('class', 'row d-none');
              pushData(firmTable3);
          }
      );

      // Pie Chart2
      const ctx5 = document.getElementById("maincategoryPiechart");
      const maincategoryPiechart = new Chart(ctx5, {
          type: 'bar',
          data: {
              labels: [
                  {% for main in maincategoryRevenuePrice %}
                      '{{ main.contractId__mainCategory }}',
                  {% endfor %}
              ],
              datasets: [{
                  data: [
                      {% for main in maincategoryRevenuePrice %}
                          {{ main.sumMainPrice }},
                      {% endfor %}
                  ],
                  backgroundColor: colors,
                  hoverBackgroundColor: colors,
                  hoverBorderColor: "rgba(234, 236, 244, 1)",
              }],
          },
          options: {
              legend: {
                  display: false,
              },
              maintainAspectRatio: false,
              plugins: {
                  datalabels: {
                      align: 'end',
                      anchor: 'end',
                      color: function (context) {
                          return context.dataset.backgroundColor;
                      },
                      font: function (context) {
                          var w = context.chart.width;
                          return {
                              size: w < 512 ? 12 : 14
                          };
                      },
                      formatter: function (value, context) {
                          if (window.innerWidth < 400) {
                              return ''
                          } else {
                              return number_format(value).slice(0, -8);
                          }
                      }
                  }
              },
              layout: {
                  padding: {
                      left: 0,
                      right: 0,
                      top: 0,
                      bottom: 0
                  }
              },
              scales: {
                  xAxes: [{
                      time: {
                          unit: 'week'
                      },
                      gridLines: {
                          display: false,
                          drawBorder: false
                      },
                      ticks: {
                          maxTicksLimit: 8
                      },
                      maxBarThickness: 30,
                  }],
                  yAxes: [{
                      ticks: {
                          min: 0,
                          maxTicksLimit: 5,
                          padding: 5,
                          // Include a dollar sign in the ticks
                          callback: function (value, index, values) {
                              return number_format(value).slice(0, -8);
                          }
                      },
                      gridLines: {
                          color: "rgb(234, 236, 244)",
                          zeroLineColor: "rgb(234, 236, 244)",
                          drawBorder: false,
                          borderDash: [2],
                          zeroLineBorderDash: [2]
                      }
                  }],
              },
              tooltips: {
                  titleMarginBottom: 5,
                  titleFontColor: '#6e707e',
                  titleFontSize: 14,
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#4e73df",
                  borderColor: '#dddfeb',
                  borderWidth: 3,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
                  callbacks: {
                      label: function (tooltipItem, chart) {
                          return ' ' + number_format(tooltipItem.yLabel);
                      }
                  }
              }
          }
      });

      $("#maincategoryPiechart").click(
          function (evt) {
              $('#notice').attr('class', 'd-none');
              const activeElement = maincategoryPiechart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const maincategoryLabel = maincategoryPiechart.data.labels[idx];
              filterArray['quarter'] = '';
              filterArray['step'] = 'Firm';
              filterArray['cumulative'] = '';
              filterArray['team'] = "";
              filterArray['month'] = "";
              filterArray['maincategory'] = maincategoryLabel;
              filterArray['subcategory'] = "";
              filterArray['industry'] = '';
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable4.clear().draw();
              $('#firm1').attr('class', 'row d-none');
              $('#firm2').attr('class', 'row d-none');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-block');
              pushData(firmTable4);
              removeData();
              pushChartData();
          }
      );

      // Pie Chart 3
      const ctx6 = document.getElementById("subcategoryPiechart");
      const subcategoryPiechart = new Chart(ctx6, {
          type: 'doughnut',
          data: {
              labels: [],
              datasets: [{
                  data: [],
                  backgroundColor: colors,
                  hoverBackgroundColor: colors,
                  hoverBorderColor: "rgba(234, 236, 244, 1)",
              }],
          },
          options: {
              layout: {
                  padding: {
                      left: 10,
                      right: 10,
                      top: 20,
                      bottom: 20
                  }
              },
              maintainAspectRatio: false,
              tooltips: {
                  titleMarginBottom: 5,
                  titleFontColor: '#6e707e',
                  titleFontSize: 14,
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#4e73df",
                  borderColor: '#dddfeb',
                  borderWidth: 3,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
                  callbacks: {
                      label: function (tooltipItem, data) {
                          let Arr = data.datasets[0].data;
                          return number_format(Arr[tooltipItem.index]);
                      }
                  },
              },
              plugins: {
                  datalabels: {
                      formatter: (value, ctx) => {

                          let sum = 0;
                          let dataArr = ctx.chart.data.datasets[0].data;
                          dataArr.map(data => {
                              sum += data;
                          });
                          let dataSum = number_format(value).slice(0, -8);
                          return dataSum;
                      },
                      color: '#fff',
                  },
                  outlabels: {
                      text: '%l %p',
                      color: 'white',
                      stretch: 5,
                      font: {
                          resizable: true,
                          minSize: 12,
                          maxSize: 18
                      }
                  }
              }
          },
      });

      $("#subcategoryPiechart").click(
          function (evt) {
              const activeElement = subcategoryPiechart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const subcategoryLabel = subcategoryPiechart.data.labels[idx];
              filterArray['quarter'] = '';
              filterArray['step'] = 'Firm';
              filterArray['cumulative'] = '';
              filterArray['team'] = "";
              filterArray['month'] = "";
              filterArray['subcategory'] = subcategoryLabel;
              filterArray['industry'] = '';
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable4.clear().draw();
              $('#firm1').attr('class', 'row d-none');
              $('#firm2').attr('class', 'row d-none');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-block');
              pushData(firmTable4);
          }
      );

      // polar Chart 1
      const industryPiechart = new Chart(document.getElementById("industryPiechart"), {
          type: 'polarArea',
          data: {
              labels: [
                  {% for industry in salesindustryRevenuePrice %}
                      '{{ industry.contractId__saleIndustry }}'.replace('&amp;', '&'),
                  {% endfor %}
              ],
              datasets: [
                  {
                      label: "산업군별",
                      backgroundColor: ["#3e95cd", "#c45850", "#8e5ea2", "#3cba9f", "#f6c23e", "#e8c3b9", "#c45850", "#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9"],
                      data: [
                          {% for industry in salesindustryRevenuePrice %}
                              {{ industry.sumIndustryPrice }},
                          {% endfor %}
                      ]
                  }
              ]
          },
          options: {
              legend: {
                  display: false,
              },
              layout: {
                  padding: {
                      left: 10,
                      right: 10,
                      top: 20,
                      bottom: 20
                  }
              },
              maintainAspectRatio: false,
              tooltips: {
                  titleMarginBottom: 5,
                  titleFontColor: '#6e707e',
                  titleFontSize: 14,
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#4e73df",
                  borderColor: '#dddfeb',
                  borderWidth: 3,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
                  callbacks: {
                      label: function (tooltipItem, data) {
                          let Arr = data.datasets[0].data;
                          return number_format(Arr[tooltipItem.index]);
                      }
                  },
              },
              plugins: {
                  datalabels: {
                      formatter: (value, ctx) => {

                          let sum = 0;
                          let dataArr = ctx.chart.data.datasets[0].data;
                          dataArr.map(data => {
                              sum += data;
                          });
                          let dataSum = number_format(value).slice(0, -8);
                          return dataSum;
                      },
                      color: '#fff',
                  },
                  outlabels: {
                      text: '%l',
                      color: 'white',
                      stretch: 5,
                      font: {
                          resizable: true,
                          minSize: 12,
                          maxSize: 18
                      }
                  }
              }

          }
      });

      $("#industryPiechart").click(
          function (evt) {
              const activeElement = industryPiechart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const industryLabel = industryPiechart.data.labels[idx];
              filterArray['quarter'] = '';
              filterArray['step'] = 'Firm';
              filterArray['cumulative'] = '';
              filterArray['team'] = "";
              filterArray['month'] = "";
              filterArray['subcategory'] = '';
              filterArray['industry'] = industryLabel;
              filterArray['salestype'] = '';
              console.log(filterArray);
              firmTable5.clear().draw();
              $('#firm1').attr('class', 'row d-none');
              $('#firm2').attr('class', 'row d-none');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-none');
              $('#firm5').attr('class', 'row d-block');
              pushData(firmTable5);
          }
      );

      const salestypePiechart = new Chart(document.getElementById("salestypePiechart"), {
          type: 'pie',
          data: {
              labels: [
                  {% for type in salestypeRevenuePrice %}
                      '{{ type.contractId__saleType }}',
                  {% endfor %}
              ],
              datasets: [
                  {
                      label: "판매유형별",
                      backgroundColor: ["#3cba9f", "#e8c3b9", "#8e5ea2", "#3e95cd", "#c45850", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850", "#3e95cd"],
                      data: [
                          {% for type in salestypeRevenuePrice %}
                              '{{ type.sumTypePrice }}',
                          {% endfor %}
                      ]
                  }
              ]
          },
          options: {
              legend: {
                  display: false,
              },
              layout: {
                  padding: {
                      left: 15,
                      right: 15,
                      top: 25,
                      bottom: 20
                  }
              },
              maintainAspectRatio: false,
              tooltips: {
                  titleMarginBottom: 5,
                  titleFontColor: '#6e707e',
                  titleFontSize: 14,
                  backgroundColor: "rgb(255,255,255)",
                  bodyFontColor: "#4e73df",
                  borderColor: '#dddfeb',
                  borderWidth: 3,
                  xPadding: 15,
                  yPadding: 15,
                  displayColors: true,
                  caretPadding: 10,
                  callbacks: {
                      label: function (tooltipItem, data) {
                          let Arr = data.datasets[0].data;
                          return number_format(Arr[tooltipItem.index]);
                      }
                  },
              },
              plugins: {
                  datalabels: {
                      formatter: (value, ctx) => {

                          let sum = 0;
                          let dataArr = ctx.chart.data.datasets[0].data;
                          dataArr.map(data => {
                              sum += data;
                          });
                          let dataSum = number_format(value).slice(0, -8);
                          return dataSum;
                      },
                      color: '#fff',
                  },
                  outlabels: {
                      text: '%l %p',
                      color: 'white',
                      stretch: 5,
                      font: {
                          resizable: true,
                          minSize: 12,
                          maxSize: 18
                      }
                  }
              },

          }
      });

      $("#salestypePiechart").click(
          function (evt) {
              const activeElement = salestypePiechart.getElementAtEvent(evt);
              const idx = activeElement[0]._index;
              const salestypeLabel = salestypePiechart.data.labels[idx];
              filterArray['quarter'] = '';
              filterArray['step'] = 'Firm';
              filterArray['cumulative'] = '';
              filterArray['team'] = "";
              filterArray['month'] = "";
              filterArray['subcategory'] = '';
              filterArray['maincategory'] = '';
              filterArray['industry'] = '';
              filterArray['salestype'] = salestypeLabel;
              console.log(filterArray);
              firmTable5.clear().draw();
              $('#firm1').attr('class', 'row d-none');
              $('#firm2').attr('class', 'row d-none');
              $('#firm3').attr('class', 'row d-none');
              $('#firm4').attr('class', 'row d-none');
              $('#firm5').attr('class', 'row d-block');
              pushData(firmTable5);
          }
      );

      function removeData() {
          console.log(subcategoryPiechart.data);
          subcategoryPiechart.data = {
              labels: [],
              datasets: [{
                  data: [],
                  backgroundColor: colors,
              }]

          };
          subcategoryPiechart.update();
      }

      function pushChartData() {

          $.ajax({
              url: "{% url 'dashboard:opportunity_ajax_graph' %}",
              method: 'POST',
              cache: false,
              data: {
                  'step': filterArray['step'],
                  'maincategory': filterArray['maincategory'],
              },
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnStep) {
                  var dataStep = returnStep;
                  for (var k = 0; k < dataStep.length; k++) {
                      const labels = Object.keys(dataStep[k]);
                      const first_key = Object.keys(dataStep[k])[0];
                      if (first_key == 'contractId__subCategory') {
                          subcategoryPiechart.data.labels.push(dataStep[k]['contractId__subCategory']);
                          subcategoryPiechart.data.datasets.forEach((dataset) => {
                              dataset.data.push(dataStep[k]['sum_sub']);
                          });
                          subcategoryPiechart.update();
                      }
                  }
              }
          });
      }

  </script>

  <script>
      var firmTable1;
      var firmTable2;
      var firmTable3;
      var firmTable4;
      var firmTable5;
      $(document).ready(function () {
          firmTable1 = $('#showFirms1').DataTable({
              "scrollX": true,
              "autoWidth": false,
              "processing": true,
              "columns": [
                  {data: 'contractId__contractCode'},
                  {data: 'contractId__empName'},
                  {data: 'contractId__empDeptName'},
                  {data: 'contractId__contractName'},
                  {data: 'contractId__saleCompanyName__companyName'},
                  {data: 'revenuePrice'},
                  {data: 'revenueProfitPrice'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'revenueId'},
              ],
              "columnDefs": [
                  {targets: 0, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "30%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "10%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, visible: false}
              ],
              dom: 'Blfrtip',
              buttons: [
                  {
                      extend: 'excel',
                      text: '엑셀',
                      footer: true
                  },
                  {
                      extend: 'copy',
                      text: '복사',
                      footer: true
                  },
                  {
                      extend: 'print',
                      text: '인쇄',
                      footer: true
                  }
              ],
              "order": [[7, 'desc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_ 개씩 보기",
                  "search": "검색:",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "다음",
                      "previous": "이전"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(5)', nRow).text(aData.revenuePrice.toLocaleString());
                  $('td:eq(6)', nRow).text(aData.revenueProfitPrice.toLocaleString());
                  $('td:eq(7)', nRow).text(replaceAll(aData.predictBillingDate, "-", "."));
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(5, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(5).footer()).html(revenueResult.toLocaleString());

                  var profitResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      profitResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(profitResult.toLocaleString());
              },
          });

          firmTable2 = $('#showFirms2').DataTable({
              "scrollX": true,
              "autoWidth": false,
              "processing": true,
              "columns": [
                  {data: 'contractId__contractCode'},
                  {data: 'contractId__empName'},
                  {data: 'contractId__empDeptName'},
                  {data: 'contractId__contractName'},
                  {data: 'contractId__saleCompanyName__companyName'},
                  {data: 'revenuePrice'},
                  {data: 'revenueProfitPrice'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'revenueId'},
              ],
              "columnDefs": [
                  {targets: 0, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "30%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "10%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, visible: false}
              ],
              dom: 'Blfrtip',
              buttons: [
                  {
                      extend: 'excel',
                      text: '엑셀',
                      footer: true
                  },
                  {
                      extend: 'copy',
                      text: '복사',
                      footer: true
                  },
                  {
                      extend: 'print',
                      text: '인쇄',
                      footer: true
                  }
              ],
              "order": [[7, 'desc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_ 개씩 보기",
                  "search": "검색:",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "다음",
                      "previous": "이전"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(5)', nRow).text(aData.revenuePrice.toLocaleString());
                  $('td:eq(6)', nRow).text(aData.revenueProfitPrice.toLocaleString());
                  $('td:eq(7)', nRow).text(replaceAll(aData.predictBillingDate, "-", "."));
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(5, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(5).footer()).html(revenueResult.toLocaleString());

                  var profitResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      profitResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(profitResult.toLocaleString());
              },
          });

          firmTable3 = $('#showFirms3').DataTable({
              "scrollX": true,
              "autoWidth": false,
              "processing": true,
              "columns": [
                  {data: 'contractId__contractCode'},
                  {data: 'contractId__empName'},
                  {data: 'contractId__empDeptName'},
                  {data: 'contractId__contractName'},
                  {data: 'contractId__saleCompanyName__companyName'},
                  {data: 'revenuePrice'},
                  {data: 'revenueProfitPrice'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'revenueId'},
              ],
              "columnDefs": [
                  {targets: 0, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "30%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "10%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, visible: false}
              ],
              dom: 'Blfrtip',
              buttons: [
                  {
                      extend: 'excel',
                      text: '엑셀',
                      footer: true
                  },
                  {
                      extend: 'copy',
                      text: '복사',
                      footer: true
                  },
                  {
                      extend: 'print',
                      text: '인쇄',
                      footer: true
                  }
              ],
              "order": [[7, 'desc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_ 개씩 보기",
                  "search": "검색:",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "다음",
                      "previous": "이전"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(5)', nRow).text(aData.revenuePrice.toLocaleString());
                  $('td:eq(6)', nRow).text(aData.revenueProfitPrice.toLocaleString());
                  $('td:eq(7)', nRow).text(replaceAll(aData.predictBillingDate, "-", "."));
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(5, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(5).footer()).html(revenueResult.toLocaleString());

                  var profitResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      profitResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(profitResult.toLocaleString());
              },
          });

          firmTable4 = $('#showFirms4').DataTable({
              "scrollX": true,
              "autoWidth": false,
              "processing": true,
              "columns": [
                  {data: 'contractId__contractCode'},
                  {data: 'contractId__empName'},
                  {data: 'contractId__empDeptName'},
                  {data: 'contractId__contractName'},
                  {data: 'contractId__saleCompanyName__companyName'},
                  {data: 'revenuePrice'},
                  {data: 'revenueProfitPrice'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'revenueId'},
              ],
              "columnDefs": [
                  {targets: 0, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "30%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "10%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, visible: false}
              ],
              dom: 'Blfrtip',
              buttons: [
                  {
                      extend: 'excel',
                      text: '엑셀',
                      footer: true
                  },
                  {
                      extend: 'copy',
                      text: '복사',
                      footer: true
                  },
                  {
                      extend: 'print',
                      text: '인쇄',
                      footer: true
                  }
              ],
              "order": [[7, 'desc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_ 개씩 보기",
                  "search": "검색:",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "다음",
                      "previous": "이전"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(5)', nRow).text(aData.revenuePrice.toLocaleString());
                  $('td:eq(6)', nRow).text(aData.revenueProfitPrice.toLocaleString());
                  $('td:eq(7)', nRow).text(replaceAll(aData.predictBillingDate, "-", "."));
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(5, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(5).footer()).html(revenueResult.toLocaleString());

                  var profitResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      profitResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(profitResult.toLocaleString());
              },
          });

          firmTable5 = $('#showFirms5').DataTable({
              "scrollX": true,
              "autoWidth": false,
              "processing": true,
              "columns": [
                  {data: 'contractId__contractCode'},
                  {data: 'contractId__empName'},
                  {data: 'contractId__empDeptName'},
                  {data: 'contractId__contractName'},
                  {data: 'contractId__saleCompanyName__companyName'},
                  {data: 'revenuePrice'},
                  {data: 'revenueProfitPrice'},
                  {data: 'predictBillingDate'},
                  {data: 'billingDate'},
                  {data: 'revenueId'},
              ],
              "columnDefs": [
                  {targets: 0, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 1, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 2, width: "5%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 3, width: "30%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 4, width: "10%", className: "dt-head-center dt-body-left dt-head-nowrap dt-body-nowrap"},
                  {targets: 5, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 6, width: "10%", className: "dt-head-center dt-body-right dt-head-nowrap dt-body-nowrap"},
                  {targets: 7, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 8, width: "10%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                  {targets: 9, visible: false}
              ],
              dom: 'Blfrtip',
              buttons: [
                  {
                      extend: 'excel',
                      text: '엑셀',
                      footer: true
                  },
                  {
                      extend: 'copy',
                      text: '복사',
                      footer: true
                  },
                  {
                      extend: 'print',
                      text: '인쇄',
                      footer: true
                  }
              ],
              "order": [[7, 'desc']],
              "searching": true,
              "paging": true,
              "info": false,
              "scrollY": "80vh",
              "scrollCollapse": true,
              "language": {
                  "lengthMenu": "_MENU_ 개씩 보기",
                  "search": "검색:",
                  "paginate": {
                      "first": "처음",
                      "last": "끝",
                      "next": "다음",
                      "previous": "이전"
                  },
              },
              "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                  $('td:eq(5)', nRow).text(aData.revenuePrice.toLocaleString());
                  $('td:eq(6)', nRow).text(aData.revenueProfitPrice.toLocaleString());
                  $('td:eq(7)', nRow).text(replaceAll(aData.predictBillingDate, "-", "."));
              },
              "footerCallback": function () {
                  var api = this.api(), data;

                  var revenueResult = 0;
                  api.column(5, {search: 'applied'}).data().each(function (data, index) {
                      revenueResult += parseFloat(data);
                  });
                  $(api.column(5).footer()).html(revenueResult.toLocaleString());

                  var profitResult = 0;
                  api.column(6, {search: 'applied'}).data().each(function (data, index) {
                      profitResult += parseFloat(data);
                  });
                  $(api.column(6).footer()).html(profitResult.toLocaleString());
              },
          });


          $("#showFirms1").on("click", 'tr', function () {
              const data = firmTable1.row(this).data();
              location.href = '/sales/viewrevenue/' + data.revenueId + '/'
          });

          $("#showFirms2").on("click", 'tr', function () {
              const data = firmTable2.row(this).data();
              location.href = '/sales/viewrevenue/' + data.revenueId + '/'
          });

          $("#showFirms3").on("click", 'tr', function () {
              const data = firmTable3.row(this).data();
              location.href = '/sales/viewrevenue/' + data.revenueId + '/'
          });

          $("#showFirms4").on("click", 'tr', function () {
              const data = firmTable4.row(this).data();
              location.href = '/sales/viewrevenue/' + data.revenueId + '/'
          });

          $("#showFirms5").on("click", 'tr', function () {
              const data = firmTable5.row(this).data();
              location.href = '/sales/viewrevenue/' + data.revenueId + '/'
          });

      });


      function pushData(table) {

          $.ajax({
              url: "{% url 'dashboard:quarter_ajax_url' %}",
              method: 'POST',
              cache: false,
              data: {
                  "step": filterArray['step'],
                  "team": filterArray['team'],
                  "cumulative": filterArray['cumulative'],
                  "quarter": filterArray['quarter'],
                  "month": filterArray['month'],
                  "maincategory": filterArray['maincategory'],
                  "subcategory": filterArray['subcategory'],
                  "industry": filterArray['industry'],
                  "salestype": filterArray['salestype'],
              },
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              success: function (returnData) {
                  for (var i = 0; i < returnData.length; i++) {
                      table.row.add(returnData[i])
                  }
                  table.draw()
              }
          });

      }
  </script>
{% endblock %}