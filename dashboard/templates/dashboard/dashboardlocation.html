{% extends "dashboard/layout.html" %}

{% block title %}
  엔지니어 지원 현황
{% endblock %}

{% block css %}

<style type="text/css">

</style>

{% endblock %}

{% block content %}

    <h3 class="mb-2 text-gray-800">엔지니어 지원 현황</h3>
    <div align="right"><h6 class="mb-3 text-gray-800">{{ today | date:"Y. m. d" }}<div id="divClock" class="clock"></div></h6></div>

    <div id="map" style="width: 100%; height: 400px;"></div>

{% endblock %}

{% block script %}
    <script src="http://maps.google.com/maps/api/js?key=" ></script>
    <script type="text/javascript">

        const map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: new google.maps.LatLng(37.549012, 126.988546),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        const infowindow = new google.maps.InfoWindow();

        let marker, i;
        let empDeptName, startlat, startlong, serviceId, companyName
        const image1 = '/media/icon/dmarker.png';
        const image2 = '/media/icon/smarker.png';

        {% for l in location %}

            empDeptName = '{{ l.serviceId.empDeptName }}';
            startlat = parseFloat('{{ l.startLatitude }}');
            startlong = parseFloat('{{ l.startLongitude }}');
            serviceId  = '{{ l.serviceId }}';
            companyName = '{{ l.serviceId.companyName }}';
            if(empDeptName=='DB지원팀'){
                marker = new google.maps.Marker({
                    id:serviceId,
                    position: new google.maps.LatLng(startlat, startlong),
                    map: map,
                    icon:image1
                });
            }else{
                marker = new google.maps.Marker({
                    id:serviceId,
                    position: new google.maps.LatLng(startlat, startlong),
                    map: map,
                    icon:image2
                });
            }

            google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function() {
                    infowindow.setContent(companyName);
                    infowindow.open(map, marker);
                }
            })(marker, serviceId));

            if(marker)
            {
                marker.addListener('click', function() {
                    map.setZoom(15);
                    map.setCenter(this.getPosition());
                });
            }
        {% endfor %}

        function showClock() {
            const currentDate=new Date();
            const divClock=document.getElementById("divClock");
            let apm=currentDate.getHours();
            if(apm<12) {
                apm="오전";
            } else {
            apm="오후";
            }
            let msg = apm +(currentDate.getHours()-12)+"시";
            msg += currentDate.getMinutes() + "분";
            msg += currentDate.getSeconds() + "초";
            divClock.innerText=msg;
            setTimeout(showClock,1000);
        }

        $( document ).ready(function() {
            showClock();
        });

  </script>
{% endblock %}