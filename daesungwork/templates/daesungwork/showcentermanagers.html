{% extends "dashboard/layout.html" %}


{% block title %}
센터별 담당자 관리
{% endblock %}

{% block css %}
<style>
  pc-table {
      color: #333333;
      table-layout: fixed;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    .pc-table td, .pc-table th {
      padding: 5px 15px;
      text-align: center;
      vertical-align: middle;
      font-size: 17px;
      border: 1px solid rgba(206, 210, 219, 0.64);
    }
</style>
{% endblock %}


{% block content %}

<div class="row">
  <div class="col-xl-12">
    <div class="card shadow mb-4">
      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 h3 text-gray-800"> 센터별 담당자 관리</h6>
      </div>

      <div class="card-body">
        <div>
          <div class="row">
            <h5 class="text-primary mb-3">
              <span class="ml-3 text-dark">▼</span> 담당자 배정 현황
            </h5>
          </div>
          <div class="row mb-3 center">
            {% if centermanager %}
              <table class="pc-table m-2" style="width: 100%;">
                <tr style="background-color: #c5e4f8; color: black;">
                  <th class="font-weight-normal">담당자</th>
                  <th class="font-weight-normal">담당구역</th>
                  <th class="font-weight-normal">추가관리</th>
                  <th class="font-weight-normal">대청소담당구역</th>
                </tr>

                {% for emp in centermanageremps %}
                  <tr>
                    <th class="font-weight-normal text-dark" style="background-color: #deeef8;">{{ emp.empId.empName }}</th>
                    <th class="font-weight-normal text-dark">{{ emp.manageArea.centerName }}</th>
                    <th class="font-weight-normal text-dark">{{ emp.additionalArea }}</th>
                    <th class="font-weight-normal text-dark">{{ emp.cleanupArea.centerName }}</th>
                  </tr>
                {% endfor %}
              </table>
            {% else %}
            <span style="width:100%" class="text-center center mb-3">조회 기간에 해당하는 <span class="text-danger">담당자 배정 정보 없음</span></span>
            {% endif %}
          </div>
        </div>

        <div class="row justify-content-between">
          <h5 class="text-primary ml-3 mr-3">
            <span class="text-dark">▼</span> 작성 목록
          </h5>
          <a class="btn ml-3 mr-3" style="background-color: lightgrey;color: #3b3b3b" href="/daesungwork/postmanager/" role="button">
            <span>등록</span>
          </a>
        </div>

        <div id="centerManagerdiv">
          <table id="showcentermanagers" class="display" style="width:100%">
            <thead style="width:100%">
            <tr style="background-color: #deeef8; color: black;">
              <td>번호</td>
              <td>기간</td>
              <td>작성자</td>
              <td>작성일시</td>
            </tr>
            </thead>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}


{% block script %}

<script type="text/javascript">
    function replaceAll(str, searchStr, replaceStr) {
          if (str != null) {
              var new_str = str.split(searchStr).join(replaceStr);
              return new_str.split("T").join(" ").slice(0, 16);
          } else {
              return '-'
          }
    }
    $(document).ready(function () {
        $('#showcentermanagers').dataTable({
            "processing": true,
            "ajax": {
                "processing": true,
                "type": 'POST',
                "data": {
                    "userId": "{{ user.employee.empId }}",
                },
                "url": "{% url 'daesungwork:centermanagerasjson' %}",
                "dataSrc": ""
            },
            "columns": [
                {data: "centerManagerId", },
                {data: "startDate",
                  "render": function (data, type, row) {
                        return '<div>'+ row['startDate'] +" ~ "+ row['endDate'] +'</div>'
                  },
                },
                {data: "writeEmp__empName"},
                {data: "createdDatetime"},
            ],
            "columnDefs": [
                {targets: 0, width: "15%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                {targets: 1, width: "35%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                {targets: 2, width: "15%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
                {targets: 3, width: "35%", className: "dt-head-center dt-body-center dt-head-nowrap dt-body-nowrap"},
            ],
            "deferRender": true,
            "bLengthChange" : false,
            "order": [[0, 'desc']],
            "searching": false,
            "paging": true,
            "info": false,
            "scrollY": "80vh",
            "scrollX": true,
            "scrollCollapse": true,
            "language": {
                "lengthMenu": "_MENU_",
                "search": "검색:",
                "zeroRecords": "결과 없음",
                "processing": "로딩중",
                "paginate": {
                    "first": "처음",
                    "last": "끝",
                    "next": "→",
                    "previous": "←"
                },
            },
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                $('td:eq(3)', nRow).text(replaceAll(aData.createdDatetime, "-", "-"));
            },
            "footerCallback": function () {
            },
        });

        const centermanagersTable = $('#showcentermanagers').DataTable();

        $("#showcentermanagers").on("click", 'tr', function () {
            const data = centermanagersTable.row(this).data();
            // window.open('about:blank').location.href = '/daesungwork/viewcentermanager/' + data.centerManagerId + '/';
            location.href = '/daesungwork/viewcentermanager/' + data.centerManagerId + '/'
        });
    });


</script>

{% endblock %}